\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
\usepackage{ctex}
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \makeatletter
    \newsavebox\pandoc@box
    \newcommand*\pandocbounded[1]{%
      \sbox\pandoc@box{#1}%
      % scaling factors for width and height
      \Gscale@div\@tempa\textheight{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
      \Gscale@div\@tempb\linewidth{\wd\pandoc@box}%
      % select the smaller of both
      \ifdim\@tempb\p@<\@tempa\p@
        \let\@tempa\@tempb
      \fi
      % scaling accordingly (\@tempa < 1)
      \ifdim\@tempa\p@<\p@
        \scalebox{\@tempa}{\usebox\pandoc@box}%
      % scaling not needed, use as it is
      \else
        \usebox{\pandoc@box}%
      \fi
    }
    \makeatother

    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Exercise\_week\_04}
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \section{Statistical Methods in Astrophysics
Exercises}\label{statistical-methods-in-astrophysics-exercises}

\subsection{Week 04: Parameter
Estimation}\label{week-04-parameter-estimation}

\subsubsection{Personal Information}\label{personal-information}

\textbf{Name:} physnya

    \subsubsection{Exercise 1: Location of the
lighthouse}\label{exercise-1-location-of-the-lighthouse}

A lighthouse is located at an unknown position \(\alpha\) along a
straight coastline. The distance from the lighthouse to the coastline is
\(\beta = 1\). The lighthouse emits light in random directions, and the
light hits the coast at positions \(x_k\).

See the lecture slides for the illustration of the problem.

\paragraph{Question 1.1: Sample mean and standard
deviation}\label{question-1.1-sample-mean-and-standard-deviation}

\textbf{Tasks:} 1. Simulate 10000 flash positions \(x_k\) from the
lighthouse, with the true position \(\alpha_{\rm true} = 0\). 2. For
each \(N_{\rm flash} = 2^n\), \(n = 3, 4, \dots, 13\), compute the
sample mean \(\mu_{\rm sp}\) and sample standard deviation
\(\sigma_{\rm sp}\) of the first \(N_{\rm flash}\) positions. 3. Plot
the sample means and standard deviations as a function of
\(N_{\rm flash}\) using appropriate axes scales.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: Run this cell in the first place}
\PY{c+c1}{\PYZsh{} Load packages for numerical calculations and plotting}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{numpy}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{np}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{plt}
\PY{c+c1}{\PYZsh{} Enable inline plotting in Jupyter notebooks}
\PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{9.6}\PY{p}{,} \PY{l+m+mf}{5.4}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.dpi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{300}
\PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\PY{n}{plt}\PY{o}{.}\PY{n}{rc}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{usetex} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{rc}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{family} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{serif}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 由于设置了图片的高 dpi 和字体，所以编译速度变慢.}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}lighthouse\PYZus{}flashes}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{alpha}\PY{p}{,} \PY{n}{beta} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{seed} \PY{o}{=} \PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Simulate positions of lighthouse flashes on the shoreline}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        num : int, number of flashes to simulate}
\PY{l+s+sd}{        alpha : float, lighthouse position on x\PYZhy{}axis}
\PY{l+s+sd}{        beta : float, lighthouse position on y\PYZhy{}axis (default: 1)}
\PY{l+s+sd}{        seed : int, random seed for reproducibility (default: 42)}
\PY{l+s+sd}{    Returns: array of x positions of the flashes}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{n}{theta} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{uniform}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{num}\PY{p}{)}
    \PY{n}{x} \PY{o}{=} \PY{n}{alpha} \PY{o}{+} \PY{n}{beta} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{tan}\PY{p}{(}\PY{n}{theta}\PY{p}{)}
    \PY{k}{return} \PY{n}{x}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Set the random seed}
\PY{c+c1}{\PYZsh{} NOTE: EDIT HERE to insert your seed as the seed}
\PY{n}{seed} \PY{o}{=} \PY{l+m+mi}{2024011182}
\PY{n}{nsample} \PY{o}{=} \PY{l+m+mi}{10000}
\PY{n}{alpha\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{0}

\PY{c+c1}{\PYZsh{} Simulate lighthouse flashes}
\PY{n}{flash\PYZus{}data} \PY{o}{=} \PY{n}{sim\PYZus{}lighthouse\PYZus{}flashes}\PY{p}{(}\PY{n}{nsample}\PY{p}{,} \PY{n}{alpha\PYZus{}true}\PY{p}{,} \PY{n}{seed} \PY{o}{=} \PY{n}{seed}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{nflash} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{2}\PY{o}{*}\PY{o}{*}\PY{n}{n} \PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{14}\PY{p}{)}\PY{p}{]} \PY{c+c1}{\PYZsh{} Number of flashes to consider}
\PY{n}{alpha\PYZus{}sample\PYZus{}mean} \PY{o}{=} \PY{p}{[}\PY{p}{]} \PY{c+c1}{\PYZsh{} Store sample mean estimates of alpha}
\PY{n}{alpha\PYZus{}sample\PYZus{}sigma} \PY{o}{=} \PY{p}{[}\PY{p}{]} \PY{c+c1}{\PYZsh{} Store sample standard deviation estimates of alpha}

\PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n}{nflash}\PY{p}{:}
    \PY{n}{sample} \PY{o}{=} \PY{n}{flash\PYZus{}data}\PY{p}{[}\PY{p}{:}\PY{n}{n}\PY{p}{]}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compute the sample mean and standard deviation}
    \PY{n}{alpha\PYZus{}sample\PYZus{}mean}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{sample}\PY{p}{)}\PY{p}{)}
    \PY{n}{alpha\PYZus{}sample\PYZus{}sigma}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{sample}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
\PY{n}{ax} \PY{o}{=} \PY{p}{[}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{]}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot the sample mean and standard deviation estimates of alpha}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{nflash}\PY{p}{,} \PY{n}{alpha\PYZus{}sample\PYZus{}mean}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{nflash}\PY{p}{,} \PY{n}{alpha\PYZus{}sample\PYZus{}sigma}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to set axes scales and ranges}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mu\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm sp\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm sp\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}N\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm flash\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_6_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Question 1.2: Bayesian
posterior}\label{question-1.2-bayesian-posterior}

Let us choose a flat prior for \(\alpha\) in the range \([-50, 50]\).
The likelihood function for a set of \(N_{\rm flash}\) observations
\(\{x_k\}\) is given in the lecture slides.

\textbf{Tasks:} 1. For the same \(N_{\rm flash}\) values as in Question
1.1, compute the posterior distribution of \(\alpha\) on a grid of
\(\alpha\) values in the prior range \([-50, 50]\). 2. Plot the
posterior distributions of \(\alpha\) for different \(N_{\rm flash}\)
values.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}lighthouse}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{beta} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of alpha given the data.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data : array, observed positions of lighthouse flashes}
\PY{l+s+sd}{        beta : float, lighthouse position on y\PYZhy{}axis (default: 1)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        alpha : array, grid of alpha values}
\PY{l+s+sd}{        posterior : array, posterior distribution of alpha}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{alpha} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{10000}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compute the posterior distribution of alpha}
    \PY{n}{loglike} \PY{o}{=} \PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{beta}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{d} \PY{o}{\PYZhy{}} \PY{n}{alpha}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)} \PY{k}{for} \PY{n}{d} \PY{o+ow}{in} \PY{n}{data}\PY{p}{]}
    \PY{n}{loglike} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{loglike}\PY{p}{,} \PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{loglike} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{loglike}\PY{p}{)} \PY{c+c1}{\PYZsh{} for numerical stability}

    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{loglike}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{alpha}\PY{p}{)} \PY{c+c1}{\PYZsh{} normalize the posterior}
    \PY{k}{return} \PY{n}{alpha}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{posteriors} \PY{o}{=} \PY{p}{[}\PY{p}{]}     \PY{c+c1}{\PYZsh{} Store posterior distributions for different N\PYZus{}flash}

\PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n}{nflash}\PY{p}{:}
    \PY{n}{sample} \PY{o}{=} \PY{n}{flash\PYZus{}data}\PY{p}{[}\PY{p}{:}\PY{n}{n}\PY{p}{]}
    \PY{n}{alpha\PYZus{}grid}\PY{p}{,} \PY{n}{posterior} \PY{o}{=} \PY{n}{posterior\PYZus{}lighthouse}\PY{p}{(}\PY{n}{sample}\PY{p}{)}
    \PY{n}{posteriors}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{posterior}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
\PY{n}{ax} \PY{o}{=} \PY{p}{[}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{]}

\PY{c+c1}{\PYZsh{} Plot the posterior distributions of alpha for different N\PYZus{}flash values}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{n} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{nflash}\PY{p}{)}\PY{p}{:}
    \PY{n}{idx} \PY{o}{=} \PY{n}{i} \PY{o}{/}\PY{o}{/} \PY{p}{(}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{nflash}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/}\PY{o}{/} \PY{l+m+mi}{2}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{idx}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
        \PY{n}{alpha\PYZus{}grid}\PY{p}{,}
        \PY{n}{posteriors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}
        \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{rf}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}N\PYZus{}}\PY{l+s+se}{\PYZob{}\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm flash}\PY{l+s+se}{\PYZcb{}\PYZcb{}}\PY{l+s+s1}{=}\PY{l+s+si}{\PYZob{}}\PY{n}{n}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
    \PY{p}{)}

\PY{k}{for} \PY{n}{a} \PY{o+ow}{in} \PY{n}{ax}\PY{p}{:}
    \PY{n}{a}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}
        \PY{n}{alpha\PYZus{}true}\PY{p}{,}
        \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
        \PY{n}{linestyle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
        \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm true\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
    \PY{p}{)}
    \PY{n}{a}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
    \PY{n}{a}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to set axes scales and ranges}
\PY{c+c1}{\PYZsh{} ax[0].set\PYZus{}xscale(\PYZsq{}log\PYZsq{})}
\PY{c+c1}{\PYZsh{} ax[1].set\PYZus{}xscale(\PYZsq{}log\PYZsq{})}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{l+m+mf}{1.5}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{l+m+mf}{0.3}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha | }\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{x\PYZus{}k}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_10_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Question 1.3: Summary statistics of the
posterior}\label{question-1.3-summary-statistics-of-the-posterior}

\textbf{Tasks:} 1. For each posterior distribution in Question 1.2,
compute the posterior mean \(\mu_{\rm post}\) and standard deviation
\(\sigma_{\rm post}\). 2. Plot the posterior means and standard
deviations as a function of \(N_{\rm flash}\) using appropriate axes
scales. Overlay the \(\propto 1/\sqrt{N_{\rm flash}}\) trend. 3. Compute
the median and half of the 16-84 percentile interval of the posterior
distribution for each \(N_{\rm flash}\), and plot them as a function of
\(N_{\rm flash}\). Overplot the means and standard deviations from Task
2 for comparison, and overlay the \(\propto 1/\sqrt{N_{\rm flash}}\)
trend. 4. Discuss your observations for all the plots in this exercise.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}summary\PYZus{}moment}\PY{p}{(}\PY{n}{alpha}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior mean and standard deviation}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        alpha : array, grid of alpha values}
\PY{l+s+sd}{        posterior : array, posterior distribution of alpha}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        mu\PYZus{}post : float, posterior mean}
\PY{l+s+sd}{        sigma\PYZus{}post : float, posterior standard deviation}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compute the posterior mean and standard deviation}
    \PY{n}{pdf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n+nb}{float}\PY{p}{)}
    \PY{n}{pdf} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{alpha}\PY{p}{)}
    \PY{n}{mu\PYZus{}post} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{posterior}\PY{p}{)}
    \PY{n}{sigma\PYZus{}post} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{posterior}\PY{p}{)}
    \PY{k}{return} \PY{n}{mu\PYZus{}post}\PY{p}{,} \PY{n}{sigma\PYZus{}post}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{integrate}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{cumulative\PYZus{}trapezoid}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{compute\PYZus{}percentile}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{pdf}\PY{p}{,} \PY{n}{percentiles} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the percentile of a distribution given its PDF}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x : array, grid of x values}
\PY{l+s+sd}{        pdf : array, probability density function values corresponding to x}
\PY{l+s+sd}{        percent : float, desired percentile (0\PYZhy{}100)}
\PY{l+s+sd}{    Returns: array of percentile values}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{cdf} \PY{o}{=} \PY{n}{cumulative\PYZus{}trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{initial} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{cdf} \PY{o}{/}\PY{o}{=} \PY{n}{cdf}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{c+c1}{\PYZsh{} Normalize to make it a proper CDF}
    \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{interp}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{percentiles}\PY{p}{)} \PY{o}{/} \PY{l+m+mi}{100}\PY{p}{,} \PY{n}{cdf}\PY{p}{,} \PY{n}{x}\PY{p}{)}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}summary\PYZus{}percentile}\PY{p}{(}\PY{n}{alpha}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{:}
    \PY{n}{pdf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n+nb}{float}\PY{p}{)}
    \PY{n}{pdf} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{alpha}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compute the median and 16\PYZhy{}84 percentiles}
    \PY{c+c1}{\PYZsh{} compute percentiles using the PDF and alpha grid}
    \PY{n}{p16}\PY{p}{,} \PY{n}{median}\PY{p}{,} \PY{n}{p84} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}
        \PY{n}{alpha}\PY{p}{,}
        \PY{n}{pdf}\PY{p}{,}
        \PY{n}{percentiles} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}
    \PY{p}{)}
    \PY{k}{return} \PY{n}{median}\PY{p}{,} \PY{n}{p16}\PY{p}{,} \PY{n}{p84}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{alpha\PYZus{}post\PYZus{}mean} \PY{o}{=} \PY{p}{[}\PY{p}{]} \PY{c+c1}{\PYZsh{} Store posterior means}
\PY{n}{alpha\PYZus{}post\PYZus{}std} \PY{o}{=} \PY{p}{[}\PY{p}{]} \PY{c+c1}{\PYZsh{} Store posterior standard deviations}
\PY{n}{alpha\PYZus{}post\PYZus{}median} \PY{o}{=} \PY{p}{[}\PY{p}{]} \PY{c+c1}{\PYZsh{} Store posterior medians}
\PY{n}{alpha\PYZus{}post\PYZus{}half16\PYZus{}84} \PY{o}{=} \PY{p}{[}\PY{p}{]} \PY{c+c1}{\PYZsh{} Store half of the 16\PYZhy{}84 percentile intervals}

\PY{c+c1}{\PYZsh{} Compute summary statistics for each posterior distribution}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{n} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{nflash}\PY{p}{)}\PY{p}{:}
    \PY{n}{mu\PYZus{}post}\PY{p}{,} \PY{n}{sigma\PYZus{}post} \PY{o}{=} \PY{n}{posterior\PYZus{}summary\PYZus{}moment}\PY{p}{(}\PY{n}{alpha\PYZus{}grid}\PY{p}{,} \PY{n}{posteriors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
    \PY{n}{median}\PY{p}{,} \PY{n}{p16}\PY{p}{,} \PY{n}{p84} \PY{o}{=} \PY{n}{posterior\PYZus{}summary\PYZus{}percentile}\PY{p}{(}\PY{n}{alpha\PYZus{}grid}\PY{p}{,} \PY{n}{posteriors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
    \PY{n}{alpha\PYZus{}post\PYZus{}mean}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{mu\PYZus{}post}\PY{p}{)}
    \PY{n}{alpha\PYZus{}post\PYZus{}std}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sigma\PYZus{}post}\PY{p}{)}
    \PY{n}{alpha\PYZus{}post\PYZus{}median}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{median}\PY{p}{)}
    \PY{n}{alpha\PYZus{}post\PYZus{}half16\PYZus{}84}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{p84} \PY{o}{\PYZhy{}} \PY{n}{p16}\PY{p}{)} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{16}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
\PY{n}{ax} \PY{o}{=} \PY{p}{[}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{]}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot the posterior means and standard deviations as a function of N\PYZus{}flash}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}
    \PY{n}{nflash}\PY{p}{,}
    \PY{n}{alpha\PYZus{}post\PYZus{}mean}\PY{p}{,}
    \PY{n}{yerr} \PY{o}{=} \PY{n}{alpha\PYZus{}post\PYZus{}std}\PY{p}{,}
    \PY{n}{fmt} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{capsize} \PY{o}{=} \PY{l+m+mi}{3}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mu\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm post\PYZcb{} }\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{pm }\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm post\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{nflash}\PY{p}{,}
    \PY{n}{alpha\PYZus{}post\PYZus{}std}\PY{p}{,}
    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm post\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to overlay the 1/sqrt(N\PYZus{}flash) line and set axes scales and ranges}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k}{for} \PY{n}{a} \PY{o+ow}{in} \PY{n}{ax}\PY{p}{:}
    \PY{n}{a}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}

\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mu\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm post\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm post\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}N\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm flash\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_15_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{17}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compare the median and half of the 16\PYZhy{}84 percentile }
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
\PY{n}{ax} \PY{o}{=} \PY{p}{[}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{]}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}
    \PY{n}{nflash}\PY{p}{,}
    \PY{n}{alpha\PYZus{}post\PYZus{}median}\PY{p}{,}
    \PY{n}{yerr} \PY{o}{=} \PY{n}{alpha\PYZus{}post\PYZus{}half16\PYZus{}84}\PY{p}{,}
    \PY{n}{fmt} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{capsize} \PY{o}{=} \PY{l+m+mi}{4}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median \PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{pm\PYZdl{} \PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{frac}\PY{l+s+si}{\PYZob{}1\PYZcb{}}\PY{l+s+si}{\PYZob{}2\PYZcb{}}\PY{l+s+s1}{(16}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZhy{}84}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}

\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{nflash}\PY{p}{,}
    \PY{n}{alpha\PYZus{}post\PYZus{}half16\PYZus{}84}\PY{p}{,}
    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{frac}\PY{l+s+si}{\PYZob{}1\PYZcb{}}\PY{l+s+si}{\PYZob{}2\PYZcb{}}\PY{l+s+s1}{(16}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZhy{}84}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}

\PY{n}{trend} \PY{o}{=} \PY{l+m+mi}{1} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{nflash}\PY{p}{)}

\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
    \PY{n}{nflash}\PY{p}{,}
    \PY{n}{trend}\PY{p}{,}
    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{propto 1/}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sqrt}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{N\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm flash\PYZcb{}\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xscale}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{log}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}

\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Half interval}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}N\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm flash\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_16_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{Exercise 2: Source
brightness}\label{exercise-2-source-brightness}

A steady source has a true flux
\(\phi = 5\,{\rm photon}\,{\rm s}^{-1}\). We observe photon counts \(n\)
in exposures of duration \(t\). The counts are Poisson distributed with
mean \(\phi t\):

\[
n \sim \text{Poisson}(\phi t) = \frac{(\phi t)^{n} e^{-\phi t}}{n!}.
\]

\paragraph{Question 2.1: Flux inference with simulated
data}\label{question-2.1-flux-inference-with-simulated-data}

\textbf{Tasks:} 1. For each exposure time
\(t \in \{0.5, 2, 10\}\,{\rm s}\), simulate \(N=10\) independent
observations of photon counts \(n\) from the source. 2. For each
exposure time, compute the posterior distribution of the flux \(\phi\)
with a flat prior in the range \([0.1, 20]\). Plot the posterior
distributions and report the posterior means, standard deviations, and
16-50-84 percentiles.

\textbf{Hints:} 1. Compute the likelihood function on a grid of \(\phi\)
values based on the Poisson formula above. 2. It may be easier to work
with the log-likelihood and log-posterior functions.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}photon\PYZus{}counts}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{phi}\PY{p}{,} \PY{n}{exposure\PYZus{}time}\PY{p}{,} \PY{n}{seed} \PY{o}{=} \PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Simulate photon counts from a Poisson distribution}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        num : int, number of observations}
\PY{l+s+sd}{        phi : float, true Poisson rate}
\PY{l+s+sd}{        exposure\PYZus{}time : float, exposure time for each observation}
\PY{l+s+sd}{        seed : int, random seed for reproducibility (default: 42)}
\PY{l+s+sd}{    Returns: array of photon counts}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{n}{counts} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{poisson}\PY{p}{(}\PY{n}{lam} \PY{o}{=} \PY{n}{phi} \PY{o}{*} \PY{n}{exposure\PYZus{}time}\PY{p}{,} \PY{n}{size} \PY{o}{=} \PY{n}{num}\PY{p}{)}
    \PY{k}{return} \PY{n}{counts}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}flux}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{exposure\PYZus{}time}\PY{p}{,} \PY{n}{prior\PYZus{}range} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of the Poisson rate phi given the data.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data : array, observed photon counts}
\PY{l+s+sd}{        exposure\PYZus{}time : float, exposure time for each observation}
\PY{l+s+sd}{        prior\PYZus{}range : tuple, (min, max) range for the flat prior (default: (0.1, 20))}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        phi : array, grid of phi values}
\PY{l+s+sd}{        posterior : array, posterior distribution of phi}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{phi} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}
    \PY{n}{n\PYZus{}expected} \PY{o}{=} \PY{n}{phi} \PY{o}{*} \PY{n}{exposure\PYZus{}time}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compute the Poisson likelihood; note that the factorial term can be ignored for the posterior calculation as we will normalize later}
    \PY{n}{loglike} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}
        \PY{n}{data}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}expected}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{n\PYZus{}expected}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{,}
        \PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}
    \PY{p}{)}

    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{loglike} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{loglike}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{} Subtract max for numerical stability}
    \PY{k}{return} \PY{n}{phi}\PY{p}{,} \PY{n}{posterior} \PY{o}{/} \PY{n}{posterior}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{} Normalize posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{38}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Simulate photon counts}
\PY{n}{num\PYZus{}samples} \PY{o}{=} \PY{l+m+mi}{10}
\PY{n}{phi\PYZus{}true} \PY{o}{=} \PY{l+m+mf}{5.0}
\PY{n}{exposure\PYZus{}times} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{]} \PY{c+c1}{\PYZsh{} Different exposure times}

\PY{n}{photon\PYZus{}data} \PY{o}{=} \PY{p}{[}
    \PY{n}{sim\PYZus{}photon\PYZus{}counts}\PY{p}{(}\PY{n}{num\PYZus{}samples}\PY{p}{,} \PY{n}{phi\PYZus{}true}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{seed} \PY{o}{=} \PY{n}{seed}\PY{p}{)} \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{exposure\PYZus{}times}
\PY{p}{]}

\PY{c+c1}{\PYZsh{} Compute posterior distributions for different exposure times}
\PY{n}{posteriors\PYZus{}flat} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{k}{for} \PY{n}{data}\PY{p}{,} \PY{n}{exp\PYZus{}time} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{photon\PYZus{}data}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{:}
    \PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{posterior} \PY{o}{=} \PY{n}{posterior\PYZus{}flux}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{exp\PYZus{}time}\PY{p}{)}
    \PY{n}{posteriors\PYZus{}flat}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to plot the posterior distributions for different exposure times using the flat prior, and compute summary statistics}
\PY{c+c1}{\PYZsh{} Plot posterior distributions (flat prior) and compute summary statistics}
\PY{n}{phi\PYZus{}means} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}stds} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}p16} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}p50} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}p84} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{p}{(}\PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{,} \PY{n}{t} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{posteriors\PYZus{}flat}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{:}
    \PY{n}{pdf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n+nb}{float}\PY{p}{)}
    \PY{n}{pdf} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{phi\PYZus{}grid}\PY{p}{)} \PY{c+c1}{\PYZsh{} ensure proper normalization on grid}

    \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{pdf}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{t}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{ s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{n}{mu} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{phi\PYZus{}grid} \PY{o}{*} \PY{n}{pdf}\PY{p}{,} \PY{n}{phi\PYZus{}grid}\PY{p}{)}
    \PY{n}{var} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{phi\PYZus{}grid} \PY{o}{\PYZhy{}} \PY{n}{mu}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{pdf}\PY{p}{,} \PY{n}{phi\PYZus{}grid}\PY{p}{)}
    \PY{n}{sigma} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var}\PY{p}{)}

    \PY{n}{p16}\PY{p}{,} \PY{n}{p50}\PY{p}{,} \PY{n}{p84} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}
        \PY{n}{phi\PYZus{}grid}\PY{p}{,}
        \PY{n}{pdf}\PY{p}{,}
        \PY{n}{percentiles} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}
    \PY{p}{)}

    \PY{n}{phi\PYZus{}means}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{mu}\PY{p}{)}
    \PY{n}{phi\PYZus{}stds}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sigma}\PY{p}{)}
    \PY{n}{phi\PYZus{}p16}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{p16}\PY{p}{)}
    \PY{n}{phi\PYZus{}p50}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{p50}\PY{p}{)}
    \PY{n}{phi\PYZus{}p84}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{p84}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}
    \PY{n}{phi\PYZus{}true}\PY{p}{,}
    \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{linestyle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm true\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{n}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print summary statistics}
\PY{k}{for} \PY{n}{t}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{n}{sigma}\PY{p}{,} \PY{n}{p16}\PY{p}{,} \PY{n}{p50}\PY{p}{,} \PY{n}{p84} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}
    \PY{n}{exposure\PYZus{}times}\PY{p}{,}\PY{n}{phi\PYZus{}means}\PY{p}{,} \PY{n}{phi\PYZus{}stds}\PY{p}{,} \PY{n}{phi\PYZus{}p16}\PY{p}{,} \PY{n}{phi\PYZus{}p50}\PY{p}{,} \PY{n}{phi\PYZus{}p84}
\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{t}\PY{l+s+si}{:}\PY{l+s+s2}{\PYZgt{}4}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ s : mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_20_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
t =  0.5 s : mean = 6.600, std = 1.149, 16-50-84 = [5.462, 6.533, 7.736]
t =    2 s : mean = 4.700, std = 0.485, 16-50-84 = [4.218, 4.683, 5.181]
t =   10 s : mean = 5.010, std = 0.224, 16-50-84 = [4.787, 5.007, 5.233]
    \end{Verbatim}

    \paragraph{Question 2.2: Inference with Jeffreys'
prior}\label{question-2.2-inference-with-jeffreys-prior}

The Jeffreys' prior for the Poisson rate \(\phi\) is given by
\(p(\phi) \propto 1/\sqrt{\phi}\).

\textbf{Tasks:} 1. Repeat Question 2.1 using the Jeffreys' prior instead
of the flat prior in the range \([0.1, 20]\). 2. Overplot the posterior
distributions obtained with the flat prior and the Jeffreys' prior for
each exposure time, and compare the summary statistics (means, standard
deviations, percentiles).

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{40}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}flux\PYZus{}jeffreys\PYZus{}prior}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{exposure\PYZus{}time}\PY{p}{,} \PY{n}{prior\PYZus{}range} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of the Poisson rate phi given the data using Jeffreys\PYZsq{} prior.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data : array, observed photon counts}
\PY{l+s+sd}{        exposure\PYZus{}time : float, exposure time for each observation}
\PY{l+s+sd}{        prior\PYZus{}range : tuple, (min, max) range for the Jeffreys\PYZsq{} prior (default: (0.1, 20))}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        phi : array, grid of phi values}
\PY{l+s+sd}{        posterior : array, posterior distribution of phi}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{phi} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}
    \PY{n}{n\PYZus{}expected} \PY{o}{=} \PY{n}{phi} \PY{o}{*} \PY{n}{exposure\PYZus{}time}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to compute the Poisson likelihood; note that the factorial term can be ignored for the posterior calculation as we will normalize later}
    \PY{n}{loglike} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}
        \PY{n}{data}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}expected}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{n\PYZus{}expected}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{,}
        \PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}
    \PY{p}{)}

    \PY{c+c1}{\PYZsh{} Jeffreys\PYZsq{} prior: p(phi) propto 1/sqrt(phi)}
    \PY{n}{logprior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{phi}\PY{p}{)}

    \PY{n}{logpost} \PY{o}{=} \PY{n}{loglike} \PY{o}{+} \PY{n}{logprior}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logpost} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{} Subtract max for numerical stability}
    \PY{k}{return} \PY{n}{phi}\PY{p}{,} \PY{n}{posterior} \PY{o}{/} \PY{n}{posterior}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{} Normalize posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{41}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to plot the posterior distributions and compute summary statistics}
\PY{n}{posteriors} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{k}{for} \PY{n}{data}\PY{p}{,} \PY{n}{exp\PYZus{}time} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{photon\PYZus{}data}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{:}
    \PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{posterior} \PY{o}{=} \PY{n}{posterior\PYZus{}flux\PYZus{}jeffreys\PYZus{}prior}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{exp\PYZus{}time}\PY{p}{)}
    \PY{n}{posteriors}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Plot posterior distributions (Jeffreys\PYZsq{} prior) and compute summary statistics}
\PY{n}{phi\PYZus{}means} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}stds} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}p16} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}p50} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{phi\PYZus{}p84} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{p}{(}\PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{,} \PY{n}{t} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{posteriors}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{:}
    \PY{n}{pdf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n+nb}{float}\PY{p}{)}
    \PY{n}{pdf} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{phi\PYZus{}grid}\PY{p}{)}

    \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{phi\PYZus{}grid}\PY{p}{,} \PY{n}{pdf}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{t}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{ s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{n}{mu} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{phi\PYZus{}grid} \PY{o}{*} \PY{n}{pdf}\PY{p}{,} \PY{n}{phi\PYZus{}grid}\PY{p}{)}
    \PY{n}{var} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{phi\PYZus{}grid} \PY{o}{\PYZhy{}} \PY{n}{mu}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{pdf}\PY{p}{,} \PY{n}{phi\PYZus{}grid}\PY{p}{)}
    \PY{n}{sigma} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var}\PY{p}{)}

    \PY{n}{p16}\PY{p}{,} \PY{n}{p50}\PY{p}{,} \PY{n}{p84} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}
        \PY{n}{phi\PYZus{}grid}\PY{p}{,}
        \PY{n}{pdf}\PY{p}{,}
        \PY{n}{percentiles} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}
    \PY{p}{)}

    \PY{n}{phi\PYZus{}means}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{mu}\PY{p}{)}
    \PY{n}{phi\PYZus{}stds}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sigma}\PY{p}{)}
    \PY{n}{phi\PYZus{}p16}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{p16}\PY{p}{)}
    \PY{n}{phi\PYZus{}p50}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{p50}\PY{p}{)}
    \PY{n}{phi\PYZus{}p84}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{p84}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}
    \PY{n}{phi\PYZus{}true}\PY{p}{,}
    \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{linestyle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{n}{label} \PY{o}{=} \PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm true\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{n}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print summary statistics}
\PY{k}{for} \PY{n}{t}\PY{p}{,} \PY{n}{mu}\PY{p}{,} \PY{n}{sigma}\PY{p}{,} \PY{n}{p16}\PY{p}{,} \PY{n}{p50}\PY{p}{,} \PY{n}{p84} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}
    \PY{n}{exposure\PYZus{}times}\PY{p}{,} \PY{n}{phi\PYZus{}means}\PY{p}{,} \PY{n}{phi\PYZus{}stds}\PY{p}{,} \PY{n}{phi\PYZus{}p16}\PY{p}{,} \PY{n}{phi\PYZus{}p50}\PY{p}{,} \PY{n}{phi\PYZus{}p84}
\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}
        \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{t}\PY{l+s+si}{:}\PY{l+s+s2}{\PYZgt{}4}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ s : mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}
    \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_23_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
t =  0.5 s : mean = 6.500, std = 1.140, 16-50-84 = [5.371, 6.433, 7.627]
t =    2 s : mean = 4.675, std = 0.483, 16-50-84 = [4.195, 4.658, 5.155]
t =   10 s : mean = 5.005, std = 0.224, 16-50-84 = [4.782, 5.002, 5.228]
    \end{Verbatim}

    \paragraph{Question 2.3: Inference with Gaussian
likelihood}\label{question-2.3-inference-with-gaussian-likelihood}

In reality the photon counts may not be from a single source, but from
foreground contamination or background noise. In this case, a practical
approach is to estimate the error on the counts using the observed
counts \(n_i\) as an approximation of the true mean \(\phi t\). This
leads to a Gaussian likelihood for \(\phi\):

\[ p(n_i | \phi) \propto \exp\left(-\frac{(n_i - \phi t)^2}{2 \sigma_i^2}\right) \]

where \(\sigma_i = \sqrt{n_i}\).

\textbf{Tasks:} 1. Compute the posterior distribution for \(\phi\) using
the Gaussian likelihood. Set \(\sigma_i^2 = \max(n_i, 1)\) to avoid
division by zero when \(n_i = 0\). 2. Try both the flat prior and the
Jeffreys' prior, and compare the results with those from Questions 2.1
and 2.2. 3. Discuss your observations for all the questions in this
exercise.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{49}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}flux\PYZus{}gauss\PYZus{}like}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{exposure\PYZus{}time}\PY{p}{,} \PY{n}{prior\PYZus{}type} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prior\PYZus{}range} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{,} \PY{n}{gauss\PYZus{}prior\PYZus{}params} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{n\PYZus{}phi} \PY{o}{=} \PY{l+m+mi}{1000}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Gaussian\PYZhy{}likelihood posterior for phi.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data : array\PYZhy{}like, observed photon counts n\PYZus{}i}
\PY{l+s+sd}{        exposure\PYZus{}time : float, exposure time t (same for all observations)}
\PY{l+s+sd}{        prior\PYZus{}type : \PYZsq{}flat\PYZsq{} | \PYZsq{}jeffreys\PYZsq{} | \PYZsq{}gaussian\PYZsq{}}
\PY{l+s+sd}{        prior\PYZus{}range : (min, max) for phi grid}
\PY{l+s+sd}{        gauss\PYZus{}prior\PYZus{}params : dict \PYZob{}\PYZsq{}mu\PYZsq{},\PYZsq{}sigma\PYZsq{}\PYZcb{} for optional gaussian prior on phi}
\PY{l+s+sd}{        n\PYZus{}phi : int, number of grid points for phi}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        phi : array, phi grid}
\PY{l+s+sd}{        posterior : array, normalized posterior on grid}
\PY{l+s+sd}{    Notes:}
\PY{l+s+sd}{        Uses sigma\PYZus{}i\PYZca{}2 = max(n\PYZus{}i, 1) to avoid zero\PYZhy{}variance.}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{phi} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}phi}\PY{p}{)}
    \PY{n}{mu} \PY{o}{=} \PY{n}{phi} \PY{o}{*} \PY{n}{exposure\PYZus{}time}  \PY{c+c1}{\PYZsh{} shape (M,)}
    \PY{n}{n} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{data}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} avoid zero counts causing sigma=0}
    \PY{n}{sigma2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{n}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{)}  \PY{c+c1}{\PYZsh{} shape (N,)}
    \PY{c+c1}{\PYZsh{} squared residuals: shape (N, M)}
    \PY{n}{resid2} \PY{o}{=} \PY{p}{(}\PY{n}{n}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{mu}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{c+c1}{\PYZsh{} Gaussian log\PYZhy{}likelihood (include normalization term for correctness)}
    \PY{c+c1}{\PYZsh{} log L = \PYZhy{}0.5 * sum\PYZus{}i [ resid2 / sigma2 + log(2π sigma2) ]}
    \PY{n}{loglike} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid2} \PY{o}{/} \PY{n}{sigma2}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{n}{sigma2}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} priors}
    \PY{k}{if} \PY{n}{prior\PYZus{}type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
        \PY{n}{logprior} \PY{o}{=} \PY{l+m+mf}{0.0}
    \PY{k}{elif} \PY{n}{prior\PYZus{}type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} Jeffreys prior for Poisson rate phi \PYZti{} 1/sqrt(phi)}
        \PY{c+c1}{\PYZsh{} Guard against phi \PYZlt{}= 0 (grid starts at \PYZgt{}0)}
        \PY{n}{logprior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{phi}\PY{p}{)}
    \PY{k}{elif} \PY{n}{prior\PYZus{}type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gaussian}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
        \PY{k}{if} \PY{n}{gauss\PYZus{}prior\PYZus{}params} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
            \PY{n}{mu0} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{gauss\PYZus{}prior\PYZus{}params}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mf}{0.5} \PY{o}{*} \PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
            \PY{n}{sigma0} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{gauss\PYZus{}prior\PYZus{}params}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sigma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mf}{0.25} \PY{o}{*} \PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{n}{mu0} \PY{o}{=} \PY{l+m+mf}{0.5} \PY{o}{*} \PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{+} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
            \PY{n}{sigma0} \PY{o}{=} \PY{l+m+mf}{0.25} \PY{o}{*} \PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
        \PY{n}{logprior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{p}{(}\PY{p}{(}\PY{n}{phi} \PY{o}{\PYZhy{}} \PY{n}{mu0}\PY{p}{)} \PY{o}{/} \PY{n}{sigma0}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{sigma0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Invalid prior\PYZus{}type. Choose }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{flat}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{jeffreys}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ or }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{gaussian}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{n}{logpost} \PY{o}{=} \PY{n}{loglike} \PY{o}{+} \PY{n}{logprior}
    \PY{n}{logpost} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}  \PY{c+c1}{\PYZsh{} stability}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{phi}\PY{p}{)}
    \PY{k}{return} \PY{n}{phi}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{54}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to plot the posterior distributions and compute summary statistics}
\PY{c+c1}{\PYZsh{} Helper: compare Gaussian vs Poisson posteriors (flat \PYZam{} Jeffreys) and print stats}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{compare\PYZus{}posteriors\PYZus{}gauss\PYZus{}vs\PYZus{}poisson}\PY{p}{(}\PY{n}{photon\PYZus{}data}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{,} \PY{n}{phi\PYZus{}true} \PY{o}{=} \PY{l+m+mf}{5.0}\PY{p}{,} \PY{n}{prior\PYZus{}range} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute and plot posteriors for each exposure time:}
\PY{l+s+sd}{       \PYZhy{} Poisson flat (posterior\PYZus{}flux)}
\PY{l+s+sd}{       \PYZhy{} Poisson Jeffreys (posterior\PYZus{}flux\PYZus{}jeffreys\PYZus{}prior)}
\PY{l+s+sd}{       \PYZhy{} Gaussian flat (posterior\PYZus{}flux\PYZus{}gauss\PYZus{}like)}
\PY{l+s+sd}{       \PYZhy{} Gaussian Jeffreys (posterior\PYZus{}flux\PYZus{}gauss\PYZus{}like with prior\PYZus{}type=\PYZsq{}jeffreys\PYZsq{})}
\PY{l+s+sd}{    Assumes posterior\PYZus{}flux and posterior\PYZus{}flux\PYZus{}jeffreys\PYZus{}prior exist in namespace.}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{photon\PYZus{}data}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} Poisson flat}
        \PY{n}{phi\PYZus{}p\PYZus{}flat}\PY{p}{,} \PY{n}{post\PYZus{}p\PYZus{}flat} \PY{o}{=} \PY{n}{posterior\PYZus{}flux}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{n}{prior\PYZus{}range}\PY{p}{)}
        \PY{n}{phi\PYZus{}p\PYZus{}flat} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{phi\PYZus{}p\PYZus{}flat}\PY{p}{)}
        \PY{n}{pdf\PYZus{}p\PYZus{}flat} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{post\PYZus{}p\PYZus{}flat}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
        \PY{n}{pdf\PYZus{}p\PYZus{}flat} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf\PYZus{}p\PYZus{}flat}\PY{p}{,} \PY{n}{phi\PYZus{}p\PYZus{}flat}\PY{p}{)}

        \PY{c+c1}{\PYZsh{} Poisson Jeffreys}
        \PY{n}{phi\PYZus{}p\PYZus{}j}\PY{p}{,} \PY{n}{post\PYZus{}p\PYZus{}j} \PY{o}{=} \PY{n}{posterior\PYZus{}flux\PYZus{}jeffreys\PYZus{}prior}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{n}{prior\PYZus{}range}\PY{p}{)}
        \PY{n}{phi\PYZus{}p\PYZus{}j} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{phi\PYZus{}p\PYZus{}j}\PY{p}{)}
        \PY{n}{pdf\PYZus{}p\PYZus{}j} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{post\PYZus{}p\PYZus{}j}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
        \PY{n}{pdf\PYZus{}p\PYZus{}j} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf\PYZus{}p\PYZus{}j}\PY{p}{,} \PY{n}{phi\PYZus{}p\PYZus{}j}\PY{p}{)}

        \PY{c+c1}{\PYZsh{} Gaussian flat}
        \PY{n}{phi\PYZus{}g\PYZus{}flat}\PY{p}{,} \PY{n}{post\PYZus{}g\PYZus{}flat} \PY{o}{=} \PY{n}{posterior\PYZus{}flux\PYZus{}gauss\PYZus{}like}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{prior\PYZus{}type}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{n}{prior\PYZus{}range}\PY{p}{)}
        \PY{n}{pdf\PYZus{}g\PYZus{}flat} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{post\PYZus{}g\PYZus{}flat}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
        \PY{n}{pdf\PYZus{}g\PYZus{}flat} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf\PYZus{}g\PYZus{}flat}\PY{p}{,} \PY{n}{phi\PYZus{}g\PYZus{}flat}\PY{p}{)}

        \PY{c+c1}{\PYZsh{} Gaussian Jeffreys}
        \PY{n}{phi\PYZus{}g\PYZus{}j}\PY{p}{,} \PY{n}{post\PYZus{}g\PYZus{}j} \PY{o}{=} \PY{n}{posterior\PYZus{}flux\PYZus{}gauss\PYZus{}like}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{prior\PYZus{}type}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{n}{prior\PYZus{}range}\PY{p}{)}
        \PY{n}{pdf\PYZus{}g\PYZus{}j} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{post\PYZus{}g\PYZus{}j}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
        \PY{n}{pdf\PYZus{}g\PYZus{}j} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf\PYZus{}g\PYZus{}j}\PY{p}{,} \PY{n}{phi\PYZus{}g\PYZus{}j}\PY{p}{)}

        \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{phi\PYZus{}p\PYZus{}flat}\PY{p}{,} \PY{n}{pdf\PYZus{}p\PYZus{}flat}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Poisson flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{phi\PYZus{}p\PYZus{}j}\PY{p}{,} \PY{n}{pdf\PYZus{}p\PYZus{}j}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Poisson Jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{phi\PYZus{}g\PYZus{}flat}\PY{p}{,} \PY{n}{pdf\PYZus{}g\PYZus{}flat}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gaussian flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{phi\PYZus{}g\PYZus{}j}\PY{p}{,} \PY{n}{pdf\PYZus{}g\PYZus{}j}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gaussian Jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{phi\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm true\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{if} \PY{n}{i}\PY{o}{==}\PY{l+m+mi}{0} \PY{k}{else} \PY{k+kc}{None}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{n}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{if} \PY{n}{i} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{exposure\PYZus{}times}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{:}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{phi\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{if} \PY{n}{i} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{)}
        \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{t}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{ s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

    \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Print summaries (example: Gaussian vs Poisson flat means)}
    \PY{k}{for} \PY{n}{data}\PY{p}{,} \PY{n}{t} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{photon\PYZus{}data}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{)}\PY{p}{:}
        \PY{n}{phi\PYZus{}pf}\PY{p}{,} \PY{n}{pdf\PYZus{}pf} \PY{o}{=} \PY{n}{posterior\PYZus{}flux}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{n}{prior\PYZus{}range}\PY{p}{)}
        \PY{n}{phi\PYZus{}gf}\PY{p}{,} \PY{n}{pdf\PYZus{}gf} \PY{o}{=} \PY{n}{posterior\PYZus{}flux\PYZus{}gauss\PYZus{}like}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{prior\PYZus{}type}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{n}{prior\PYZus{}range}\PY{p}{)}
        \PY{n}{pdf\PYZus{}pf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{pdf\PYZus{}pf}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}\PY{p}{;} \PY{n}{pdf\PYZus{}pf} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf\PYZus{}pf}\PY{p}{,} \PY{n}{phi\PYZus{}pf}\PY{p}{)}
        \PY{n}{pdf\PYZus{}gf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{pdf\PYZus{}gf}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}\PY{p}{;} \PY{n}{pdf\PYZus{}gf} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf\PYZus{}gf}\PY{p}{,} \PY{n}{phi\PYZus{}gf}\PY{p}{)}
        \PY{n}{mu\PYZus{}pf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{phi\PYZus{}pf} \PY{o}{*} \PY{n}{pdf\PYZus{}pf}\PY{p}{,} \PY{n}{phi\PYZus{}pf}\PY{p}{)}\PY{p}{;} \PY{n}{sigma\PYZus{}pf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{phi\PYZus{}pf} \PY{o}{\PYZhy{}} \PY{n}{mu\PYZus{}pf}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{pdf\PYZus{}pf}\PY{p}{,} \PY{n}{phi\PYZus{}pf}\PY{p}{)}\PY{p}{)}
        \PY{n}{mu\PYZus{}gf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{phi\PYZus{}gf} \PY{o}{*} \PY{n}{pdf\PYZus{}gf}\PY{p}{,} \PY{n}{phi\PYZus{}gf}\PY{p}{)}\PY{p}{;} \PY{n}{sigma\PYZus{}gf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{phi\PYZus{}gf} \PY{o}{\PYZhy{}} \PY{n}{mu\PYZus{}gf}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{pdf\PYZus{}gf}\PY{p}{,} \PY{n}{phi\PYZus{}gf}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{t}\PY{l+s+si}{:}\PY{l+s+s2}{\PYZgt{}4}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ s : Poisson\PYZhy{}flat mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}pf}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ std=}\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}pf}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{  |  Gauss\PYZhy{}flat mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}gf}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ std=}\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}gf}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        
\PY{n}{compare\PYZus{}posteriors\PYZus{}gauss\PYZus{}vs\PYZus{}poisson}\PY{p}{(}\PY{n}{photon\PYZus{}data}\PY{p}{,} \PY{n}{exposure\PYZus{}times}\PY{p}{,} \PY{n}{phi\PYZus{}true} \PY{o}{=} \PY{l+m+mf}{5.0}\PY{p}{,} \PY{n}{prior\PYZus{}range} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_26_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
t =  0.5 s : Poisson-flat mean=6.600 std=1.149  |  Gauss-flat mean=4.461
std=0.945
t =    2 s : Poisson-flat mean=4.700 std=0.485  |  Gauss-flat mean=4.268
std=0.462
t =   10 s : Poisson-flat mean=5.010 std=0.224  |  Gauss-flat mean=4.904
std=0.221
    \end{Verbatim}

    \subparagraph{Discussions}\label{discussions}

数据量在很大的时候直接主导了整个后验的分布；在数据量不算很大的时候，先验有一定的作用.

    \subsubsection{Exercise 3: Inference of amplitude from
intensity}\label{exercise-3-inference-of-amplitude-from-intensity}

Suppose we are interested in the amplitude \(A\) of a signal, but we can
only measure its intensity \(I = A^2\). The measurement uncertainty on
\(I\) is Gaussian with standard deviation \(\sigma_I\).

\paragraph{Question 3.1: Posterior distribution of
amplitude}\label{question-3.1-posterior-distribution-of-amplitude}

\textbf{Tasks:} 1. Simulate \(N=10\) measurements of \(I\) with true
amplitude \(A_{\rm true} = 1\) and \(\sigma_I = 1.5\). Note that it does
not matter if some \(I\) values are negative due to noise; real
measurements can be negative after calibration. 2. Using the Jeffreys'
prior \(p(A) \propto |A|\) in the range \([-3, 3]\), compute the
posterior distribution of \(A\) based on the measurements of \(I\).
Assume \(\sigma_I\) is known. 3. Plot the posterior distribution of
\(A\), and compute the posterior mean, standard deviation, and 16-50-84
percentiles.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{55}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}intensity}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{l+m+mf}{1.5}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Simulate intensity measurements given amplitude A with Gaussian noise.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        num : int, number of measurements}
\PY{l+s+sd}{        A : float, true amplitude}
\PY{l+s+sd}{        sigma : float, standard deviation of Gaussian noise (default: 1.5)}
\PY{l+s+sd}{        seed : int, random seed for reproducibility (default: 42)}
\PY{l+s+sd}{    Returns: array of intensity measurements}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{n}{I\PYZus{}true} \PY{o}{=} \PY{n}{A}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{I\PYZus{}measured} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{n}{I\PYZus{}true}\PY{p}{,} \PY{n}{scale}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{num}\PY{p}{)}
    \PY{k}{return} \PY{n}{I\PYZus{}measured}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{59}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to implement the function for computing the posterior distribution of A given intensity measurements}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}amplitude\PYZus{}given\PYZus{}intensity}\PY{p}{(}\PY{n}{I\PYZus{}data}\PY{p}{,} \PY{n}{sigma\PYZus{}I}\PY{p}{,} \PY{n}{prior\PYZus{}type}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{nA}\PY{o}{=}\PY{l+m+mi}{2000}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute posterior p(A | \PYZob{}I\PYZus{}i\PYZcb{}) given intensity measurements with Gaussian noise.}
\PY{l+s+sd}{    Likelihood: I\PYZus{}i sim N(A\PYZca{}2, sigma\PYZus{}I\PYZca{}2)}
\PY{l+s+sd}{    Priors supported:}
\PY{l+s+sd}{      \PYZhy{} \PYZsq{}jeffreys\PYZsq{} : p(A) propto |A|  (on prior\PYZus{}range)}
\PY{l+s+sd}{      \PYZhy{} \PYZsq{}flat\PYZsq{}      : constant on prior\PYZus{}range}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        I\PYZus{}data : array\PYZhy{}like, measured intensities I\PYZus{}i}
\PY{l+s+sd}{        sigma\PYZus{}I : float or array\PYZhy{}like, measurement std (if scalar, applied to all)}
\PY{l+s+sd}{        prior\PYZus{}type : \PYZsq{}jeffreys\PYZsq{} or \PYZsq{}flat\PYZsq{}}
\PY{l+s+sd}{        prior\PYZus{}range : (min, max) range for A grid}
\PY{l+s+sd}{        nA : int, number of grid points for A}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        A : array, grid of A values}
\PY{l+s+sd}{        posterior : array, normalized posterior p(A|data) on the grid}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{I} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{I\PYZus{}data}\PY{p}{)}
    \PY{n}{A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{prior\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{nA}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} model predictions A\PYZca{}2 for each grid point}
    \PY{n}{A2} \PY{o}{=} \PY{n}{A}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}  \PY{c+c1}{\PYZsh{} shape (N\PYZus{}data, nA)}

    \PY{c+c1}{\PYZsh{} handle sigma\PYZus{}I}
    \PY{n}{sigma} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{sigma\PYZus{}I}\PY{p}{)}
    \PY{k}{if} \PY{n}{sigma}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n}{sigma2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{full}\PY{p}{(}\PY{n}{I}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{sigma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{sigma2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{sigma}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}

    \PY{c+c1}{\PYZsh{} Gaussian log\PYZhy{}likelihood (up to additive constant)}
    \PY{n}{resid2} \PY{o}{=} \PY{p}{(}\PY{n}{I}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{A2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{loglike} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid2} \PY{o}{/} \PY{n}{sigma2}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} prior}
    \PY{k}{if} \PY{n}{prior\PYZus{}type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} p(A) propto |A|  \PYZhy{}\PYZhy{}\PYZgt{} logprior = log(|A|)}
        \PY{c+c1}{\PYZsh{} add tiny epsilon to avoid log(0)}
        \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
        \PY{n}{logprior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{A}\PY{p}{)} \PY{o}{+} \PY{n}{eps}\PY{p}{)}
    \PY{k}{elif} \PY{n}{prior\PYZus{}type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{flat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
        \PY{n}{logprior} \PY{o}{=} \PY{l+m+mf}{0.0}
    \PY{k}{else}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{prior\PYZus{}type must be }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{jeffreys}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ or }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{flat}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{n}{logpost} \PY{o}{=} \PY{n}{loglike} \PY{o}{+} \PY{n}{logprior}
    \PY{n}{logpost} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}  \PY{c+c1}{\PYZsh{} numerical stability}
    \PY{n}{post} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}
    \PY{n}{post} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{post}\PY{p}{,} \PY{n}{A}\PY{p}{)}    \PY{c+c1}{\PYZsh{} normalize on grid}

    \PY{k}{return} \PY{n}{A}\PY{p}{,} \PY{n}{post}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{61}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Simulate intensity measurements}
\PY{n}{num\PYZus{}samples} \PY{o}{=} \PY{l+m+mi}{10}
\PY{n}{A\PYZus{}true} \PY{o}{=} \PY{l+m+mf}{1.0}
\PY{n}{sigma\PYZus{}I} \PY{o}{=} \PY{l+m+mf}{1.5}
\PY{n}{intensity\PYZus{}data} \PY{o}{=} \PY{n}{sim\PYZus{}intensity}\PY{p}{(}\PY{n}{num\PYZus{}samples}\PY{p}{,} \PY{n}{A\PYZus{}true}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{sigma\PYZus{}I}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{n}{seed}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to plot the posterior distributions and compute summary statistics}
\PY{c+c1}{\PYZsh{} Compute posterior for A (Jeffreys\PYZsq{} prior on [\PYZhy{}3, 3])}
\PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}A} \PY{o}{=} \PY{n}{posterior\PYZus{}amplitude\PYZus{}given\PYZus{}intensity}\PY{p}{(}\PY{n}{intensity\PYZus{}data}\PY{p}{,} \PY{n}{sigma\PYZus{}I}\PY{p}{,}
                                                     \PY{n}{prior\PYZus{}type}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jeffreys}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                     \PY{n}{prior\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,}
                                                     \PY{n}{nA}\PY{o}{=}\PY{l+m+mi}{2000}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Ensure normalization (function already normalizes, but be safe)}
\PY{n}{post\PYZus{}A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{post\PYZus{}A}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
\PY{n}{post\PYZus{}A} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{post\PYZus{}A}\PY{p}{,} \PY{n}{A\PYZus{}grid}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Posterior moments}
\PY{n}{mu\PYZus{}A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{A\PYZus{}grid} \PY{o}{*} \PY{n}{post\PYZus{}A}\PY{p}{,} \PY{n}{A\PYZus{}grid}\PY{p}{)}
\PY{n}{var\PYZus{}A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{A\PYZus{}grid} \PY{o}{\PYZhy{}} \PY{n}{mu\PYZus{}A}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{post\PYZus{}A}\PY{p}{,} \PY{n}{A\PYZus{}grid}\PY{p}{)}
\PY{n}{sigma\PYZus{}A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var\PYZus{}A}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Percentiles (16, 50, 84)}
\PY{n}{p16}\PY{p}{,} \PY{n}{p50}\PY{p}{,} \PY{n}{p84} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}\PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}A}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot posterior}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}A}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(A|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{I\PYZus{}i}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{A\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}A\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm true\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{mu\PYZus{}A}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{p50}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}A\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(A|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{I\PYZus{}i}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print summary statistics}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Posterior mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}A}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Posterior std  = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}A}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Percentiles 16/50/84 = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_31_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Posterior mean = -0.0000
Posterior std  = 1.5454
Percentiles 16/50/84 = [-1.6156, -0.0000, 1.6156]
    \end{Verbatim}

    \paragraph{Question 3.2: Inference of absolute
amplitude}\label{question-3.2-inference-of-absolute-amplitude}

\textbf{Tasks:} 1. Repeat Question 3.1 but infer the absolute amplitude
\(|A|\) instead of \(A\). Use the Jeffreys' prior \(p(|A|) \propto |A|\)
in the range \([0, 3]\). 2. Plot the posterior distribution of \(|A|\),
and compute the posterior mean, standard deviation, and 16-50-84
percentiles.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{64}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to implement the tasks}
\PY{c+c1}{\PYZsh{} Infer absolute amplitude |A| with Jeffreys\PYZsq{} prior p(|A|) ∝ |A| on [0, 3]}

\PY{c+c1}{\PYZsh{} Grid for |A|}
\PY{n}{r\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mf}{3.0}\PY{p}{,} \PY{l+m+mi}{2000}\PY{p}{)}
\PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}

\PY{c+c1}{\PYZsh{} Model: I\PYZus{}i sim N(r\PYZca{}2, sigma\PYZus{}I\PYZca{}2)}
\PY{n}{r2} \PY{o}{=} \PY{n}{r\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{I} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{intensity\PYZus{}data}\PY{p}{)}
\PY{c+c1}{\PYZsh{} sigma\PYZus{}I may be scalar}
\PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{ndim}\PY{p}{(}\PY{n}{sigma\PYZus{}I}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
    \PY{n}{sigma2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{full}\PY{p}{(}\PY{n}{I}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{sigma\PYZus{}I}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
\PY{k}{else}\PY{p}{:}
    \PY{n}{sigma2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{sigma\PYZus{}I}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}

\PY{c+c1}{\PYZsh{} Log\PYZhy{}likelihood (up to additive constant)}
\PY{n}{resid2} \PY{o}{=} \PY{p}{(}\PY{n}{I}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{r2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{loglike} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid2} \PY{o}{/} \PY{n}{sigma2}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Jeffreys\PYZsq{} prior for |A|: p(r) propto r  \PYZhy{}\PYZgt{} logprior = log(r)}
\PY{n}{logprior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{r\PYZus{}grid} \PY{o}{+} \PY{n}{eps}\PY{p}{)}

\PY{n}{logpost} \PY{o}{=} \PY{n}{loglike} \PY{o}{+} \PY{n}{logprior}
\PY{n}{logpost} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}
\PY{n}{post\PYZus{}r} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}
\PY{n}{post\PYZus{}r} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{post\PYZus{}r}\PY{p}{,} \PY{n}{r\PYZus{}grid}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Posterior moments}
\PY{n}{mu\PYZus{}r} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{r\PYZus{}grid} \PY{o}{*} \PY{n}{post\PYZus{}r}\PY{p}{,} \PY{n}{r\PYZus{}grid}\PY{p}{)}
\PY{n}{var\PYZus{}r} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{r\PYZus{}grid} \PY{o}{\PYZhy{}} \PY{n}{mu\PYZus{}r}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{post\PYZus{}r}\PY{p}{,} \PY{n}{r\PYZus{}grid}\PY{p}{)}
\PY{n}{sigma\PYZus{}r} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var\PYZus{}r}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Percentiles 16,50,84}
\PY{n}{p16\PYZus{}r}\PY{p}{,} \PY{n}{p50\PYZus{}r}\PY{p}{,} \PY{n}{p84\PYZus{}r} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}\PY{n}{r\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}r}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot posterior for |A|}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{r\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}r}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(|A|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mid}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{I\PYZus{}i}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{A\PYZus{}true}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}|A|\PYZus{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rm true\PYZcb{}\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{mu\PYZus{}r}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{p50\PYZus{}r}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}|A|\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(|A|}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mid}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{I\PYZus{}i}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print summary statistics}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Posterior mean (|A|) = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Posterior std  (|A|) = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Percentiles 16/50/84 (|A|) = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_33_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Posterior mean (|A|) = 1.5375
Posterior std  (|A|) = 0.1564
Percentiles 16/50/84 (|A|) = [1.3844, 1.5454, 1.6912]
    \end{Verbatim}

    \paragraph{Question 3.3: Infer the intensity
directly}\label{question-3.3-infer-the-intensity-directly}

We can also infer the intensity \(I\) directly from the measurements.
The Jeffreys' prior for \(I\) is flat: \(p(I)\) is constant.

\textbf{Tasks:} 1. Infer the intensity \(I\) directly from the
measurements using a flat prior on \(I\) in the range \([0, 9]\). 2.
Plot the posterior distribution of \(I\), and compute the posterior
mean, standard deviation, and 16-50-84 percentiles. 3. Convert the
summary statistics of \(I\) to those of \(\sqrt{I}\), and compare with
the results from Question 3.2. 4. Discuss your observations for all the
questions in this exercise.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT BELOW to implement the tasks}
\PY{c+c1}{\PYZsh{} Infer intensity I directly from the measurements using a flat prior on [0, 9]}

\PY{n}{I\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mf}{9.0}\PY{p}{,} \PY{l+m+mi}{2000}\PY{p}{)}
\PY{n}{I\PYZus{}obs} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{intensity\PYZus{}data}\PY{p}{)}
\PY{c+c1}{\PYZsh{} measurement variance (sigma\PYZus{}I defined earlier)}
\PY{n}{sigma2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{full}\PY{p}{(}\PY{n}{I\PYZus{}obs}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{sigma\PYZus{}I}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Log\PYZhy{}likelihood (up to additive constant)}
\PY{n}{resid2} \PY{o}{=} \PY{p}{(}\PY{n}{I\PYZus{}obs}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{I\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{loglike} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid2} \PY{o}{/} \PY{n}{sigma2}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} flat prior =\PYZgt{} logprior = 0}
\PY{n}{logpost} \PY{o}{=} \PY{n}{loglike}
\PY{n}{logpost} \PY{o}{\PYZhy{}}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{logpost}\PY{p}{)} \PY{c+c1}{\PYZsh{} numerical stability}
\PY{n}{post\PYZus{}I} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logpost}\PY{p}{)}
\PY{n}{post\PYZus{}I} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{I\PYZus{}grid}\PY{p}{)}  \PY{c+c1}{\PYZsh{} normalize}

\PY{c+c1}{\PYZsh{} Posterior moments for I}
\PY{n}{mu\PYZus{}I} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{I\PYZus{}grid} \PY{o}{*} \PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{I\PYZus{}grid}\PY{p}{)}
\PY{n}{var\PYZus{}I} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{I\PYZus{}grid} \PY{o}{\PYZhy{}} \PY{n}{mu\PYZus{}I}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{I\PYZus{}grid}\PY{p}{)}
\PY{n}{sigma\PYZus{}I\PYZus{}post} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var\PYZus{}I}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Percentiles for I (16, 50, 84)}
\PY{n}{p16\PYZus{}I}\PY{p}{,} \PY{n}{p50\PYZus{}I}\PY{p}{,} \PY{n}{p84\PYZus{}I} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}\PY{n}{I\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Convert summary statistics of I to those of sqrt(I)}
\PY{n}{sqrt\PYZus{}I\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{I\PYZus{}grid}\PY{p}{)}
\PY{n}{mu\PYZus{}sqrt\PYZus{}from\PYZus{}integral} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{sqrt\PYZus{}I\PYZus{}grid} \PY{o}{*} \PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{I\PYZus{}grid}\PY{p}{)}
\PY{n}{var\PYZus{}sqrt\PYZus{}from\PYZus{}integral} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{sqrt\PYZus{}I\PYZus{}grid} \PY{o}{\PYZhy{}} \PY{n}{mu\PYZus{}sqrt\PYZus{}from\PYZus{}integral}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{I\PYZus{}grid}\PY{p}{)}
\PY{n}{sigma\PYZus{}sqrt\PYZus{}from\PYZus{}integral} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var\PYZus{}sqrt\PYZus{}from\PYZus{}integral}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Convert percentiles by taking sqrt of intensity percentiles}
\PY{n}{p16\PYZus{}sqrt} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n}{p16\PYZus{}I}\PY{p}{,} \PY{l+m+mf}{0.0}\PY{p}{)}\PY{p}{)}
\PY{n}{p50\PYZus{}sqrt} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n}{p50\PYZus{}I}\PY{p}{,} \PY{l+m+mf}{0.0}\PY{p}{)}\PY{p}{)}
\PY{n}{p84\PYZus{}sqrt} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n}{p84\PYZus{}I}\PY{p}{,} \PY{l+m+mf}{0.0}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot posterior for I}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{I\PYZus{}grid}\PY{p}{,} \PY{n}{post\PYZus{}I}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(I}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mid}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{I\PYZus{}i}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{mu\PYZus{}I}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean (I)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{p50\PYZus{}I}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median (I)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{p16\PYZus{}I}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{16/84 percentiles (I)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{p84\PYZus{}I}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}I\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(I}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{mid}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZob{}}\PY{l+s+s1}{I\PYZus{}i}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{\PYZcb{})\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print results and compare with |A| results from Question 3.2 (mu\PYZus{}r, sigma\PYZus{}r, p16\PYZus{}r, p50\PYZus{}r, p84\PYZus{}r)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Posterior for I (flat prior on [0,9]):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  mean(I) = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}I}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std(I) = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}I\PYZus{}post}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  Percentiles I 16/50/84 = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16\PYZus{}I}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50\PYZus{}I}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84\PYZus{}I}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Converted to sqrt(I):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  mean(sqrt(I)) [integral] = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}sqrt\PYZus{}from\PYZus{}integral}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std(sqrt(I)) = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}sqrt\PYZus{}from\PYZus{}integral}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  Percentiles sqrt(I) from I\PYZhy{}percentiles = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16\PYZus{}sqrt}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50\PYZus{}sqrt}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84\PYZus{}sqrt}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Comparison with |A| inference (Question 3.2):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{  |A| posterior mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mu\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{sigma\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16/50/84 = [}\PY{l+s+si}{\PYZob{}}\PY{n}{p16\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p50\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, }\PY{l+s+si}{\PYZob{}}\PY{n}{p84\PYZus{}r}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Short discussion (can be expanded in the markdown cell)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Discussion summary:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} The posterior for I is directly obtained from the Gaussian likelihood; transforming to sqrt(I) }\PY{l+s+s2}{\PYZdq{}}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{via expectation gives mean/std that can be compared to the |A| posterior computed earlier.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} Percentiles converted by sqrt(percentile\PYZus{}I) are a simple nonlinear mapping; the mean/std of sqrt(I) }\PY{l+s+s2}{\PYZdq{}}
    \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{need to be computed by integration and may differ from sqrt(mean(I)).}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} Compare printed numbers to assess consistency between direct |A| inference and transform\PYZhy{}from\PYZhy{}I.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_04_files/Exercise_week_04_35_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Posterior for I (flat prior on [0,9]):
  mean(I) = 2.3883, std(I) = 0.4743
  Percentiles I 16/50/84 = [1.9166, 2.3883, 2.8600]

Converted to sqrt(I):
  mean(sqrt(I)) [integral] = 1.5375, std(sqrt(I)) = 0.1564
  Percentiles sqrt(I) from I-percentiles = [1.3844, 1.5454, 1.6912]

Comparison with |A| inference (Question 3.2):
  |A| posterior mean = 1.5375, std = 0.1564, 16/50/84 = [1.3844, 1.5454, 1.6912]

Discussion summary:
- The posterior for I is directly obtained from the Gaussian likelihood;
transforming to sqrt(I) via expectation gives mean/std that can be compared to
the |A| posterior computed earlier.
- Percentiles converted by sqrt(percentile\_I) are a simple nonlinear mapping;
the mean/std of sqrt(I) need to be computed by integration and may differ from
sqrt(mean(I)).
- Compare printed numbers to assess consistency between direct |A| inference and
transform-from-I.
    \end{Verbatim}

    \subparagraph{Discussions}\label{discussions}

在题目所给的这种情况下，中值估计和平均值估计的差别并不大，而且不同的先验对结果影响还是没有那么强；在有对称双峰的情况下，对绝对值做出估计能够使得均值估计和中值估计有更高的准确程度.

    \subsubsection{Note: steps for submitting the
exercise}\label{note-steps-for-submitting-the-exercise}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In the menu bar, select \texttt{File\ \textgreater{}\ Download} to
  download your notebook as a \texttt{.ipynb} file.
\item
  Select
  \texttt{File\ \textgreater{}\ Save\ and\ Export\ Notebook\ As\ \textgreater{}\ PDF}
  to export your notebook as a PDF file.
\item
  Combine the \texttt{.ipynb} and \texttt{.pdf} files into a single
  \texttt{.zip} or \texttt{.tar.gz} archive.
\item
  Upload your archive to the web learning platform (网络学堂).
\end{enumerate}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
