\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
\usepackage{ctex}
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \makeatletter
    \newsavebox\pandoc@box
    \newcommand*\pandocbounded[1]{%
      \sbox\pandoc@box{#1}%
      % scaling factors for width and height
      \Gscale@div\@tempa\textheight{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
      \Gscale@div\@tempb\linewidth{\wd\pandoc@box}%
      % select the smaller of both
      \ifdim\@tempb\p@<\@tempa\p@
        \let\@tempa\@tempb
      \fi
      % scaling accordingly (\@tempa < 1)
      \ifdim\@tempa\p@<\p@
        \scalebox{\@tempa}{\usebox\pandoc@box}%
      % scaling not needed, use as it is
      \else
        \usebox{\pandoc@box}%
      \fi
    }
    \makeatother

    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Exercise\_week\_06}
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \section{Statistical Methods in Astrophysics
Exercises}\label{statistical-methods-in-astrophysics-exercises}

\subsection{Week 06: Multivariate
Analysis}\label{week-06-multivariate-analysis}

\subsubsection{Personal Information}\label{personal-information}

\textbf{Name:} physnya

    \subsubsection{Exercise 1: spectral line
fitting}\label{exercise-1-spectral-line-fitting}

The expected photon counts of a galaxy spectrum are as follows (Gaussian
emission line plus constant background):

\(N_{\rm exp, 1} = A_1 \exp \left[ - \dfrac{(x - x_0)^2}{2 w_1^2} \right] + B_1\)

with \(x_0 = 0\), \(B_1=50\), and integer wavelengths
\(x \in [-25, 25]\) (51 bins).

\paragraph{Question 1.1: parameter
inference}\label{question-1.1-parameter-inference}

\textbf{Tasks:} 1. Simulate an observed spectrum with
\(A_1 = 50, w_1 = 5\), and compare it to the expected spectrum. 2. Infer
\(A_1\) and \(w_1\) from the simulated spectrum using scale-invariant
priors \(p(A_1,w_1|I) \propto 1 / (A_1 w_1)\) with the ranges
\(A_1 \in [10, 250]\) and \(w_1 \in [1, 25]\). 3. Plot the joint
posterior distributions of \(A_1\) and \(w_1\) as well as the
marginalized posterior distributions of each parameter. 4. Report the
mean, standard deviation, and 16-50-84 percentiles of the marginalized
posterior distributions, as well as the covariance matrix of the joint
posterior distribution.

\textbf{Hint:} The actual photon count of each bin follows a Poisson
distribution with the expected count as the mean.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{66}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: Run this cell in the first place}
\PY{c+c1}{\PYZsh{} Load packages for numerical calculations and plotting}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{numpy}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{np}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{integrate}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{cumulative\PYZus{}trapezoid}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{plt}
\PY{c+c1}{\PYZsh{} Enable inline plotting in Jupyter notebooks}
\PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.dpi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{300}
\PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\PY{n}{plt}\PY{o}{.}\PY{n}{rc}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{usetex} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{rc}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{family} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{serif}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} 由于设置了图片的高 dpi 和字体，所以编译速度变慢.}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{67}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{B}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Model (expected) photon counts of a galaxy spectrum with a Gaussian line plus constant background.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: array\PYZhy{}like, wavelengths}
\PY{l+s+sd}{        A: float, line amplitude}
\PY{l+s+sd}{        w: float, line width (standard deviation)}
\PY{l+s+sd}{        B: float, background level}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{    Return: numpy array, expected photon counts at each wavelength}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{n} \PY{o}{=} \PY{p}{[}\PY{n}{A} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}} \PY{p}{(}\PY{n}{xi} \PY{o}{\PYZhy{}} \PY{n}{x0}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{/} \PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{w}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)} \PY{o}{+} \PY{n}{B} \PY{k}{for} \PY{n}{xi} \PY{o+ow}{in} \PY{n}{x}\PY{p}{]}
    \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{n}\PY{p}{)}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}spec}\PY{p}{(}\PY{n}{A}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{B}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Simulate a galaxy spectrum with given background and line width.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        A: float, line amplitude}
\PY{l+s+sd}{        w: float, line width (standard deviation)}
\PY{l+s+sd}{        B: float, background level}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{        seed: int, random seed for reproducibility (default: 42)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        x: numpy array, wavelengths}
\PY{l+s+sd}{        n\PYZus{}obs: numpy array, observed photon counts at each wavelength}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{26}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}           \PY{c+c1}{\PYZsh{} Wavelengths from \PYZhy{}25 to 25}
    \PY{n}{N\PYZus{}exp} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{B}\PY{p}{,} \PY{n}{x0}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Expected photon counts}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{n}{n\PYZus{}obs} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{poisson}\PY{p}{(}\PY{n}{N\PYZus{}exp}\PY{p}{)}          \PY{c+c1}{\PYZsh{} Simulate observed counts from Poisson distribution}
    \PY{k}{return} \PY{n}{x}\PY{p}{,} \PY{n}{n\PYZus{}obs}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{68}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Set the random seed}
\PY{n}{seed} \PY{o}{=} \PY{l+m+mi}{2024011182}  \PY{c+c1}{\PYZsh{} NOTE: EDIT HERE to insert your seed as the seed}
\PY{n}{A1\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{50}
\PY{n}{w1\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{5}
\PY{n}{B1\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{50}

\PY{c+c1}{\PYZsh{} Simulate the spectrum}
\PY{n}{x}\PY{p}{,} \PY{n}{spec1} \PY{o}{=} \PY{n}{sim\PYZus{}spec}\PY{p}{(}\PY{n}{A1\PYZus{}true}\PY{p}{,} \PY{n}{w1\PYZus{}true}\PY{p}{,} \PY{n}{B1\PYZus{}true}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{n}{seed}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Compute the expected spectrum with true parameters for comparison}
\PY{n}{x\PYZus{}model} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
\PY{n}{spec1\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{n}{A1\PYZus{}true}\PY{p}{,} \PY{n}{w}\PY{o}{=}\PY{n}{w1\PYZus{}true}\PY{p}{,} \PY{n}{B}\PY{o}{=}\PY{n}{B1\PYZus{}true}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot the model and simulated spectrum}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{spec1\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expected Spectrum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{spec1}\PY{p}{,} \PY{n}{drawstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{steps\PYZhy{}mid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simulated Spectrum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Wavelength}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Photon Counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_4_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{69}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}posterior\PYZus{}A\PYZus{}w}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{B}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{A\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{250}\PY{p}{)}\PY{p}{,} \PY{n}{w\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{25}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}A}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}w}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of line amplitude A and width w given observed spectrum.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: array\PYZhy{}like, wavelengths}
\PY{l+s+sd}{        n\PYZus{}obs: array\PYZhy{}like, observed photon counts}
\PY{l+s+sd}{        B: float, background level (default: 50)}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{        A\PYZus{}range: tuple, prior range of A values (default: (10, 250))}
\PY{l+s+sd}{        w\PYZus{}range: tuple, prior range of w values (default: (1, 25))}
\PY{l+s+sd}{        n\PYZus{}A: int, number of A samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}w: int, number of w samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        A\PYZus{}grid : numpy array, sampled A values}
\PY{l+s+sd}{        w\PYZus{}grid: numpy array, sampled w values}
\PY{l+s+sd}{        posterior: numpy array, posterior probabilities for each (A, w) pair}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{A\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{A\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{A\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}A}\PY{p}{)}
    \PY{n}{w\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}w}\PY{p}{)}
    \PY{n}{dAdw} \PY{o}{=} \PY{p}{(}\PY{n}{A\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{A\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}A} \PY{o}{*} \PY{p}{(}\PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}w}
    \PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{A\PYZus{}vals}\PY{p}{,} \PY{n}{w\PYZus{}vals}\PY{p}{)}

    \PY{n}{n\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{B}\PY{p}{,} \PY{n}{x0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the log\PYZhy{}posterior}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{c+c1}{\PYZsh{} n\PYZus{}model has shape (len(x), n\PYZus{}w, n\PYZus{}A); sum log\PYZhy{}likelihood over wavelength axis (axis=0)}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{n\PYZus{}obs}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} scale\PYZhy{}invariant prior: p(A,w) prop 1/(A w) \PYZhy{}\PYZgt{} log\PYZus{}prior = \PYZhy{}log A \PYZhy{} log w}
    \PY{n}{log\PYZus{}prior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{A\PYZus{}grid}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{w\PYZus{}grid}\PY{p}{)}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}prior} \PY{o}{+} \PY{n}{log\PYZus{}like}

    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior}\PY{p}{)} \PY{o}{*} \PY{n}{dAdw}  \PY{c+c1}{\PYZsh{} Normalize posterior}
    \PY{k}{return} \PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{70}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Helper functions to plot credible levels, compute marginalize posterior and summary statistics}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax}\PY{p}{,} \PY{n}{par1}\PY{p}{,} \PY{n}{par2}\PY{p}{,} \PY{n}{posterior}\PY{p}{,} \PY{n}{levels}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{95}\PY{p}{,} \PY{l+m+mi}{68}\PY{p}{]}\PY{p}{,} \PY{o}{*}\PY{o}{*}\PY{n}{contour\PYZus{}kwargs}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Plot credible levels on the given axes.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        ax: matplotlib.axes.Axes, the axes to plot on}
\PY{l+s+sd}{        par1: numpy array, first parameter grid}
\PY{l+s+sd}{        par2: numpy array, second parameter grid}
\PY{l+s+sd}{        posterior: numpy array, the 2D posterior probabilities}
\PY{l+s+sd}{        levels: list, the credible levels to plot (default: [95, 68])}
\PY{l+s+sd}{        contour\PYZus{}kwargs: additional keyword arguments for contour plotting}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Sort posterior values in descending order}
    \PY{n}{p\PYZus{}sorted} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sort}\PY{p}{(}\PY{n}{posterior}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Compute cumulative sum of sorted posterior values}
    \PY{n}{cdf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{p\PYZus{}sorted}\PY{p}{)}
    \PY{n}{cdf} \PY{o}{/}\PY{o}{=} \PY{n}{cdf}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}  \PY{c+c1}{\PYZsh{} Normalize to 1}

    \PY{n}{levels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{levels}\PY{p}{,} \PY{n+nb}{float}\PY{p}{)} \PY{o}{/} \PY{l+m+mf}{100.0}
    \PY{n}{idx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{searchsorted}\PY{p}{(}\PY{n}{cdf}\PY{p}{,} \PY{n}{levels}\PY{p}{,} \PY{n}{side}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{left}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{clevels} \PY{o}{=} \PY{n}{p\PYZus{}sorted}\PY{p}{[}\PY{n}{idx}\PY{p}{]}

    \PY{n}{ax}\PY{o}{.}\PY{n}{contour}\PY{p}{(}\PY{n}{par1}\PY{p}{,} \PY{n}{par2}\PY{p}{,} \PY{n}{posterior}\PY{p}{,} \PY{n}{levels}\PY{o}{=}\PY{n}{clevels}\PY{p}{,} \PY{o}{*}\PY{o}{*}\PY{n}{contour\PYZus{}kwargs}\PY{p}{)}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{par1}\PY{p}{,} \PY{n}{par2}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Marginalize the 2D posterior distribution over each parameter.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        par1: numpy array, first parameter grid}
\PY{l+s+sd}{        par2: numpy array, second parameter grid}
\PY{l+s+sd}{        posterior: numpy array, the 2D posterior probabilities}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        par1\PYZus{}vals: numpy array, values of the first parameter}
\PY{l+s+sd}{        post\PYZus{}marg1: numpy array, marginalized posterior over the first parameter}
\PY{l+s+sd}{        par2\PYZus{}vals: numpy array, values of the second parameter}
\PY{l+s+sd}{        post\PYZus{}marg2: numpy array, marginalized posterior over the second parameter}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{par1\PYZus{}vals} \PY{o}{=} \PY{n}{par1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{par2\PYZus{}vals} \PY{o}{=} \PY{n}{par2}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{post\PYZus{}marg1} \PY{o}{=} \PY{n}{posterior}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{post\PYZus{}marg2} \PY{o}{=} \PY{n}{posterior}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{k}{return} \PY{n}{par1\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg1}\PY{p}{,} \PY{n}{par2\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg2}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{compute\PYZus{}percentile}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{pdf}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the percentiles of a distribution given its PDF}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x : array, grid of x values}
\PY{l+s+sd}{        pdf : array, probability density function values corresponding to x}
\PY{l+s+sd}{        percent : float, desired percentile (0\PYZhy{}100)}
\PY{l+s+sd}{    Returns: array of percentile values}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{cdf} \PY{o}{=} \PY{n}{cumulative\PYZus{}trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{initial}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{cdf} \PY{o}{/}\PY{o}{=} \PY{n}{cdf}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}  \PY{c+c1}{\PYZsh{} Normalize to make it a proper CDF}
    \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{interp}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{percentiles}\PY{p}{)} \PY{o}{/} \PY{l+m+mi}{100}\PY{p}{,} \PY{n}{cdf}\PY{p}{,} \PY{n}{x}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{71}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to create two helper functions:}
\PY{c+c1}{\PYZsh{} 1. Compute the mean and standard deviation from a marginalized posterior}
\PY{c+c1}{\PYZsh{} 2. Compute the covariance matrix from a 2D posterior}
\PY{c+c1}{\PYZsh{} These functions will also be used in later exercises}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{pdf}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute mean, std and given percentiles from a marginalized posterior PDF.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: 1D array of parameter values}
\PY{l+s+sd}{        pdf: 1D array of PDF values at x (not necessarily normalized)}
\PY{l+s+sd}{        percentiles: list of percentiles to compute (in percent)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        mean: float}
\PY{l+s+sd}{        std: float (standard deviation)}
\PY{l+s+sd}{        pvals: numpy array of percentile locations in same order as `percentiles`}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{x}\PY{p}{)}
    \PY{n}{pdf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} normalize pdf using trapezoidal rule}
    \PY{n}{Z} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{pdf}\PY{p}{,} \PY{n}{x}\PY{p}{)}
    \PY{k}{if} \PY{n}{Z} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{PDF integrates to zero or negative; check input.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{pdf\PYZus{}norm} \PY{o}{=} \PY{n}{pdf} \PY{o}{/} \PY{n}{Z}
    \PY{n}{mean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{x} \PY{o}{*} \PY{n}{pdf\PYZus{}norm}\PY{p}{,} \PY{n}{x}\PY{p}{)}
    \PY{n}{var} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{mean}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{pdf\PYZus{}norm}\PY{p}{,} \PY{n}{x}\PY{p}{)}
    \PY{n}{std} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var}\PY{p}{)}
    \PY{n}{pvals} \PY{o}{=} \PY{n}{compute\PYZus{}percentile}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{pdf\PYZus{}norm}\PY{p}{,} \PY{n}{percentiles}\PY{p}{)}
    \PY{k}{return} \PY{n}{mean}\PY{p}{,} \PY{n}{std}\PY{p}{,} \PY{n}{pvals}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{par1\PYZus{}grid}\PY{p}{,} \PY{n}{par2\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute means and covariance matrix from a 2D joint posterior.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        par1\PYZus{}grid: 2D array (ny, nx) of first parameter values (meshgrid)}
\PY{l+s+sd}{        par2\PYZus{}grid: 2D array (ny, nx) of second parameter values (meshgrid)}
\PY{l+s+sd}{        posterior: 2D array (ny, nx) of joint posterior (not necessarily normalized)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        mean1: float, mean of parameter 1}
\PY{l+s+sd}{        mean2: float, mean of parameter 2}
\PY{l+s+sd}{        cov: 2x2 numpy array covariance matrix [[var1, cov12],[cov12, var2]]}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Extract 1D coordinate vectors (assumes regular grids produced by np.meshgrid)}
    \PY{n}{x\PYZus{}vals} \PY{o}{=} \PY{n}{par1\PYZus{}grid}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}      \PY{c+c1}{\PYZsh{} shape (nx,)}
    \PY{n}{y\PYZus{}vals} \PY{o}{=} \PY{n}{par2\PYZus{}grid}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}    \PY{c+c1}{\PYZsh{} shape (ny,)}

    \PY{c+c1}{\PYZsh{} integrate posterior to get normalization Z}
    \PY{n}{inner} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{x\PYZus{}vals}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}  \PY{c+c1}{\PYZsh{} integrate over x \PYZhy{}\PYZgt{} shape (ny,)}
    \PY{n}{Z} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{inner}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}vals}\PY{p}{)}                  \PY{c+c1}{\PYZsh{} scalar}
    \PY{k}{if} \PY{n}{Z} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Joint posterior integrates to zero or negative; check input.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Expectations}
    \PY{n}{Ex\PYZus{}num} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior} \PY{o}{*} \PY{n}{par1\PYZus{}grid}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{x\PYZus{}vals}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}vals}\PY{p}{)}
    \PY{n}{Ey\PYZus{}num} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior} \PY{o}{*} \PY{n}{par2\PYZus{}grid}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{x\PYZus{}vals}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}vals}\PY{p}{)}
    \PY{n}{Ex} \PY{o}{=} \PY{n}{Ex\PYZus{}num} \PY{o}{/} \PY{n}{Z}
    \PY{n}{Ey} \PY{o}{=} \PY{n}{Ey\PYZus{}num} \PY{o}{/} \PY{n}{Z}

    \PY{n}{Exx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior} \PY{o}{*} \PY{n}{par1\PYZus{}grid}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{x\PYZus{}vals}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}vals}\PY{p}{)} \PY{o}{/} \PY{n}{Z}
    \PY{n}{Eyy} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior} \PY{o}{*} \PY{n}{par2\PYZus{}grid}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{x\PYZus{}vals}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}vals}\PY{p}{)} \PY{o}{/} \PY{n}{Z}
    \PY{n}{Exy} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior} \PY{o}{*} \PY{n}{par1\PYZus{}grid} \PY{o}{*} \PY{n}{par2\PYZus{}grid}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{x\PYZus{}vals}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}vals}\PY{p}{)} \PY{o}{/} \PY{n}{Z}

    \PY{n}{var\PYZus{}x} \PY{o}{=} \PY{n}{Exx} \PY{o}{\PYZhy{}} \PY{n}{Ex}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{var\PYZus{}y} \PY{o}{=} \PY{n}{Eyy} \PY{o}{\PYZhy{}} \PY{n}{Ey}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{cov\PYZus{}xy} \PY{o}{=} \PY{n}{Exy} \PY{o}{\PYZhy{}} \PY{n}{Ex} \PY{o}{*} \PY{n}{Ey}

    \PY{n}{cov} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{[}\PY{n}{var\PYZus{}x}\PY{p}{,} \PY{n}{cov\PYZus{}xy}\PY{p}{]}\PY{p}{,}
                    \PY{p}{[}\PY{n}{cov\PYZus{}xy}\PY{p}{,} \PY{n}{var\PYZus{}y}\PY{p}{]}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{Ex}\PY{p}{,} \PY{n}{Ey}\PY{p}{,} \PY{n}{cov}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{72}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Set the prior ranges and compute the posteriors}
\PY{n}{A1\PYZus{}range} \PY{o}{=} \PY{p}{[}\PY{n}{A1\PYZus{}true} \PY{o}{*} \PY{l+m+mf}{0.2}\PY{p}{,} \PY{n}{A1\PYZus{}true} \PY{o}{*} \PY{l+m+mi}{5}\PY{p}{]}
\PY{n}{w1\PYZus{}range} \PY{o}{=} \PY{p}{[}\PY{n}{w1\PYZus{}true} \PY{o}{*} \PY{l+m+mf}{0.2}\PY{p}{,} \PY{n}{w1\PYZus{}true} \PY{o}{*} \PY{l+m+mi}{5}\PY{p}{]}
\PY{n}{A1\PYZus{}sample} \PY{o}{=} \PY{l+m+mi}{500}
\PY{n}{w1\PYZus{}sample} \PY{o}{=} \PY{l+m+mi}{500}
\PY{n}{A1\PYZus{}grid}\PY{p}{,} \PY{n}{w1\PYZus{}grid}\PY{p}{,} \PY{n}{posterior1} \PY{o}{=} \PY{n}{spec\PYZus{}posterior\PYZus{}A\PYZus{}w}\PY{p}{(}
    \PY{n}{x}\PY{p}{,} \PY{n}{spec1}\PY{p}{,} \PY{n}{B}\PY{o}{=}\PY{n}{B1\PYZus{}true}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{A\PYZus{}range}\PY{o}{=}\PY{n}{A1\PYZus{}range}\PY{p}{,}
    \PY{n}{w\PYZus{}range}\PY{o}{=}\PY{n}{w1\PYZus{}range}\PY{p}{,} \PY{n}{n\PYZus{}A}\PY{o}{=}\PY{n}{A1\PYZus{}sample}\PY{p}{,} \PY{n}{n\PYZus{}w}\PY{o}{=}\PY{n}{w1\PYZus{}sample}
\PY{p}{)}

\PY{n}{A1\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}A1}\PY{p}{,} \PY{n}{w1\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}w1} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{A1\PYZus{}grid}\PY{p}{,} \PY{n}{w1\PYZus{}grid}\PY{p}{,} \PY{n}{posterior1}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{73}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the posterior distribution and marginalized distributions}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{A1\PYZus{}grid}\PY{p}{,} \PY{n}{w1\PYZus{}grid}\PY{p}{,} \PY{n}{posterior1}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{A1\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}A1}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}w1}\PY{p}{,} \PY{n}{w1\PYZus{}vals}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{w1\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{A1\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{A1\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{w1\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{A1\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{15}\PY{p}{,} \PY{n}{A1\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{20}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{w1\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mf}{1.5}\PY{p}{,} \PY{n}{w1\PYZus{}true} \PY{o}{+} \PY{l+m+mf}{1.5}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}A\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}w\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(A | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(w | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_9_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{74}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to report the mean, standard deviation, 16\PYZhy{}50\PYZhy{}84 percentiles, and covariance matrix of A and w}
\PY{n}{mean\PYZus{}A}\PY{p}{,} \PY{n}{std\PYZus{}A}\PY{p}{,} \PY{n}{p\PYZus{}A} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{A1\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}A1}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}w}\PY{p}{,} \PY{n}{std\PYZus{}w}\PY{p}{,} \PY{n}{p\PYZus{}w} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{w1\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}w1}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{n}{mean\PYZus{}A\PYZus{}joint}\PY{p}{,} \PY{n}{mean\PYZus{}w\PYZus{}joint}\PY{p}{,} \PY{n}{cov\PYZus{}Aw} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{A1\PYZus{}grid}\PY{p}{,} \PY{n}{w1\PYZus{}grid}\PY{p}{,} \PY{n}{posterior1}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{A (marginal): mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}A}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}A}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{p\PYZus{}A}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{w (marginal): mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}w}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}w}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{p\PYZus{}w}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Joint posterior means from full 2D posterior:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ mean A = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}A\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean w = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}w\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Covariance matrix (A, w):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{cov\PYZus{}Aw}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
A (marginal): mean = 52.8216, std = 3.9829, 16-50-84 = [48.85504186 52.73650063
56.78708437]
w (marginal): mean = 4.9512, std = 0.3604, 16-50-84 = [4.5935617  4.93707031
5.30838778]

Joint posterior means from full 2D posterior:
 mean A = 52.8216, mean w = 4.9512
Covariance matrix (A, w):
[[15.86325368 -0.83016287]
 [-0.83016287  0.12987004]]
    \end{Verbatim}

    \paragraph{Question 1.2: a second spectral
line}\label{question-1.2-a-second-spectral-line}

A new emission line is discovered in the same galaxy spectrum, with a
similar Gaussian profile:

\(N_{\rm exp, 2} = A_2 \exp \left[ - \dfrac{(x - x_0)^2}{2 w_2^2} \right] + B_2\)

with \(A_2=30\), \(x_0 = 0\), and the same integer wavelengths
\(x \in [-25, 25]\) (51 bins). (The center of the second line is shifted
to \(x_0 = 0\) for simplicity, but the two lines do not overlap and are
independent.)

\textbf{Tasks:} 1. Simulate an observed spectrum with
\(B_2 = 50, w_2 = 5\) using a new random seed, and compare it to the
expected spectrum. 2. Infer \(B_2\) and \(w_2\) from the simulated
spectrum using scale-invariant priors
\(p(B_2,w_2|I) \propto 1 / (B_2 w_2)\) with the ranges
\(B_2 \in [10, 250]\) and \(w_2 \in [1, 25]\). 3. Plot the joint
posterior distributions of \(B_2\) and \(w_2\) as well as the
marginalized posterior distributions of each parameter. 4. Report the
mean, standard deviation, and 16-50-84 percentiles of the marginalized
posterior distributions, as well as the covariance matrix of the joint
posterior distribution.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Simulate the spectrum with a different seed}
\PY{n}{A2\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{30}
\PY{n}{w2\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{5}
\PY{n}{B2\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{50}
\PY{n}{x}\PY{p}{,} \PY{n}{spec2} \PY{o}{=} \PY{n}{sim\PYZus{}spec}\PY{p}{(}\PY{n}{A2\PYZus{}true}\PY{p}{,} \PY{n}{w2\PYZus{}true}\PY{p}{,} \PY{n}{B2\PYZus{}true}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{n}{seed}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Compute the expected spectrum with true parameters for comparison}
\PY{n}{spec2\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{n}{A2\PYZus{}true}\PY{p}{,} \PY{n}{w}\PY{o}{=}\PY{n}{w2\PYZus{}true}\PY{p}{,} \PY{n}{B}\PY{o}{=}\PY{n}{B2\PYZus{}true}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot the model and simulated spectrum}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to plot the expected and simulated spectrum}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{spec2\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expected Spectrum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{spec2}\PY{p}{,} \PY{n}{drawstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{steps\PYZhy{}mid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simulated Spectrum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Wavelength}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Photon Counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_12_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{76}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}posterior\PYZus{}B\PYZus{}w}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{B\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,} \PY{n}{w\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{25}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}B}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}w}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of background B and width w given observed spectrum.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: array\PYZhy{}like, wavelengths}
\PY{l+s+sd}{        n\PYZus{}obs: array\PYZhy{}like, observed photon counts}
\PY{l+s+sd}{        A: float, line amplitude (default: 50)}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{        B\PYZus{}range: tuple, prior range of B values (default: (10, 100))}
\PY{l+s+sd}{        w\PYZus{}range: tuple, prior range of w values (default: (1, 25))}
\PY{l+s+sd}{        n\PYZus{}B: int, number of B samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}w: int, number of w samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        B\PYZus{}grid: 1D array, grid of B values}
\PY{l+s+sd}{        w\PYZus{}grid: 1D array, grid of w values}
\PY{l+s+sd}{        posterior: 2D array, joint posterior distribution of B and w}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Create prior grids}
    \PY{n}{B\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{B\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{B\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}B}\PY{p}{)}
    \PY{n}{w\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}w}\PY{p}{)}
    \PY{n}{dBdw} \PY{o}{=} \PY{p}{(}\PY{n}{B\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{B\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}B} \PY{o}{*} \PY{p}{(}\PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{w\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}w}
    \PY{n}{B\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{B\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{)}

    \PY{n}{n\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{B\PYZus{}grid}\PY{p}{,} \PY{n}{x0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the log\PYZhy{}posterior}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{c+c1}{\PYZsh{} n\PYZus{}model has shape (len(x), n\PYZus{}w, n\PYZus{}B); sum log\PYZhy{}likelihood over wavelength axis (axis=0)}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{n\PYZus{}obs}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} scale\PYZhy{}invariant prior: p(B,w) prop 1/(B w) \PYZhy{}\PYZgt{} log\PYZus{}prior = \PYZhy{}log B \PYZhy{} log w}
    \PY{n}{log\PYZus{}prior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{B\PYZus{}grid}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{w\PYZus{}grid}\PY{p}{)}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}prior} \PY{o}{+} \PY{n}{log\PYZus{}like}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior}\PY{p}{)} \PY{o}{*} \PY{n}{dBdw}  \PY{c+c1}{\PYZsh{} Normalize posterior}
    \PY{k}{return} \PY{n}{B\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{B2\PYZus{}sample} \PY{o}{=} \PY{l+m+mi}{500}
\PY{n}{w2\PYZus{}sample} \PY{o}{=} \PY{l+m+mi}{500}
\PY{n}{B2\PYZus{}range} \PY{o}{=} \PY{p}{[}\PY{n}{B2\PYZus{}true} \PY{o}{*} \PY{l+m+mf}{0.2}\PY{p}{,} \PY{n}{B2\PYZus{}true} \PY{o}{*} \PY{l+m+mi}{5}\PY{p}{]}
\PY{n}{w2\PYZus{}range} \PY{o}{=} \PY{p}{[}\PY{n}{w2\PYZus{}true} \PY{o}{*} \PY{l+m+mf}{0.2}\PY{p}{,} \PY{n}{w2\PYZus{}true} \PY{o}{*} \PY{l+m+mi}{5}\PY{p}{]}

\PY{n}{B2\PYZus{}grid}\PY{p}{,} \PY{n}{w2\PYZus{}grid}\PY{p}{,} \PY{n}{posterior2} \PY{o}{=} \PY{n}{spec\PYZus{}posterior\PYZus{}B\PYZus{}w}\PY{p}{(}
    \PY{n}{x}\PY{p}{,} \PY{n}{spec2}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{n}{A2\PYZus{}true}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{B\PYZus{}range}\PY{o}{=}\PY{n}{B2\PYZus{}range}\PY{p}{,}
    \PY{n}{w\PYZus{}range}\PY{o}{=}\PY{n}{w2\PYZus{}range}\PY{p}{,} \PY{n}{n\PYZus{}B}\PY{o}{=}\PY{n}{B2\PYZus{}sample}\PY{p}{,} \PY{n}{n\PYZus{}w}\PY{o}{=}\PY{n}{w2\PYZus{}sample}
\PY{p}{)}

\PY{n}{B2\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}B2}\PY{p}{,} \PY{n}{w2\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}w2} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{B2\PYZus{}grid}\PY{p}{,} \PY{n}{w2\PYZus{}grid}\PY{p}{,} \PY{n}{posterior2}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the posterior distribution and marginalized distributions}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to plot the credible levels and marginalized distributions}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{B2\PYZus{}grid}\PY{p}{,} \PY{n}{w2\PYZus{}grid}\PY{p}{,} \PY{n}{posterior2}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{B2\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}B2}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}w2}\PY{p}{,} \PY{n}{w2\PYZus{}vals}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{w2\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{B2\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{B2\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{w2\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{B2\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{10}\PY{p}{,} \PY{n}{B2\PYZus{}true} \PY{o}{+} \PY{l+m+mf}{7.5}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{w2\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mf}{2.5}\PY{p}{,} \PY{n}{w2\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{6}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}B\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}w\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(B | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(w | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_15_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{79}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to report the summary statistics of B and w}
\PY{n}{mean\PYZus{}B}\PY{p}{,} \PY{n}{std\PYZus{}B}\PY{p}{,} \PY{n}{p\PYZus{}B} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{B2\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}B2}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}w2}\PY{p}{,} \PY{n}{std\PYZus{}w2}\PY{p}{,} \PY{n}{p\PYZus{}w2} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{w2\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}w2}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{n}{mean\PYZus{}B\PYZus{}joint}\PY{p}{,} \PY{n}{mean\PYZus{}w2\PYZus{}joint}\PY{p}{,} \PY{n}{cov\PYZus{}Bw} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{B2\PYZus{}grid}\PY{p}{,} \PY{n}{w2\PYZus{}grid}\PY{p}{,} \PY{n}{posterior2}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{B (marginal): mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}B}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}B}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{p\PYZus{}B}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{w (marginal): mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}w2}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}w2}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{p\PYZus{}w2}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Joint posterior means from full 2D posterior:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ mean B = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}B\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean w = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}w2\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Covariance matrix (B, w):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{cov\PYZus{}Bw}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
B (marginal): mean = 49.0174, std = 1.6906, 16-50-84 = [47.35793213 49.05905751
50.69416513]
w (marginal): mean = 6.0510, std = 0.9391, 16-50-84 = [5.15995403 6.00157165
6.92625238]

Joint posterior means from full 2D posterior:
 mean B = 49.0174, mean w = 6.0510
Covariance matrix (B, w):
[[ 2.85827194 -1.24509493]
 [-1.24509493  0.88191705]]
    \end{Verbatim}

    \paragraph{Question 1.3: derived
parameters}\label{question-1.3-derived-parameters}

The star formation rate \(f\) and velocity dispersion \(\sigma_v\) of
the galaxy are related to the line parameters as follows:

\(\begin{aligned}
f & = A_1 w_1 / 10 = B_2 / 2 \, [M_\odot \, \text{yr}^{-1}] \\
\sigma_v & = 10 w_1 = 10 w_2 \, [\text{km} \, \text{s}^{-1}] \\
\end{aligned}\)

\textbf{Tasks:} 1. Compute the 2D and marginalized posterior
distributions of \(f\) and \(\sigma_v\) based on the existing posterior
results from Questions 1.1 and 1.2. 2. Reparametrizing the problem,
infer \(f\) and \(\sigma_v\) directly from the observed spectra using
scale-invariant priors \(p(f,\sigma_v | I) \propto 1/(f \sigma_v)\) in
the ranges \(f \in [10, 50]\) and \(\sigma_v \in [10, 100]\). 3. Compare
the posterior distributions of \(f\) and \(\sigma_v\) obtained from the
two methods above. 4. Compare the standard deviations of \(f\) and
\(\sigma_v\) obtained from the two methods above and the error
propagation results (under linear approximation) based on the individual
parameter inferences from Questions 1.1 and 1.2.

\textbf{Hint:} Report the results from both lines separately, and check
the consistency.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{80}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{interpolate}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{RegularGridInterpolator}

\PY{c+c1}{\PYZsh{} Helper functions to resample existing posterior distributions with parameter transformations}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{resample\PYZus{}posterior\PYZus{}A\PYZus{}w}\PY{p}{(}\PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Resample the posterior from (A, w) to (f, sigma\PYZus{}v).}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        A\PYZus{}grid: numpy array, grid of A values}
\PY{l+s+sd}{        w\PYZus{}grid: numpy array, grid of w values}
\PY{l+s+sd}{        posterior: numpy array, joint posterior distribution of A and w}
\PY{l+s+sd}{        f\PYZus{}range: list, prior range of f values (default: [10, 50])}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}range: list, prior range of sigma\PYZus{}v values (default: [10, 100])}
\PY{l+s+sd}{        n\PYZus{}f: int, number of f samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}sigma\PYZus{}v: int, number of sigma\PYZus{}v samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        f\PYZus{}grid: numpy array, grid of f values}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}grid: numpy array, grid of sigma\PYZus{}v values}
\PY{l+s+sd}{        posterior\PYZus{}reparam: numpy array, joint posterior distribution of f and sigma\PYZus{}v}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Create interpolator for the original posterior}
    \PY{n}{interp} \PY{o}{=} \PY{n}{RegularGridInterpolator}\PY{p}{(}\PY{p}{(}\PY{n}{w\PYZus{}grid}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{A\PYZus{}grid}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{posterior}\PY{p}{,} \PY{n}{bounds\PYZus{}error}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{fill\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Create new grids for f and sigma\PYZus{}v}
    \PY{n}{f\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{p}{)}
    \PY{n}{sigma\PYZus{}v\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{p}{)}
    \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{f\PYZus{}vals}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Convert (f, sigma\PYZus{}v) to (A, w)}
    \PY{n}{A\PYZus{}new} \PY{o}{=} \PY{n}{f\PYZus{}grid} \PY{o}{*} \PY{l+m+mi}{100} \PY{o}{/} \PY{n}{sigma\PYZus{}v\PYZus{}grid}
    \PY{n}{w\PYZus{}new} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{/} \PY{l+m+mi}{10}

    \PY{c+c1}{\PYZsh{} Evaluate the original posterior at the new (A, w) points}
    \PY{n}{points} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{w\PYZus{}new}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{A\PYZus{}new}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{T}
    \PY{n}{posterior\PYZus{}interp} \PY{o}{=} \PY{n}{interp}\PY{p}{(}\PY{n}{points}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{f\PYZus{}grid}\PY{o}{.}\PY{n}{shape}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Apply Jacobian for change of variables}
    \PY{n}{posterior\PYZus{}reparam} \PY{o}{=} \PY{n}{posterior\PYZus{}interp} \PY{o}{/} \PY{n}{w\PYZus{}new}

    \PY{c+c1}{\PYZsh{} Renormalize the reparameterized posterior}
    \PY{n}{dfds} \PY{o}{=} \PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}f} \PY{o}{*} \PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}sigma\PYZus{}v}
    \PY{n}{posterior\PYZus{}reparam} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior\PYZus{}reparam}\PY{p}{)} \PY{o}{*} \PY{n}{dfds}

    \PY{k}{return} \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}reparam}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{resample\PYZus{}posterior\PYZus{}B\PYZus{}w}\PY{p}{(}\PY{n}{B\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Resample the posterior from (B, w) to (f, sigma\PYZus{}v).}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        B\PYZus{}grid: numpy array, grid of B values}
\PY{l+s+sd}{        w\PYZus{}grid: numpy array, grid of w values}
\PY{l+s+sd}{        posterior: numpy array, joint posterior distribution of B and w}
\PY{l+s+sd}{        f\PYZus{}range: list, prior range of f values (default: [10, 50])}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}range: list, prior range of sigma\PYZus{}v values (default: [10, 100])}
\PY{l+s+sd}{        n\PYZus{}f: int, number of f samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}sigma\PYZus{}v: int, number of sigma\PYZus{}v samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        f\PYZus{}grid: numpy array, grid of f values}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}grid: numpy array, grid of sigma\PYZus{}v values}
\PY{l+s+sd}{        posterior\PYZus{}reparam: numpy array, joint posterior distribution of f and sigma\PYZus{}v}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Create interpolator for the original posterior}
    \PY{n}{interp} \PY{o}{=} \PY{n}{RegularGridInterpolator}\PY{p}{(}\PY{p}{(}\PY{n}{w\PYZus{}grid}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{B\PYZus{}grid}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{posterior}\PY{p}{,} \PY{n}{bounds\PYZus{}error}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{fill\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Create new grids for f and sigma\PYZus{}v}
    \PY{n}{f\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{p}{)}
    \PY{n}{sigma\PYZus{}v\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{p}{)}
    \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{f\PYZus{}vals}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Convert (f, sigma\PYZus{}v) to (B, w)}
    \PY{n}{B\PYZus{}new} \PY{o}{=} \PY{n}{f\PYZus{}grid} \PY{o}{*} \PY{l+m+mi}{2}
    \PY{n}{w\PYZus{}new} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{/} \PY{l+m+mi}{10}

    \PY{c+c1}{\PYZsh{} Evaluate the original posterior at the new (B, w) points}
    \PY{n}{points} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{w\PYZus{}new}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{B\PYZus{}new}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{T}
    \PY{n}{posterior\PYZus{}interp} \PY{o}{=} \PY{n}{interp}\PY{p}{(}\PY{n}{points}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{f\PYZus{}grid}\PY{o}{.}\PY{n}{shape}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Apply Jacobian for change of variables:}
    \PY{c+c1}{\PYZsh{} B = 2 f  \PYZhy{}\PYZgt{} dB/df = 2}
    \PY{c+c1}{\PYZsh{} w = sigma\PYZus{}v / 10 \PYZhy{}\PYZgt{} dw/dsigma\PYZus{}v = 1/10}
    \PY{c+c1}{\PYZsh{} det = 2 * (1/10) = 0.2}
    \PY{n}{jacobian} \PY{o}{=} \PY{l+m+mf}{0.2}
    \PY{n}{posterior\PYZus{}reparam} \PY{o}{=} \PY{n}{posterior\PYZus{}interp} \PY{o}{*} \PY{n}{jacobian}

    \PY{c+c1}{\PYZsh{} Renormalize the reparameterized posterior}
    \PY{n}{dfds} \PY{o}{=} \PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}f} \PY{o}{*} \PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}sigma\PYZus{}v}
    \PY{n}{posterior\PYZus{}reparam} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior\PYZus{}reparam}\PY{p}{)} \PY{o}{*} \PY{n}{dfds}

    \PY{k}{return} \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}reparam}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{81}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}posterior\PYZus{}fs\PYZus{}1}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{B}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of flux f and velocity dispersion sigma\PYZus{}v given observed spectrum.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: array\PYZhy{}like, wavelengths}
\PY{l+s+sd}{        n\PYZus{}obs: array\PYZhy{}like, observed photon counts}
\PY{l+s+sd}{        B: float, background level (default: 50)}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{        f\PYZus{}range: tuple, prior range of f values (default: (10, 50))}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}range: tuple, prior range of sigma\PYZus{}v values (default: (10, 100))}
\PY{l+s+sd}{        n\PYZus{}f: int, number of f samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}sigma\PYZus{}v: int, number of sigma\PYZus{}v samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        f\PYZus{}grid: numpy array, grid of f values}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}grid: numpy array, grid of sigma\PYZus{}v values}
\PY{l+s+sd}{        posterior: numpy array, joint posterior distribution of f and sigma\PYZus{}v}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Create grids for f and sigma\PYZus{}v}
    \PY{n}{f\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{p}{)}
    \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{p}{)}
    \PY{n}{dfds} \PY{o}{=} \PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}f} \PY{o}{*} \PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}sigma\PYZus{}v}
    \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the joint posterior distribution}
    \PY{n}{A\PYZus{}grid} \PY{o}{=} \PY{n}{f\PYZus{}grid} \PY{o}{*} \PY{l+m+mi}{100} \PY{o}{/} \PY{n}{sigma\PYZus{}v\PYZus{}grid}
    \PY{n}{w\PYZus{}grid} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{/} \PY{l+m+mi}{10}
    \PY{n}{n\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A\PYZus{}grid}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{B}\PY{p}{,} \PY{n}{x0}\PY{p}{)}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{c+c1}{\PYZsh{} n\PYZus{}model has shape (len(x), n\PYZus{}w, n\PYZus{}A); sum log\PYZhy{}likelihood over wavelength axis (axis=0)}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{n\PYZus{}obs}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} scale\PYZhy{}invariant prior: p(A,w) prop 1/(A w) \PYZhy{}\PYZgt{} log\PYZus{}prior = \PYZhy{}log A \PYZhy{} log w}
    \PY{n}{log\PYZus{}prior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{A\PYZus{}grid}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{w\PYZus{}grid}\PY{p}{)}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}prior} \PY{o}{+} \PY{n}{log\PYZus{}like}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior}\PY{p}{)} \PY{o}{*} \PY{n}{dfds}  \PY{c+c1}{\PYZsh{} Normalize posterior}

    \PY{k}{return} \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}posterior\PYZus{}fs\PYZus{}2}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of flux f and velocity dispersion sigma\PYZus{}v given observed spectrum.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: array\PYZhy{}like, wavelengths}
\PY{l+s+sd}{        n\PYZus{}obs: array\PYZhy{}like, observed photon counts}
\PY{l+s+sd}{        A: float, line amplitude (default: 30)}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{        f\PYZus{}range: tuple, prior range of f values (default: (10, 50))}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}range: tuple, prior range of sigma\PYZus{}v values (default: (10, 100))}
\PY{l+s+sd}{        n\PYZus{}f: int, number of f samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}sigma\PYZus{}v: int, number of sigma\PYZus{}v samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        f\PYZus{}grid: numpy array, grid of f values}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}grid: numpy array, grid of sigma\PYZus{}v values}
\PY{l+s+sd}{        posterior: numpy array, joint posterior distribution of f and sigma\PYZus{}v}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete the function}
    \PY{c+c1}{\PYZsh{} Create grids for f and sigma\PYZus{}v}
    \PY{n}{f\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{p}{)}
    \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{p}{)}
    \PY{n}{dfds} \PY{o}{=} \PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}f} \PY{o}{*} \PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}sigma\PYZus{}v}
    \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the joint posterior distribution}
    \PY{n}{B\PYZus{}grid} \PY{o}{=} \PY{n}{f\PYZus{}grid} \PY{o}{*} \PY{l+m+mi}{2}
    \PY{n}{w\PYZus{}grid} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{/} \PY{l+m+mi}{10}
    \PY{n}{n\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{w\PYZus{}grid}\PY{p}{,} \PY{n}{B\PYZus{}grid}\PY{p}{,} \PY{n}{x0}\PY{p}{)}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{c+c1}{\PYZsh{} n\PYZus{}model has shape (len(x), n\PYZus{}w, n\PYZus{}B); sum log\PYZhy{}likelihood over wavelength axis (axis=0)}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{n\PYZus{}obs}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}model} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} scale\PYZhy{}invariant prior: p(B,w) prop 1/(B w) \PYZhy{}\PYZgt{} log\PYZus{}prior = \PYZhy{}log B \PYZhy{} log w}
    \PY{n}{log\PYZus{}prior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{B\PYZus{}grid}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{w\PYZus{}grid}\PY{p}{)}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}prior} \PY{o}{+} \PY{n}{log\PYZus{}like}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior}\PY{p}{)} \PY{o}{*} \PY{n}{dfds}  \PY{c+c1}{\PYZsh{} Normalize posterior}

    \PY{k}{return} \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{82}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Resampled posteriors from first spectrum}
\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}resample} \PY{o}{=} \PY{n}{resample\PYZus{}posterior\PYZus{}A\PYZus{}w}\PY{p}{(}\PY{n}{A1\PYZus{}grid}\PY{p}{,} \PY{n}{w1\PYZus{}grid}\PY{p}{,} \PY{n}{posterior1}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}resample} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}resample}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Resampled posteriors from second spectrum}
\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}resample} \PY{o}{=} \PY{n}{resample\PYZus{}posterior\PYZus{}B\PYZus{}w}\PY{p}{(}\PY{n}{B2\PYZus{}grid}\PY{p}{,} \PY{n}{w2\PYZus{}grid}\PY{p}{,} \PY{n}{posterior2}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}resample} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}resample}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{83}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Refitted posteriors from the first spectrum}
\PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}refit} \PY{o}{=} \PY{n}{spec\PYZus{}posterior\PYZus{}fs\PYZus{}1}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{spec1}\PY{p}{,} \PY{n}{B}\PY{o}{=}\PY{n}{B1\PYZus{}true}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}refit} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}refit}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Refitted posteriors from the second spectrum}
\PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}refit} \PY{o}{=} \PY{n}{spec\PYZus{}posterior\PYZus{}fs\PYZus{}2}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{spec2}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{n}{A2\PYZus{}true}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}refit} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}refit}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{84}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{f\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{25}
\PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{50}

\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Refitted posteriors from the first spectrum}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidths}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyles}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Resampled posteriors from the first spectrum}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}resample}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Refitted posteriors from the second spectrum}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidths}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyles}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Resampled posteriors from the second spectrum}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}resample}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{f\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{10}\PY{p}{,} \PY{n}{f\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{30}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}f\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(f | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_22_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{85}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Compute propagated errors under linear approximation and compare to marginalized posterior results}

\PY{c+c1}{\PYZsh{} Propagation for first line: f1 = A1 * w1 / 10, sigma\PYZus{}v1 = 10 * w1}
\PY{n}{var\PYZus{}A} \PY{o}{=} \PY{n}{std\PYZus{}A}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{var\PYZus{}w} \PY{o}{=} \PY{n}{std\PYZus{}w}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{cov\PYZus{}A\PYZus{}w} \PY{o}{=} \PY{n}{cov\PYZus{}Aw}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}

\PY{c+c1}{\PYZsh{} derivatives}
\PY{c+c1}{\PYZsh{} df/dA = w/10, df/dw = A/10  \PYZhy{}\PYZgt{} evaluate at means from joint posterior (use joint means from covariance\PYZus{}from\PYZus{}2d)}
\PY{n}{A\PYZus{}mean\PYZus{}joint} \PY{o}{=} \PY{n}{mean\PYZus{}A\PYZus{}joint}
\PY{n}{w\PYZus{}mean\PYZus{}joint} \PY{o}{=} \PY{n}{mean\PYZus{}w\PYZus{}joint}

\PY{n}{df\PYZus{}dA} \PY{o}{=} \PY{n}{w\PYZus{}mean\PYZus{}joint} \PY{o}{/} \PY{l+m+mf}{10.0}
\PY{n}{df\PYZus{}dw} \PY{o}{=} \PY{n}{A\PYZus{}mean\PYZus{}joint} \PY{o}{/} \PY{l+m+mf}{10.0}

\PY{n}{var\PYZus{}f1\PYZus{}prop} \PY{o}{=} \PY{n}{df\PYZus{}dA}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{var\PYZus{}A} \PY{o}{+} \PY{n}{df\PYZus{}dw}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{var\PYZus{}w} \PY{o}{+} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{df\PYZus{}dA} \PY{o}{*} \PY{n}{df\PYZus{}dw} \PY{o}{*} \PY{n}{cov\PYZus{}A\PYZus{}w}
\PY{n}{std\PYZus{}f1\PYZus{}prop} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{var\PYZus{}f1\PYZus{}prop}\PY{p}{)}

\PY{n}{std\PYZus{}sigma1\PYZus{}prop} \PY{o}{=} \PY{l+m+mf}{10.0} \PY{o}{*} \PY{n}{std\PYZus{}w}  \PY{c+c1}{\PYZsh{} sigma\PYZus{}v1 = 10 * w1}

\PY{c+c1}{\PYZsh{} Propagation for second line: f2 = B2 / 2, sigma\PYZus{}v2 = 10 * w2}
\PY{n}{var\PYZus{}B} \PY{o}{=} \PY{n}{std\PYZus{}B}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{var\PYZus{}w2} \PY{o}{=} \PY{n}{std\PYZus{}w2}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
\PY{n}{cov\PYZus{}B\PYZus{}w2} \PY{o}{=} \PY{n}{cov\PYZus{}Bw}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}

\PY{n}{std\PYZus{}f2\PYZus{}prop} \PY{o}{=} \PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{std\PYZus{}B}
\PY{n}{std\PYZus{}sigma2\PYZus{}prop} \PY{o}{=} \PY{l+m+mf}{10.0} \PY{o}{*} \PY{n}{std\PYZus{}w2}

\PY{c+c1}{\PYZsh{} Summarize marginalized posteriors (resample and refit results)}
\PY{n}{mean\PYZus{}f1\PYZus{}res}\PY{p}{,} \PY{n}{std\PYZus{}f1\PYZus{}res}\PY{p}{,} \PY{n}{pct\PYZus{}f1\PYZus{}res} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}resample}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma1\PYZus{}res}\PY{p}{,} \PY{n}{std\PYZus{}sigma1\PYZus{}res}\PY{p}{,} \PY{n}{pct\PYZus{}sigma1\PYZus{}res} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}resample}\PY{p}{)}

\PY{n}{mean\PYZus{}f1\PYZus{}ref}\PY{p}{,} \PY{n}{std\PYZus{}f1\PYZus{}ref}\PY{p}{,} \PY{n}{pct\PYZus{}f1\PYZus{}ref} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}refit}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma1\PYZus{}ref}\PY{p}{,} \PY{n}{std\PYZus{}sigma1\PYZus{}ref}\PY{p}{,} \PY{n}{pct\PYZus{}sigma1\PYZus{}ref} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}refit}\PY{p}{)}

\PY{n}{mean\PYZus{}f2\PYZus{}res}\PY{p}{,} \PY{n}{std\PYZus{}f2\PYZus{}res}\PY{p}{,} \PY{n}{pct\PYZus{}f2\PYZus{}res} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}resample}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma2\PYZus{}res}\PY{p}{,} \PY{n}{std\PYZus{}sigma2\PYZus{}res}\PY{p}{,} \PY{n}{pct\PYZus{}sigma2\PYZus{}res} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}resample}\PY{p}{)}

\PY{n}{mean\PYZus{}f2\PYZus{}ref}\PY{p}{,} \PY{n}{std\PYZus{}f2\PYZus{}ref}\PY{p}{,} \PY{n}{pct\PYZus{}f2\PYZus{}ref} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}refit}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma2\PYZus{}ref}\PY{p}{,} \PY{n}{std\PYZus{}sigma2\PYZus{}ref}\PY{p}{,} \PY{n}{pct\PYZus{}sigma2\PYZus{}ref} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}refit}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print comparisons}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Line 1 (from A1,w1):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Propagated std(f)    = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f1\PYZus{}prop}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Resample  std(f)     = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f1\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Refit     std(f)     = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f1\PYZus{}ref}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Propagated std(sigma)= }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma1\PYZus{}prop}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Resample  std(sigma) = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma1\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Refit     std(sigma) = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma1\PYZus{}ref}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Line 2 (from B2,w2):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Propagated std(f)    = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f2\PYZus{}prop}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Resample  std(f)     = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f2\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Refit     std(f)     = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f2\PYZus{}ref}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Propagated std(sigma)= }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma2\PYZus{}prop}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Resample  std(sigma) = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma2\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Refit     std(sigma) = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma2\PYZus{}ref}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Relative differences (percent)}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{a}\PY{p}{,} \PY{n}{b}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{l+m+mf}{100.0} \PY{o}{*} \PY{p}{(}\PY{n}{a} \PY{o}{\PYZhy{}} \PY{n}{b}\PY{p}{)} \PY{o}{/} \PY{n}{b} \PY{k}{if} \PY{n}{b} \PY{o}{!=} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{nan}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Relative differences (propagated vs resample or refit) [}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{]:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Line1 f:  (prop\PYZhy{}resample) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}f1\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}f1\PYZus{}res}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}, (prop\PYZhy{}refit) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}f1\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}f1\PYZus{}ref}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Line1 sigma: (prop\PYZhy{}resample) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}sigma1\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}sigma1\PYZus{}res}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}, (prop\PYZhy{}refit) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}sigma1\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}sigma1\PYZus{}ref}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Line2 f:  (prop\PYZhy{}resample) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}f2\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}f2\PYZus{}res}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}, (prop\PYZhy{}refit) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}f2\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}f2\PYZus{}ref}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Line2 sigma: (prop\PYZhy{}resample) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}sigma2\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}sigma2\PYZus{}res}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}, (prop\PYZhy{}refit) = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}sigma2\PYZus{}prop}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}sigma2\PYZus{}ref}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Line 1 (from A1,w1):
 Propagated std(f)    = 1.7805
 Resample  std(f)     = 1.7741
 Refit     std(f)     = 1.7697
 Propagated std(sigma)= 3.6037
 Resample  std(sigma) = 3.6090
 Refit     std(sigma) = 3.6257

Line 2 (from B2,w2):
 Propagated std(f)    = 0.8453
 Resample  std(f)     = 0.8414
 Refit     std(f)     = 0.8354
 Propagated std(sigma)= 9.3910
 Resample  std(sigma) = 9.1982
 Refit     std(sigma) = 9.1962

Relative differences (propagated vs resample or refit) [\%]:
 Line1 f:  (prop-resample) = +0.36\%, (prop-refit) = +0.61\%
 Line1 sigma: (prop-resample) = -0.15\%, (prop-refit) = -0.61\%
 Line2 f:  (prop-resample) = +0.47\%, (prop-refit) = +1.19\%
 Line2 sigma: (prop-resample) = +2.10\%, (prop-refit) = +2.12\%
    \end{Verbatim}

    \paragraph{Question 1.4: joint
constraints}\label{question-1.4-joint-constraints}

\textbf{Tasks:} 1. Combine the observed spectra from Questions 1.1 and
1.2 to jointly infer \(f\) and \(\sigma_v\) in two ways: - Directly
inferring \(f\) and \(\sigma_v\) from the combined observed spectra at
once using scale-invariant priors
\(p(f,\sigma_v|I) \propto 1/(f \sigma_v)\) in the ranges
\(f \in [10, 50]\) and \(\sigma_v \in [10, 100]\). - Using the posterior
distributions of \(f, \sigma_v\) from the reparameterized results in
Question 1.3. 2. Compare the posterior distributions of \(f\) and
\(\sigma_v\) obtained from the two methods above.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{86}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{joint\PYZus{}posterior\PYZus{}resample}\PY{p}{(}\PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{,} \PY{n}{posterior1}\PY{p}{,} \PY{n}{posterior2}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the joint posterior distribution from two independent posteriors.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        f\PYZus{}grid: numpy array, grid of f values}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}grid: numpy array, grid of sigma\PYZus{}v values}
\PY{l+s+sd}{        posterior1: numpy array, first joint posterior distribution}
\PY{l+s+sd}{        posterior2: numpy array, second joint posterior distribution}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        posterior\PYZus{}joint: numpy array, joint posterior distribution}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Multiply two independent posteriors pointwise and renormalize.}
    \PY{n}{posterior\PYZus{}joint} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{posterior1}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{posterior2}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}

    \PY{k}{if} \PY{n}{posterior\PYZus{}joint}\PY{o}{.}\PY{n}{shape} \PY{o}{!=} \PY{n}{posterior1}\PY{o}{.}\PY{n}{shape} \PY{o+ow}{or} \PY{n}{posterior\PYZus{}joint}\PY{o}{.}\PY{n}{shape} \PY{o}{!=} \PY{n}{posterior2}\PY{o}{.}\PY{n}{shape}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{posterior1 and posterior2 must have the same shape as the provided grids.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Extract 1D coordinate arrays from the meshgrids}
    \PY{n}{f\PYZus{}vals} \PY{o}{=} \PY{n}{f\PYZus{}grid}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}       \PY{c+c1}{\PYZsh{} shape (n\PYZus{}f,)}
    \PY{n}{sigma\PYZus{}vals} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}  \PY{c+c1}{\PYZsh{} shape (n\PYZus{}sigma\PYZus{}v,)}

    \PY{c+c1}{\PYZsh{} Estimate grid cell area (assumes regular grid)}
    \PY{n}{df} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{f\PYZus{}vals}\PY{p}{)}\PY{p}{)}
    \PY{n}{ds} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{sigma\PYZus{}vals}\PY{p}{)}\PY{p}{)}
    \PY{n}{cell\PYZus{}area} \PY{o}{=} \PY{n}{df} \PY{o}{*} \PY{n}{ds}

    \PY{c+c1}{\PYZsh{} Normalize the joint posterior to be a proper PDF over the grid}
    \PY{n}{Z} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior\PYZus{}joint}\PY{p}{)} \PY{o}{*} \PY{n}{cell\PYZus{}area}
    \PY{k}{if} \PY{n}{Z} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Joint posterior integrates to zero or negative; check inputs.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{posterior\PYZus{}joint} \PY{o}{/}\PY{o}{=} \PY{n}{Z}
    \PY{k}{return} \PY{n}{posterior\PYZus{}joint}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{joint\PYZus{}posterior\PYZus{}refit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{n\PYZus{}obs1}\PY{p}{,} \PY{n}{n\PYZus{}obs2}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the joint posterior distribution from two independent spectra by refitting.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        x: array\PYZhy{}like, wavelengths}
\PY{l+s+sd}{        n\PYZus{}obs1: array\PYZhy{}like, observed photon counts from first spectrum}
\PY{l+s+sd}{        n\PYZus{}obs2: array\PYZhy{}like, observed photon counts from second spectrum}
\PY{l+s+sd}{        x0: float, line center (default: 0)}
\PY{l+s+sd}{        f\PYZus{}range: tuple, prior range of f values (default: (10, 50))}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}range: tuple, prior range of sigma\PYZus{}v values (default: (10, 100))}
\PY{l+s+sd}{        n\PYZus{}f: int, number of f samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}sigma\PYZus{}v: int, number of sigma\PYZus{}v samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        f\PYZus{}grid: numpy array, grid of f values}
\PY{l+s+sd}{        sigma\PYZus{}v\PYZus{}grid: numpy array, grid of sigma\PYZus{}v values}
\PY{l+s+sd}{        posterior\PYZus{}joint: numpy array, joint posterior distribution}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Create grids for f and sigma\PYZus{}v}
    \PY{n}{f\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{p}{)}
    \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{p}{)}
    \PY{n}{dfds} \PY{o}{=} \PY{p}{(}\PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{f\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}f} \PY{o}{*} \PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}sigma\PYZus{}v}
    \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the joint posterior distribution}
    \PY{c+c1}{\PYZsh{} Map (f, sigma\PYZus{}v) \PYZhy{}\PYZgt{} (A1, w1) for first spectrum and \PYZhy{}\PYZgt{} (B2, w2) for second spectrum}
    \PY{n}{A1\PYZus{}grid} \PY{o}{=} \PY{n}{f\PYZus{}grid} \PY{o}{*} \PY{l+m+mf}{100.0} \PY{o}{/} \PY{n}{sigma\PYZus{}v\PYZus{}grid}   \PY{c+c1}{\PYZsh{} A1 = 100 * f / sigma\PYZus{}v}
    \PY{n}{w1\PYZus{}grid} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{/} \PY{l+m+mf}{10.0}             \PY{c+c1}{\PYZsh{} w1 = sigma\PYZus{}v / 10}
    \PY{n}{B2\PYZus{}grid} \PY{o}{=} \PY{n}{f\PYZus{}grid} \PY{o}{*} \PY{l+m+mf}{2.0}                    \PY{c+c1}{\PYZsh{} B2 = 2 * f}
    \PY{n}{w2\PYZus{}grid} \PY{o}{=} \PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{/} \PY{l+m+mf}{10.0}             \PY{c+c1}{\PYZsh{} w2 = sigma\PYZus{}v / 10}

    \PY{c+c1}{\PYZsh{} Compute model predictions for both spectra}
    \PY{n}{n\PYZus{}model1} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A1\PYZus{}grid}\PY{p}{,} \PY{n}{w1\PYZus{}grid}\PY{p}{,} \PY{n}{B1\PYZus{}true}\PY{p}{,} \PY{n}{x0}\PY{p}{)}
    \PY{n}{n\PYZus{}model2} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{A2\PYZus{}true}\PY{p}{,} \PY{n}{w2\PYZus{}grid}\PY{p}{,} \PY{n}{B2\PYZus{}grid}\PY{p}{,} \PY{n}{x0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Log\PYZhy{}likelihoods (Poisson) summed over wavelength bins for each spectrum}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{n}{log\PYZus{}like1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{n\PYZus{}model1} \PY{o}{+} \PY{n}{n\PYZus{}obs1}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}model1} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{log\PYZus{}like2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{n\PYZus{}model2} \PY{o}{+} \PY{n}{n\PYZus{}obs2}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{n\PYZus{}model2} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{log\PYZus{}like1} \PY{o}{+} \PY{n}{log\PYZus{}like2}

    \PY{c+c1}{\PYZsh{} Scale\PYZhy{}invariant prior in (f, sigma\PYZus{}v): p(f,sigma\PYZus{}v) ∝ 1/(f * sigma\PYZus{}v)}
    \PY{n}{log\PYZus{}prior} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{f\PYZus{}grid} \PY{o}{+} \PY{n}{eps}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}grid} \PY{o}{+} \PY{n}{eps}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Posterior (up to normalization)}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}prior} \PY{o}{+} \PY{n}{log\PYZus{}like}
    \PY{n}{posterior\PYZus{}joint} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior\PYZus{}joint} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior\PYZus{}joint}\PY{p}{)} \PY{o}{*} \PY{n}{dfds}  \PY{c+c1}{\PYZsh{} Normalize posterior}
    
    \PY{k}{return} \PY{n}{f\PYZus{}grid}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}joint}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{87}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{combined\PYZus{}posterior\PYZus{}resample} \PY{o}{=} \PY{n}{joint\PYZus{}posterior\PYZus{}resample}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}resample}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}resample} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}resample}\PY{p}{)}

\PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit} \PY{o}{=} \PY{n}{joint\PYZus{}posterior\PYZus{}refit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{spec1}\PY{p}{,} \PY{n}{spec2}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{88}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the refitted results}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Joint posterior from refitting}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{f\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{10}\PY{p}{,} \PY{n}{f\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{20}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}f\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(f | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_27_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{89}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the resampled results}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Joint posterior from resampling}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}resample}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}resample}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}resample}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{f\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{10}\PY{p}{,} \PY{n}{f\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{20}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}f\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}  
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(f | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_28_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{90}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Compare the joint posteriors from the two methods}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Joint posterior from refitting}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidths}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,} \PY{n}{linestyles}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Joint posterior from resampling}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}resample}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{f\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{5}\PY{p}{,} \PY{n}{f\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{5}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{20}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{20}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}f\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(f | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_29_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Question 1.5: joint constraints with systematic
bias}\label{question-1.5-joint-constraints-with-systematic-bias}

Assume that the flux calibration of the second spectrum has a systematic
bias of 10 photon counts, i.e., the actual expected counts should be:

\(N'_{\rm exp, 2} = A_2 \exp \left[ - \dfrac{(x - x_0)^2}{2 w_2^2} \right] + (B_2 + 10)\)

\textbf{Tasks:} 1. Modify the observed spectrum from Question 1.2
accordingly and refit the parameters \(f\) and \(\sigma_v\) using the
same scale-invariant priors in the ranges \(f \in [10, 50]\) and
\(\sigma_v \in [10, 100]\), but assuming the systematic bias is known.
2. Repeat Question 1.4 (using either method that you prefer) to jointly
infer \(f\) and \(\sigma_v\) from the two observed spectra, but assuming
the systematic bias in the second spectrum is unknown. 3. Compare the
posterior distributions of \(f\) and \(\sigma_v\) obtained here to those
from Question 1.4, and report the mean, standard deviation, and 16-50-84
percentiles of the marginalized posterior distributions, as well as the
covariance matrix of the joint posterior distribution. 4. Discuss all
your results in the whole exercise.

\textbf{Hint:} 1. Modify the simulated data of the second spectrum by
adding 10 to the observed counts. 2. Infer parameters using the same
model as before in Question 1.2, but with the modified data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{91}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{spec\PYZus{}bias} \PY{o}{=} \PY{l+m+mi}{10}

\PY{c+c1}{\PYZsh{} Compute posteriors with biased second spectraum}
\PY{n}{f\PYZus{}grid\PYZus{}bias}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}bias}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}bias} \PY{o}{=} \PY{n}{spec\PYZus{}posterior\PYZus{}fs\PYZus{}2}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{spec2} \PY{o}{+} \PY{n}{spec\PYZus{}bias}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{n}{A2\PYZus{}true}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}bias}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}bias} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}bias}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}bias}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}bias}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the joint posteriors with the first spectrum and biased second spectrum using your favorite method}
\PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit\PYZus{}bias} \PY{o}{=} \PY{n}{joint\PYZus{}posterior\PYZus{}refit}\PY{p}{(}
    \PY{n}{x}\PY{p}{,} \PY{n}{spec1}\PY{p}{,} \PY{n}{spec2} \PY{o}{+} \PY{n}{spec\PYZus{}bias}\PY{p}{,} \PY{n}{x0}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{f\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}range}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}f}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}sigma\PYZus{}v}\PY{o}{=}\PY{l+m+mi}{500}
\PY{p}{)}

\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit\PYZus{}bias} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}
    \PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit\PYZus{}bias}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{92}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the results with biased data}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Results from the first spectrum (unbiased)}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs1\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f1\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v1\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Results from the second spectrum (unbiased)}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyles}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Results from second spectrum (biased)}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{f\PYZus{}grid\PYZus{}bias}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}bias}\PY{p}{,} \PY{n}{posterior\PYZus{}fs2\PYZus{}bias}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f2\PYZus{}bias}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v2\PYZus{}bias}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}bias}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Joint results from both spectra (unbiased)}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyles}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to plot joint results from both spectra (one biased)}
\PY{o}{.}\PY{o}{.}\PY{o}{.}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{f\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{f\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{10}\PY{p}{,} \PY{n}{f\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{30}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}f\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(f | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZus{}v | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_32_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{93}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to report and compare the summary statistics of f and sigma\PYZus{}v}
\PY{c+c1}{\PYZsh{} Report and compare summary statistics of f and sigma\PYZus{}v for different joint inferences}

\PY{c+c1}{\PYZsh{} Unbiased (refit)}
\PY{n}{mean\PYZus{}f\PYZus{}refit}\PY{p}{,} \PY{n}{std\PYZus{}f\PYZus{}refit}\PY{p}{,} \PY{n}{pct\PYZus{}f\PYZus{}refit} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma\PYZus{}refit}\PY{p}{,} \PY{n}{std\PYZus{}sigma\PYZus{}refit}\PY{p}{,} \PY{n}{pct\PYZus{}sigma\PYZus{}refit} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mf\PYZus{}refit}\PY{p}{,} \PY{n}{ms\PYZus{}refit}\PY{p}{,} \PY{n}{cov\PYZus{}refit} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Resampled combination}
\PY{n}{mean\PYZus{}f\PYZus{}res}\PY{p}{,} \PY{n}{std\PYZus{}f\PYZus{}res}\PY{p}{,} \PY{n}{pct\PYZus{}f\PYZus{}res} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma\PYZus{}res}\PY{p}{,} \PY{n}{std\PYZus{}sigma\PYZus{}res}\PY{p}{,} \PY{n}{pct\PYZus{}sigma\PYZus{}res} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}resample}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mf\PYZus{}res}\PY{p}{,} \PY{n}{ms\PYZus{}res}\PY{p}{,} \PY{n}{cov\PYZus{}res} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{f\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{sigma\PYZus{}v\PYZus{}grid\PYZus{}resample}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}resample}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Biased second spectrum (refit)}
\PY{n}{mean\PYZus{}f\PYZus{}bias}\PY{p}{,} \PY{n}{std\PYZus{}f\PYZus{}bias}\PY{p}{,} \PY{n}{pct\PYZus{}f\PYZus{}bias} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{f\PYZus{}vals\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}f\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}sigma\PYZus{}bias}\PY{p}{,} \PY{n}{std\PYZus{}sigma\PYZus{}bias}\PY{p}{,} \PY{n}{pct\PYZus{}sigma\PYZus{}bias} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{sigma\PYZus{}v\PYZus{}vals\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}sigma\PYZus{}v\PYZus{}combined\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mf\PYZus{}bias}\PY{p}{,} \PY{n}{ms\PYZus{}bias}\PY{p}{,} \PY{n}{cov\PYZus{}bias} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{combined\PYZus{}f\PYZus{}grid\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{combined\PYZus{}sigma\PYZus{}v\PYZus{}grid\PYZus{}refit\PYZus{}bias}\PY{p}{,} \PY{n}{combined\PYZus{}posterior\PYZus{}refit\PYZus{}bias}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print concise comparison}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Combined (refit, unbiased):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ f: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}f\PYZus{}refit}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f\PYZus{}refit}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}f\PYZus{}refit}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ sigma\PYZus{}v: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}sigma\PYZus{}refit}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma\PYZus{}refit}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}sigma\PYZus{}refit}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Joint means (from 2D):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mean f=}\PY{l+s+si}{\PYZob{}}\PY{n}{mf\PYZus{}refit}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean sigma\PYZus{}v=}\PY{l+s+si}{\PYZob{}}\PY{n}{ms\PYZus{}refit}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Covariance matrix (f, sigma\PYZus{}v):}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{cov\PYZus{}refit}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Combined (resample):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ f: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}f\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}f\PYZus{}res}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ sigma\PYZus{}v: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}sigma\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}sigma\PYZus{}res}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Joint means (from 2D):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mean f=}\PY{l+s+si}{\PYZob{}}\PY{n}{mf\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean sigma\PYZus{}v=}\PY{l+s+si}{\PYZob{}}\PY{n}{ms\PYZus{}res}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Covariance matrix (f, sigma\PYZus{}v):}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{cov\PYZus{}res}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Combined (refit, biased second spectrum):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ f: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}f\PYZus{}bias}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}f\PYZus{}bias}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}f\PYZus{}bias}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ sigma\PYZus{}v: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}sigma\PYZus{}bias}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}sigma\PYZus{}bias}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}sigma\PYZus{}bias}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Joint means (from 2D):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mean f=}\PY{l+s+si}{\PYZob{}}\PY{n}{mf\PYZus{}bias}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean sigma\PYZus{}v=}\PY{l+s+si}{\PYZob{}}\PY{n}{ms\PYZus{}bias}\PY{l+s+si}{:}\PY{l+s+s2}{.4f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Covariance matrix (f, sigma\PYZus{}v):}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{cov\PYZus{}bias}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Quick relative comparisons}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{rel}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{)}\PY{p}{:} \PY{k}{return} \PY{l+m+mf}{100.0}\PY{o}{*}\PY{p}{(}\PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{b}\PY{p}{)}\PY{o}{/}\PY{n}{b} \PY{k}{if} \PY{n}{b}\PY{o}{!=}\PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Relative std differences (resample vs refit, bias vs refit) [}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{]:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ std(f): resample vs refit = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel}\PY{p}{(}\PY{n}{std\PYZus{}f\PYZus{}res}\PY{p}{,}\PY{n}{std\PYZus{}f\PYZus{}refit}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{},  bias vs refit = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel}\PY{p}{(}\PY{n}{std\PYZus{}f\PYZus{}bias}\PY{p}{,}\PY{n}{std\PYZus{}f\PYZus{}refit}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ std(sigma\PYZus{}v): resample vs refit = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel}\PY{p}{(}\PY{n}{std\PYZus{}sigma\PYZus{}res}\PY{p}{,}\PY{n}{std\PYZus{}sigma\PYZus{}refit}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{},  bias vs refit = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel}\PY{p}{(}\PY{n}{std\PYZus{}sigma\PYZus{}bias}\PY{p}{,}\PY{n}{std\PYZus{}sigma\PYZus{}refit}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Combined (refit, unbiased):
 f: mean=25.3349, std=0.5178, 16-50-84=[24.81826297 25.33327783 25.85192293]
 sigma\_v: mean=50.2653, std=2.9955, 16-50-84=[47.29401799 50.16584822
53.23386323]
 Joint means (from 2D): mean f=25.3349, mean sigma\_v=50.2653
 Covariance matrix (f, sigma\_v):
 [[ 0.2681557  -0.40190673]
 [-0.40190673  8.97307827]]

Combined (resample):
 f: mean=25.3343, std=0.5249, 16-50-84=[24.81022976 25.33268514 25.85801923]
 sigma\_v: mean=50.1077, std=2.9893, 16-50-84=[47.14316478 50.008763
53.07001326]
 Joint means (from 2D): mean f=25.3343, mean sigma\_v=50.1077
 Covariance matrix (f, sigma\_v):
 [[ 0.27556734 -0.39134022]
 [-0.39134022  8.93587159]]

Combined (refit, biased second spectrum):
 f: mean=29.6395, std=0.5551, 16-50-84=[29.08608119 29.63785547 30.19283398]
 sigma\_v: mean=54.2995, std=3.1905, 16-50-84=[51.13786764 54.18494833
57.45778696]
 Joint means (from 2D): mean f=29.6395, mean sigma\_v=54.2995
 Covariance matrix (f, sigma\_v):
 [[ 0.30815024 -0.4491241 ]
 [-0.4491241  10.17900316]]

Relative std differences (resample vs refit, bias vs refit) [\%]:
 std(f): resample vs refit = +1.37\%,  bias vs refit = +7.20\%
 std(sigma\_v): resample vs refit = -0.21\%,  bias vs refit = +6.51\%
    \end{Verbatim}

    \subparagraph{Discussions}\label{discussions}

上面可以发现在正常做多元统计的情况下都可以得到比较好的结果，如果按流程进行参数变换，结果也是正常的；但是如果加入有偏的估计，可能会导致结果出现较大的偏差.

    \subsubsection{Exercise 2: Lighthouse
problem}\label{exercise-2-lighthouse-problem}

A lighthouse is located at an unknown position \((\alpha, \beta)\),
where \(\alpha\) is the position along the shore and \(\beta\) is the
distance from the shore. The lighthouse emits light in random
directions, and the light hits the coast at positions \(x_k\).

See the slides of Lecture 4 for the illustration. The likelihood of
observing a flash at position \(x_k\) given the lighthouse position
\((\alpha, \beta)\) is:

\[p(x_k | \alpha, \beta, I) = \dfrac{\beta}{\pi \left[ \beta^2 + (x_k - \alpha)^2 \right]}\]

\paragraph{Question 2.1: infer lighthouse
position}\label{question-2.1-infer-lighthouse-position}

\textbf{Tasks:} 1. Simulate \(N=50\) flash positions \(x_k\) from the
lighthouse, with the true position \((\alpha, \beta) = (0, 1.0)\). 2.
Infer the position \((\alpha, \beta)\) from the simulated flash
positions using uniform priors \(p(\alpha, \beta | I) = \text{const}\)
with the ranges \(\alpha \in [-5, 5]\) and \(\beta \in [0.1, 5]\). 3.
Plot the joint posterior distribution of \((\alpha, \beta)\) as well as
the marginalized posterior distributions of each parameter. 4. Report
the mean, standard deviation, and 16-50-84 percentiles of the
marginalized posterior distributions, as well as the covariance matrix
of the joint posterior distribution.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{94}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}lighthouse\PYZus{}flashes}\PY{p}{(}\PY{n}{num}\PY{p}{,} \PY{n}{alpha}\PY{p}{,} \PY{n}{beta}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Simulate positions of lighthouse flashes on the shoreline}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        num : int, number of flashes to simulate}
\PY{l+s+sd}{        alpha : float, lighthouse position on x\PYZhy{}axis}
\PY{l+s+sd}{        beta : float, lighthouse position on y\PYZhy{}axis}
\PY{l+s+sd}{        seed : int, random seed for reproducibility (default: 42)}
\PY{l+s+sd}{    Returns: array of x positions of the flashes}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{n}{theta} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{uniform}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{num}\PY{p}{)}
    \PY{n}{x} \PY{o}{=} \PY{n}{alpha} \PY{o}{+} \PY{n}{beta} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{tan}\PY{p}{(}\PY{n}{theta}\PY{p}{)}
    \PY{k}{return} \PY{n}{x}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{95}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{lighthouse\PYZus{}posterior}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of lighthouse position (a,b) given observed flash positions.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data: array\PYZhy{}like, observed x positions of the flashes}
\PY{l+s+sd}{        a\PYZus{}range: list, prior range of a values (default: [\PYZhy{}5, 5])}
\PY{l+s+sd}{        b\PYZus{}range: list, prior range of b values (default: [0.1, 5])}
\PY{l+s+sd}{        n\PYZus{}a: int, number of a samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}b: int, number of b samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        a\PYZus{}grid: numpy array, grid of a values}
\PY{l+s+sd}{        b\PYZus{}grid: numpy array, grid of b values}
\PY{l+s+sd}{        posterior: numpy array, joint posterior distribution of a and b}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} Create grids for a and b}
    \PY{n}{a\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{p}{)}
    \PY{n}{b\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{p}{)}
    \PY{n}{dadb} \PY{o}{=} \PY{p}{(}\PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}a} \PY{o}{*} \PY{p}{(}\PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}b}
    \PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{a\PYZus{}vals}\PY{p}{,} \PY{n}{b\PYZus{}vals}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the joint posterior distribution}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{n}{data} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{data}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} compute denominator for each data point on the (b,a) grid using broadcasting}
    \PY{c+c1}{\PYZsh{} shapes: data[:,None,None] \PYZhy{}\PYZgt{} (N, n\PYZus{}b, n\PYZus{}a), a\PYZus{}grid[None,:,:] \PYZhy{}\PYZgt{} (1, n\PYZus{}b, n\PYZus{}a)}
    \PY{n}{denom} \PY{o}{=} \PY{n}{b\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{a\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{c+c1}{\PYZsh{} log\PYZhy{}likelihood: sum\PYZus{}k [ log(beta) \PYZhy{} log(pi) \PYZhy{} log(beta\PYZca{}2 + (x\PYZus{}k \PYZhy{} a)\PYZca{}2) ]}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{b\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]} \PY{o}{+} \PY{n}{eps}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{denom} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} uniform prior over the provided ranges \PYZhy{}\PYZgt{} constant, so log\PYZus{}prior = 0}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}like}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior}\PY{p}{)} \PY{o}{*} \PY{n}{dadb}  \PY{c+c1}{\PYZsh{} Normalize posterior}
    \PY{k}{return} \PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{96}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{nflash} \PY{o}{=} \PY{l+m+mi}{50}
\PY{n}{a\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{0}
\PY{n}{b\PYZus{}true} \PY{o}{=} \PY{l+m+mi}{1}
\PY{n}{flash\PYZus{}data} \PY{o}{=} \PY{n}{sim\PYZus{}lighthouse\PYZus{}flashes}\PY{p}{(}\PY{n}{nflash}\PY{p}{,} \PY{n}{a\PYZus{}true}\PY{p}{,} \PY{n}{b\PYZus{}true}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{n}{seed}\PY{p}{)}

\PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse} \PY{o}{=} \PY{n}{lighthouse\PYZus{}posterior}\PY{p}{(}\PY{n}{flash\PYZus{}data}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}
\PY{n}{a\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a}\PY{p}{,} \PY{n}{b\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{97}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{a\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}b}\PY{p}{,} \PY{n}{b\PYZus{}vals}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{a\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{b\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{a\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{b\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{a\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{a\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{b\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{b\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{beta\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{beta | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_39_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{98}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to report the summary statistics}
\PY{c+c1}{\PYZsh{} Report summary statistics for Question 2.1 posterior of (alpha, beta)}
\PY{n}{mean\PYZus{}a}\PY{p}{,} \PY{n}{std\PYZus{}a}\PY{p}{,} \PY{n}{pct\PYZus{}a} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{a\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}b}\PY{p}{,} \PY{n}{std\PYZus{}b}\PY{p}{,} \PY{n}{pct\PYZus{}b} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{b\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{n}{mean\PYZus{}a\PYZus{}joint}\PY{p}{,} \PY{n}{mean\PYZus{}b\PYZus{}joint}\PY{p}{,} \PY{n}{cov\PYZus{}ab} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Marginalized results:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ alpha: mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}a}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}a}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}a}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ beta : mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}b}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}b}\PY{l+s+si}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Joint posterior means from full 2D posterior:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ mean alpha = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}a\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean beta = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Covariance matrix (alpha, beta):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{cov\PYZus{}ab}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Marginalized results:
 alpha: mean = 0.050002, std = 0.193516, 16-50-84 = [-0.13876655  0.04534612
0.23848185]
 beta : mean = 0.987411, std = 0.206081, 16-50-84 = [0.78684475 0.9670721
1.18727136]

Joint posterior means from full 2D posterior:
 mean alpha = 0.050002, mean beta = 0.987411

Covariance matrix (alpha, beta):
[[0.03744849 0.00503377]
 [0.00503377 0.04246944]]
    \end{Verbatim}

    \paragraph{Question 2.2: fixed parameter
vs.~marginalization}\label{question-2.2-fixed-parameter-vs.-marginalization}

Suppose that \(\alpha\) is fixed in the following two cases: 1.
\(\alpha\) is fixed at the true value \(\alpha = 0\) from other
observations; 2. \(\alpha\) is fixed to the sample mean of the observed
flash positions, i.e., \(\alpha = \dfrac{1}{N} \sum_{k=1}^N x_k\).

\textbf{Tasks:} 1. Infer \(\beta\) from the simulated flash positions in
both cases using a uniform prior with the range \(\beta \in [0.1, 5]\).
2. Plot the posterior distributions of \(\beta\) obtained from the two
cases above and that from Question 2.1 where \(\alpha\) is marginalized
over. 3. Compare the summary statistics (mean, standard deviation, and
16-50-84 percentiles) of the marginalized posterior distributions of
\(\beta\) obtained from the two cases above to that from Question 2.1
where \(\alpha\) is marginalized over.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{99}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}lighthouse\PYZus{}fix\PYZus{}alpha}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of lighthouse position b given observed flash positions and fixed alpha.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data: array\PYZhy{}like, observed x positions of the flashes}
\PY{l+s+sd}{        alpha: float, fixed lighthouse position on x\PYZhy{}axis}
\PY{l+s+sd}{        b\PYZus{}range: list, prior range of b values (default: [0.1, 5])}
\PY{l+s+sd}{        n\PYZus{}b: int, number of b samples (default: 500)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        b\PYZus{}vals: array, list of b values}
\PY{l+s+sd}{        posterior: array, posterior distribution of b}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{n}{data} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{data}\PY{p}{)}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{n}{b\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} compute log\PYZhy{}likelihood for each b on the grid}
    \PY{c+c1}{\PYZsh{} shapes: data[:,None] \PYZhy{}\PYZgt{} (N,1), b\PYZus{}vals[None,:] \PYZhy{}\PYZgt{} (1,n\PYZus{}b)}
    \PY{n}{denom} \PY{o}{=} \PY{n}{b\PYZus{}vals}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{alpha}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{b\PYZus{}vals}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{]} \PY{o}{+} \PY{n}{eps}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{denom} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} uniform prior over b \PYZhy{}\PYZgt{} log\PYZus{}prior = 0}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}like}
    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} normalize to unit integral over b}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trapezoid}\PY{p}{(}\PY{n}{posterior}\PY{p}{,} \PY{n}{b\PYZus{}vals}\PY{p}{)}
    \PY{k}{return} \PY{n}{b\PYZus{}vals}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the posteriors with fixed alpha values}
\PY{c+c1}{\PYZsh{} Compute posterior of beta with alpha fixed at true value 0}
\PY{n}{b\PYZus{}vals\PYZus{}alpha\PYZus{}0}\PY{p}{,} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}0} \PY{o}{=} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}fix\PYZus{}alpha}\PY{p}{(}\PY{n}{flash\PYZus{}data}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{n+nb}{len}\PY{p}{(}\PY{n}{b\PYZus{}vals}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Compute posterior of beta with alpha fixed at sample mean of the data}
\PY{n}{alpha\PYZus{}mean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{flash\PYZus{}data}\PY{p}{)}
\PY{n}{b\PYZus{}vals\PYZus{}alpha\PYZus{}mean}\PY{p}{,} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}mean} \PY{o}{=} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}fix\PYZus{}alpha}\PY{p}{(}\PY{n}{flash\PYZus{}data}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{n}{alpha\PYZus{}mean}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{n+nb}{len}\PY{p}{(}\PY{n}{b\PYZus{}vals}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{101}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{7}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Mariginal posterior from joint fit}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{b\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b} \PY{o}{/} \PY{n}{post\PYZus{}marg\PYZus{}b}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Joint fit}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Posterior with fixed alpha=0}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{b\PYZus{}vals\PYZus{}alpha\PYZus{}0}\PY{p}{,} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}0} \PY{o}{/} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}0}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fix \PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha=0\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Posterior with fixed alpha=mean(data)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{b\PYZus{}vals\PYZus{}alpha\PYZus{}mean}\PY{p}{,} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}mean} \PY{o}{/} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}mean}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fix \PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha=}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{langle x }\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{rangle\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{b\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{beta\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{beta | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_44_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{102}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to compare the summary statistics}
\PY{c+c1}{\PYZsh{} Compute and print summary statistics for beta posteriors (Question 2.2)}
\PY{n}{mean\PYZus{}b\PYZus{}joint}\PY{p}{,} \PY{n}{std\PYZus{}b\PYZus{}joint}\PY{p}{,} \PY{n}{pct\PYZus{}b\PYZus{}joint} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{b\PYZus{}vals}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}b\PYZus{}fix0}\PY{p}{,} \PY{n}{std\PYZus{}b\PYZus{}fix0}\PY{p}{,} \PY{n}{pct\PYZus{}b\PYZus{}fix0} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{b\PYZus{}vals\PYZus{}alpha\PYZus{}0}\PY{p}{,} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}0}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}b\PYZus{}fixmean}\PY{p}{,} \PY{n}{std\PYZus{}b\PYZus{}fixmean}\PY{p}{,} \PY{n}{pct\PYZus{}b\PYZus{}fixmean} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{b\PYZus{}vals\PYZus{}alpha\PYZus{}mean}\PY{p}{,} \PY{n}{posterior\PYZus{}b\PYZus{}alpha\PYZus{}mean}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{比较 beta 的后验统计量：}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{1) 边际化 alpha (joint fit):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}b\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}b\PYZus{}joint}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2) 固定 alpha = 0:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}fix0}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}b\PYZus{}fix0}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}b\PYZus{}fix0}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{3) 固定 alpha = sample mean:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{   mean = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}fixmean}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std = }\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}b\PYZus{}fixmean}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84 = }\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}b\PYZus{}fixmean}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{rel\PYZus{}diff}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{)}\PY{p}{:}
    \PY{k}{return} \PY{l+m+mf}{100.0}\PY{o}{*}\PY{p}{(}\PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{b}\PY{p}{)}\PY{o}{/}\PY{n}{b} \PY{k}{if} \PY{n}{b}\PY{o}{!=}\PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{nan}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{相对标准差差异 (相对于边际化结果，}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{)：}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ 固定 alpha=0  相对 std  = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}b\PYZus{}fix0}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}b\PYZus{}joint}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ 固定 alpha=mean 相对 std  = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}diff}\PY{p}{(}\PY{n}{std\PYZus{}b\PYZus{}fixmean}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}b\PYZus{}joint}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
比较 beta 的后验统计量：
1) 边际化 alpha (joint fit):
   mean = 0.987411, std = 0.206081, 16-50-84 = [0.78684475 0.9670721
1.18727136]

2) 固定 alpha = 0:
   mean = 0.958733, std = 0.198456, 16-50-84 = [0.76566423 0.93905711
1.15104847]

3) 固定 alpha = sample mean:
   mean = 1.592835, std = 0.273630, 16-50-84 = [1.32553793 1.56990384
1.85916739]

相对标准差差异 (相对于边际化结果，\%)：
 固定 alpha=0  相对 std  = -3.70\%
 固定 alpha=mean 相对 std  = +32.78\%
    \end{Verbatim}

    \paragraph{Question 2.3: truncated
data}\label{question-2.3-truncated-data}

Assume that due to observational limitations, only the flash positions
within the range \(x \in [x_{\rm min}, x_{\rm max}]\) can be detected.
The flashes outside this range are not observed.

In this case, the angle of the lighthouse emission is still uniformly
distributed, but within a limited range
\([\theta_{\rm min}, \theta_{\rm max}]\), where

\(\begin{aligned}
\theta_{\rm min} &= \arctan \left( \dfrac{x_{\rm min} - \alpha}{\beta} \right) \\
\theta_{\rm max} &= \arctan \left( \dfrac{x_{\rm max} - \alpha}{\beta} \right) \\
\end{aligned}\)

The likelihood of observing a flash at position \(x_k\) given the
lighthouse position \((\alpha, \beta)\) now becomes:

\(p(x_k | \alpha, \beta, \theta_{\rm min}, \theta_{\rm max}, I) = \dfrac{\beta}{\left[ \beta^2 + (x_k - \alpha)^2 \right] (\theta_{\rm max} - \theta_{\rm min})}\)

\textbf{Tasks:} 1. Simulate \(N=50\) flash positions \(x_k\) from the
lighthouse, with the true position \((\alpha, \beta) = (0, 1.0)\), but
only keep those within the range \(x \in [-3, 3]\). 2. Infer the
position \((\alpha, \beta)\) from the truncated flash positions using
uniform priors \(p(\alpha, \beta | I) = \text{const}\) with the ranges
\(\alpha \in [-5, 5]\) and \(\beta \in [0.1, 5]\), in the following two
cases: - Ignoring the truncation and using the standard likelihood
function; - Taking the truncation into account in the likelihood
function. 3. Plot the joint posterior distributions of
\((\alpha, \beta)\) as well as the marginalized posterior distributions
of each parameter for the two cases. 4. Report the mean, standard
deviation, and 16-50-84 percentiles of the marginalized posterior
distributions, as well as the covariance matrix of the joint posterior
distribution. 5. Discuss all your results in the whole exercise.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{103}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{posterior\PYZus{}lighthouse\PYZus{}truncated}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{xmin}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{xmax}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the posterior distribution of lighthouse position (a,b) given observed flash positions within [xmin, xmax].}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        data: array\PYZhy{}like, observed x positions of the flashes}
\PY{l+s+sd}{        a\PYZus{}range: list, prior range of a values (default: [\PYZhy{}5, 5])}
\PY{l+s+sd}{        b\PYZus{}range: list, prior range of b values (default: [0.1, 5])}
\PY{l+s+sd}{        n\PYZus{}a: int, number of a samples (default: 500)}
\PY{l+s+sd}{        n\PYZus{}b: int, number of b samples (default: 500)}
\PY{l+s+sd}{        xmin: float, minimum x value for truncation (default: \PYZhy{}3)}
\PY{l+s+sd}{        xmax: float, maximum x value for truncation (default: 3)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        a\PYZus{}grid: numpy array, grid of a values}
\PY{l+s+sd}{        b\PYZus{}grid: numpy array, grid of b values}
\PY{l+s+sd}{        posterior: numpy array, joint posterior distribution of a and b}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{n}{a\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{p}{)}
    \PY{n}{b\PYZus{}vals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{p}{)}
    \PY{n}{dadb} \PY{o}{=} \PY{p}{(}\PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{a\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}a} \PY{o}{*} \PY{p}{(}\PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{b\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{n\PYZus{}b}
    \PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{a\PYZus{}vals}\PY{p}{,} \PY{n}{b\PYZus{}vals}\PY{p}{)}

    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}12}
    \PY{n}{data} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{data}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} compute theta range for truncation: theta\PYZus{}max \PYZhy{} theta\PYZus{}min}
    \PY{n}{theta\PYZus{}max} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arctan}\PY{p}{(}\PY{p}{(}\PY{n}{xmax} \PY{o}{\PYZhy{}} \PY{n}{a\PYZus{}grid}\PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{n}{b\PYZus{}grid} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{)}
    \PY{n}{theta\PYZus{}min} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arctan}\PY{p}{(}\PY{p}{(}\PY{n}{xmin} \PY{o}{\PYZhy{}} \PY{n}{a\PYZus{}grid}\PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{n}{b\PYZus{}grid} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{)}
    \PY{n}{theta\PYZus{}range} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{theta\PYZus{}max} \PY{o}{\PYZhy{}} \PY{n}{theta\PYZus{}min}\PY{p}{,} \PY{n}{eps}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} compute denominator for each data point on the (b,a) grid using broadcasting}
    \PY{n}{denom} \PY{o}{=} \PY{n}{b\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{a\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}

    \PY{c+c1}{\PYZsh{} log\PYZhy{}likelihood using truncated likelihood:}
    \PY{c+c1}{\PYZsh{} log p(x\PYZus{}k|a,b) = log(beta) \PYZhy{} log(beta\PYZca{}2 + (x\PYZus{}k\PYZhy{}a)\PYZca{}2) \PYZhy{} log(theta\PYZus{}range)}
    \PY{n}{log\PYZus{}like} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{b\PYZus{}grid}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]} \PY{o}{+} \PY{n}{eps}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{denom} \PY{o}{+} \PY{n}{eps}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{theta\PYZus{}range}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]} \PY{o}{+} \PY{n}{eps}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} uniform prior over (a,b) \PYZhy{}\PYZgt{} constant, so log\PYZus{}prior = 0}
    \PY{n}{log\PYZus{}post} \PY{o}{=} \PY{n}{log\PYZus{}like}

    \PY{n}{posterior} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{log\PYZus{}post} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{log\PYZus{}post}\PY{p}{)}\PY{p}{)}
    \PY{n}{posterior} \PY{o}{/}\PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{posterior}\PY{p}{)} \PY{o}{*} \PY{n}{dadb}
    \PY{k}{return} \PY{n}{a\PYZus{}grid}\PY{p}{,} \PY{n}{b\PYZus{}grid}\PY{p}{,} \PY{n}{posterior}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{104}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Generate truncated flash data}
\PY{n}{sel} \PY{o}{=} \PY{p}{(}\PY{n}{flash\PYZus{}data} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{flash\PYZus{}data} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{flash\PYZus{}data\PYZus{}trunc} \PY{o}{=} \PY{n}{flash\PYZus{}data}\PY{p}{[}\PY{n}{sel}\PY{p}{]}

\PY{c+c1}{\PYZsh{} Compute the posteriors with truncated data using the correct likelihood}
\PY{n}{a\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}trunc} \PY{o}{=} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}truncated}\PY{p}{(}\PY{n}{flash\PYZus{}data\PYZus{}trunc}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{xmin}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{xmax}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{a\PYZus{}vals\PYZus{}trunc}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a\PYZus{}trunc}\PY{p}{,} \PY{n}{b\PYZus{}vals\PYZus{}trunc}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b\PYZus{}trunc} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{a\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}trunc}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Compute the posterior with truncated data using the likelihood ignoring truncation}
\PY{n}{a\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}naive} \PY{o}{=} \PY{n}{lighthouse\PYZus{}posterior}\PY{p}{(}\PY{n}{flash\PYZus{}data\PYZus{}trunc}\PY{p}{,} \PY{n}{a\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{b\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}a}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{n\PYZus{}b}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{)}
\PY{n}{a\PYZus{}vals\PYZus{}naive}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a\PYZus{}naive}\PY{p}{,} \PY{n}{b\PYZus{}vals\PYZus{}naive}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b\PYZus{}naive} \PY{o}{=} \PY{n}{marginalize\PYZus{}posterior}\PY{p}{(}\PY{n}{a\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}naive}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{105}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the posteriors for truncated data using both methods}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplots\PYZus{}adjust}\PY{p}{(}\PY{n}{hspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{wspace}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{ax0} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{colspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}
\PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot2grid}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{rowspan}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{sharey}\PY{o}{=}\PY{n}{ax0}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Posterior using correct truncated likelihood}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{a\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}trunc}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{a\PYZus{}vals\PYZus{}trunc}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a\PYZus{}trunc}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}b\PYZus{}trunc}\PY{p}{,} \PY{n}{b\PYZus{}vals\PYZus{}trunc}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Posterior using naive likelihood ignoring truncation}
\PY{n}{plot\PYZus{}credible\PYZus{}levels}\PY{p}{(}\PY{n}{ax0}\PY{p}{,} \PY{n}{a\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}naive}\PY{p}{,} \PY{n}{colors}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyles}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{a\PYZus{}vals\PYZus{}naive}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a\PYZus{}naive}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{post\PYZus{}marg\PYZus{}b\PYZus{}naive}\PY{p}{,} \PY{n}{b\PYZus{}vals\PYZus{}naive}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{a\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{b\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{a\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{b\PYZus{}true}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}yticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax1}\PY{o}{.}\PY{n}{get\PYZus{}xticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{setp}\PY{p}{(}\PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{visible}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: Adjust the axis limits as needed}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{p}{[}\PY{n}{a\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{a\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{n}{b\PYZus{}true} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{b\PYZus{}true} \PY{o}{+} \PY{l+m+mi}{4}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{k+kc}{None}\PY{p}{)}

\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax0}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{beta\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{alpha | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdl{}p(}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{beta | DI)\PYZdl{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_06_files/Exercise_week_06_49_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{106}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to report and compare the summary statistics}
\PY{c+c1}{\PYZsh{} Compare summary statistics for truncated (correct likelihood) vs naive (ignore truncation)}

\PY{c+c1}{\PYZsh{} Marginal summaries}
\PY{n}{mean\PYZus{}a\PYZus{}trunc}\PY{p}{,} \PY{n}{std\PYZus{}a\PYZus{}trunc}\PY{p}{,} \PY{n}{pct\PYZus{}a\PYZus{}trunc} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{a\PYZus{}vals\PYZus{}trunc}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a\PYZus{}trunc}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}b\PYZus{}trunc}\PY{p}{,} \PY{n}{std\PYZus{}b\PYZus{}trunc}\PY{p}{,} \PY{n}{pct\PYZus{}b\PYZus{}trunc} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{b\PYZus{}vals\PYZus{}trunc}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b\PYZus{}trunc}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{n}{mean\PYZus{}a\PYZus{}naive}\PY{p}{,} \PY{n}{std\PYZus{}a\PYZus{}naive}\PY{p}{,} \PY{n}{pct\PYZus{}a\PYZus{}naive} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{a\PYZus{}vals\PYZus{}naive}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}a\PYZus{}naive}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}
\PY{n}{mean\PYZus{}b\PYZus{}naive}\PY{p}{,} \PY{n}{std\PYZus{}b\PYZus{}naive}\PY{p}{,} \PY{n}{pct\PYZus{}b\PYZus{}naive} \PY{o}{=} \PY{n}{summarize\PYZus{}marginal}\PY{p}{(}\PY{n}{b\PYZus{}vals\PYZus{}naive}\PY{p}{,} \PY{n}{post\PYZus{}marg\PYZus{}b\PYZus{}naive}\PY{p}{,} \PY{n}{percentiles}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{16}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{84}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Joint means and covariances}
\PY{n}{mean\PYZus{}a\PYZus{}trunc\PYZus{}joint}\PY{p}{,} \PY{n}{mean\PYZus{}b\PYZus{}trunc\PYZus{}joint}\PY{p}{,} \PY{n}{cov\PYZus{}trunc} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{a\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}trunc}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}trunc}\PY{p}{)}
\PY{n}{mean\PYZus{}a\PYZus{}naive\PYZus{}joint}\PY{p}{,} \PY{n}{mean\PYZus{}b\PYZus{}naive\PYZus{}joint}\PY{p}{,} \PY{n}{cov\PYZus{}naive} \PY{o}{=} \PY{n}{covariance\PYZus{}from\PYZus{}2d}\PY{p}{(}\PY{n}{a\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{b\PYZus{}grid\PYZus{}naive}\PY{p}{,} \PY{n}{posterior\PYZus{}lighthouse\PYZus{}naive}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print concise comparison}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Truncated\PYZhy{}data (correct likelihood) \PYZhy{} Marginalized results:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ alpha: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}a\PYZus{}trunc}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}a\PYZus{}trunc}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}a\PYZus{}trunc}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ beta : mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}trunc}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}b\PYZus{}trunc}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}b\PYZus{}trunc}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Joint means (from 2D):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mean alpha=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}a\PYZus{}trunc\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean beta=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}trunc\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Covariance (alpha, beta):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{cov\PYZus{}trunc}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Naive (ignore truncation) \PYZhy{} Marginalized results:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ alpha: mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}a\PYZus{}naive}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}a\PYZus{}naive}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}a\PYZus{}naive}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ beta : mean=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}naive}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, std=}\PY{l+s+si}{\PYZob{}}\PY{n}{std\PYZus{}b\PYZus{}naive}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, 16\PYZhy{}50\PYZhy{}84=}\PY{l+s+si}{\PYZob{}}\PY{n}{pct\PYZus{}b\PYZus{}naive}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Joint means (from 2D):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{mean alpha=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}a\PYZus{}naive\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, mean beta=}\PY{l+s+si}{\PYZob{}}\PY{n}{mean\PYZus{}b\PYZus{}naive\PYZus{}joint}\PY{l+s+si}{:}\PY{l+s+s2}{.6f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ Covariance (alpha, beta):}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{cov\PYZus{}naive}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Relative differences in uncertainties (naive vs truncated)}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{rel}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{)}\PY{p}{:} \PY{k}{return} \PY{l+m+mf}{100.0}\PY{o}{*}\PY{p}{(}\PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{b}\PY{p}{)}\PY{o}{/}\PY{n}{b} \PY{k}{if} \PY{n}{b}\PY{o}{!=}\PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{nan}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Relative differences in std (naive vs truncated) [}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{]:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ std(alpha): }\PY{l+s+si}{\PYZob{}}\PY{n}{rel}\PY{p}{(}\PY{n}{std\PYZus{}a\PYZus{}naive}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}a\PYZus{}trunc}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ std(beta) : }\PY{l+s+si}{\PYZob{}}\PY{n}{rel}\PY{p}{(}\PY{n}{std\PYZus{}b\PYZus{}naive}\PY{p}{,}\PY{+w}{ }\PY{n}{std\PYZus{}b\PYZus{}trunc}\PY{p}{)}\PY{l+s+si}{:}\PY{l+s+s2}{+.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZpc{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print true values for reference}
\PY{n+nb}{print}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True values: alpha =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{a\PYZus{}true}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{, beta =}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{b\PYZus{}true}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Truncated-data (correct likelihood) - Marginalized results:
 alpha: mean=0.118507, std=0.459595, 16-50-84=[-0.20938383  0.07440176
0.41939215]
 beta : mean=1.839468, std=0.918042, 16-50-84=[1.06929984 1.56284717 2.66095767]
 Joint means (from 2D): mean alpha=0.118398, mean beta=1.839453
 Covariance (alpha, beta):
[[0.21078056 0.11104495]
 [0.11104495 0.84276468]]

Naive (ignore truncation) - Marginalized results:
 alpha: mean=-0.002017, std=0.161738, 16-50-84=[-0.16092241 -0.00438245
0.15653334]
 beta : mean=0.738827, std=0.158164, 16-50-84=[0.58519814 0.72262297 0.8918482 ]
 Joint means (from 2D): mean alpha=-0.002017, mean beta=0.738827
 Covariance (alpha, beta):
[[0.02615906 0.00224972]
 [0.00224972 0.02501576]]

Relative differences in std (naive vs truncated) [\%]:
 std(alpha): -64.81\%
 std(beta) : -82.77\%

True values: alpha = 0 , beta = 1
    \end{Verbatim}

    \subparagraph{Discussions}\label{discussions}

在 \((\alpha,\beta)\)
位置的估计上，如果直接取边缘化，得到的结果还算是比较准确；但是如果固定
\(\alpha=\langle x\rangle\)
就会出现比较大的偏差；同时不同的边缘化方案也会造成结果的较大差异.

    \subsubsection{Note: steps for submitting the
exercise}\label{note-steps-for-submitting-the-exercise}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In the menu bar, select \texttt{File\ \textgreater{}\ Download} to
  download your notebook as a \texttt{.ipynb} file.
\item
  Select
  \texttt{File\ \textgreater{}\ Save\ and\ Export\ Notebook\ As\ \textgreater{}\ PDF}
  to export your notebook as a PDF file.
\item
  Combine the \texttt{.ipynb} and \texttt{.pdf} files into a single
  \texttt{.zip} or \texttt{.tar.gz} archive.
\item
  Upload your archive to the web learning platform (网络学堂).
\end{enumerate}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
