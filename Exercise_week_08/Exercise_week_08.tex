\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    \usepackage{ctex}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \makeatletter
    \newsavebox\pandoc@box
    \newcommand*\pandocbounded[1]{%
      \sbox\pandoc@box{#1}%
      % scaling factors for width and height
      \Gscale@div\@tempa\textheight{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
      \Gscale@div\@tempb\linewidth{\wd\pandoc@box}%
      % select the smaller of both
      \ifdim\@tempb\p@<\@tempa\p@
        \let\@tempa\@tempb
      \fi
      % scaling accordingly (\@tempa < 1)
      \ifdim\@tempa\p@<\p@
        \scalebox{\@tempa}{\usebox\pandoc@box}%
      % scaling not needed, use as it is
      \else
        \usebox{\pandoc@box}%
      \fi
    }
    \makeatother

    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Exercise\_week\_08}
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \section{Statistical Methods in Astrophysics
Exercises}\label{statistical-methods-in-astrophysics-exercises}

\subsection{Week 07: Regression \&
Samplers}\label{week-07-regression-samplers}

\subsubsection{Personal Information}\label{personal-information}

\textbf{Name:} physnya

    \subsubsection{Exercise 1: Light curve
fitting}\label{exercise-1-light-curve-fitting}

The brightness of a variable star varies with time following the
following sinusoidal model:

\(m(t) = A \sin \left( \dfrac{2 \pi t}{T} + \phi \right) + m_0\)

where \(A\) is the amplitude, \(T\) is the period, \(\phi\) is the
phase, and \(m_0\) is the mean magnitude.

The star is observed at \(N=32\) different random times \(t_i\) (in
days) over a year. Due to the variability of observing conditions, the
measurement uncertainties of the observed magnitudes follow a
heteroscedastic distribution, i.e., different data points have different
uncertainties.

The expected uncertainties \(\{\sigma_i\}\) are uniformly distributed
between 0.2 mag and 0.4 mag. The observed magnitudes \(m_i\) are
generated by adding Gaussian noise to the true magnitudes at the
observation times:

\(m_i = m(t_i) + \epsilon_i\),

where \(\epsilon_i \sim \mathcal{N}(0, \sigma_i^2)\), i.e., Gaussian
noise with zero mean and standard deviation \(\sigma_i\).

\paragraph{Question 1.1: Gaussian process
regression}\label{question-1.1-gaussian-process-regression}

For Gaussian process regression, the kernel function describes the
covariance between different data points. We consider the Radial Basis
Function (RBF) kernel and the periodic kernel for this exercise.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The Radial Basis Function (RBF) kernel is defined as:

  \(k(x_i, x_j) = \sigma^2 \exp \left( -\dfrac{(x_i - x_j)^2}{2 l^2} \right)\)

  where \(\sigma^2\) is the signal variance and \(l\) is the length
  scale.
\item
  The periodic kernel is defined as:

  \(k(x_i, x_j) = \sigma^2 \exp \left( -\dfrac{2 \sin^2 \left( \pi |x_i - x_j| / p \right)}{l^2} \right)\)

  where \(\sigma^2\) is the signal variance, \(l\) is the length scale,
  and \(p\) is the period. For simplicity, we fix \(\sigma^2 = 1\) for
  the periodic kernel.
\end{enumerate}

\textbf{Tasks:} 1. Simulate the light curve data
\(\{t_i, m_i, \sigma_i\}\) using the following true parameters:
\(A=1.5\) mag, \(T=100\) days, \(\phi=1\) rad, and \(m_0=15\) mag. Plot
the simulated light curve data with error bars, and overlay the true
light curve model. 2. Predict the brightness of the star at
\(t=[100,200,300,400]\) days along with the associated uncertainties
using Gaussian process regression with both the RBF and periodic
kernels, and compare the results with those from the true model. 3. Plot
the predictive bands (mean ± 1σ) from both the RBF and periodic kernels
over the time range of 0 to 400 days.

\textbf{Hints:} 1. You can use the \texttt{GaussianProcessRegressor}
class from the \texttt{sklearn.gaussian\_process} module to perform
Gaussian process regression. Make sure to incorporate the measurement
uncertainties \(\sigma_i\) into the regression model. 2. The RBF kernel
can be implemented using the \texttt{RBF} class from the
\texttt{sklearn.gaussian\_process.kernels} module. 3. The periodic
kernel with \(\sigma^2 = 1\) can be implemented using the
\texttt{ExpSineSquared} class from the
\texttt{sklearn.gaussian\_process.kernels} module.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{98}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: Run this cell in the first place}
\PY{c+c1}{\PYZsh{} Load packages for numerical calculations and plotting}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{numpy}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{np}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{pandas}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{pd}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{plt}
\PY{c+c1}{\PYZsh{} Enable inline plotting in Jupyter notebooks}
\PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.dpi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{300}
\PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\PY{n}{plt}\PY{o}{.}\PY{n}{rc}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{usetex} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{rc}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{family} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{serif}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{99}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Uncomment to suppress UltraNest debugging info (only run this if you finish all exercises and would like concise outputs)}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{logging}\PY{o}{,}\PY{+w}{ }\PY{n+nn}{sys}
\PY{n}{logger} \PY{o}{=} \PY{n}{logging}\PY{o}{.}\PY{n}{getLogger}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ultranest}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{handler} \PY{o}{=} \PY{n}{logging}\PY{o}{.}\PY{n}{StreamHandler}\PY{p}{(}\PY{n}{sys}\PY{o}{.}\PY{n}{stdout}\PY{p}{)}
\PY{n}{handler}\PY{o}{.}\PY{n}{setLevel}\PY{p}{(}\PY{n}{logging}\PY{o}{.}\PY{n}{ERROR}\PY{p}{)}
\PY{n}{logger}\PY{o}{.}\PY{n}{addHandler}\PY{p}{(}\PY{n}{handler}\PY{p}{)}
\PY{n}{logger}\PY{o}{.}\PY{n}{setLevel}\PY{p}{(}\PY{n}{logging}\PY{o}{.}\PY{n}{ERROR}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{phi}\PY{p}{,} \PY{n}{m0}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Light curve model: sinusoidal variability.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        t: array, time array in days}
\PY{l+s+sd}{        A: float, amplitude of variability}
\PY{l+s+sd}{        T: float, period of variability in days}
\PY{l+s+sd}{        phi: float, phase of variability}
\PY{l+s+sd}{        m0: float, mean magnitude}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        m: array, model magnitudes at times t}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{m} \PY{o}{=} \PY{n}{A} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{n}{t} \PY{o}{/} \PY{n}{T} \PY{o}{+} \PY{n}{phi}\PY{p}{)} \PY{o}{+} \PY{n}{m0}
    \PY{k}{return} \PY{n}{m}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}lightcurve}\PY{p}{(}\PY{n}{ndays}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{l+m+mf}{1.5}\PY{p}{,} \PY{n}{T}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{phi}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{,} \PY{n}{m0}\PY{o}{=}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Simulate a light curve with Gaussian noise.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        ndays: int, number of days to simulate}
\PY{l+s+sd}{        A: float, amplitude of variability}
\PY{l+s+sd}{        T: float, period of variability in days}
\PY{l+s+sd}{        phi: float, phase of variability}
\PY{l+s+sd}{        m0: float, mean magnitude}
\PY{l+s+sd}{        seed: int, random seed for reproducibility}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        t: array, time array in days}
\PY{l+s+sd}{        m\PYZus{}obs: array, observed magnitudes with noise}
\PY{l+s+sd}{        sigma: array, measurement uncertainties}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} observation times (days) drawn randomly over one year}
    \PY{n}{t} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{uniform}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{365}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{ndays}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} heteroscedastic uncertainties between 0.2 and 0.4 mag}
    \PY{n}{sigma} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{uniform}\PY{p}{(}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mf}{0.4}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{ndays}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} true magnitudes and noisy observations}
    \PY{n}{m\PYZus{}true} \PY{o}{=} \PY{n}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{phi}\PY{p}{,} \PY{n}{m0}\PY{p}{)}
    \PY{n}{m\PYZus{}obs} \PY{o}{=} \PY{n}{m\PYZus{}true} \PY{o}{+} \PY{n}{rng}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} sort by time for nicer plotting}
    \PY{n}{idx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{argsort}\PY{p}{(}\PY{n}{t}\PY{p}{)}
    \PY{n}{t} \PY{o}{=} \PY{n}{t}\PY{p}{[}\PY{n}{idx}\PY{p}{]}
    \PY{n}{m\PYZus{}obs} \PY{o}{=} \PY{n}{m\PYZus{}obs}\PY{p}{[}\PY{n}{idx}\PY{p}{]}
    \PY{n}{sigma} \PY{o}{=} \PY{n}{sigma}\PY{p}{[}\PY{n}{idx}\PY{p}{]}
    \PY{k}{return} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Set the random seed}
\PY{n}{seed} \PY{o}{=} \PY{l+m+mi}{2024011182}  \PY{c+c1}{\PYZsh{} NOTE: EDIT HERE to insert your seed}

\PY{c+c1}{\PYZsh{} Setup parameters}
\PY{n}{ndays} \PY{o}{=} \PY{l+m+mi}{32}
\PY{n}{param\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{A}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{T}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{phi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{param\PYZus{}true} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{1.5}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{,} \PY{l+m+mf}{15.0}\PY{p}{]}
\PY{n}{param\PYZus{}ranges} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{300}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Simulate the light curve}
\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma} \PY{o}{=} \PY{n}{sim\PYZus{}lightcurve}\PY{p}{(}\PY{n}{ndays}\PY{p}{,} \PY{o}{*}\PY{n}{param\PYZus{}true}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{n}{seed}\PY{p}{)}

\PY{n}{x\PYZus{}model} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}
\PY{n}{y\PYZus{}model} \PY{o}{=} \PY{n}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{o}{*}\PY{n}{param\PYZus{}true}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{102}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{capsize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time (days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude (mag)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simulated Light Curve}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_6_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{103}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{gaussian\PYZus{}process}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{GaussianProcessRegressor}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{gaussian\PYZus{}process}\PY{n+nn}{.}\PY{n+nn}{kernels}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{RBF}\PY{p}{,} \PY{n}{ExpSineSquared}

\PY{c+c1}{\PYZsh{} Define the RBF kernel with length scale bounds}
\PY{n}{kernel\PYZus{}rbf} \PY{o}{=} \PY{l+m+mf}{1.0} \PY{o}{*} \PY{n}{RBF}\PY{p}{(}\PY{n}{length\PYZus{}scale\PYZus{}bounds}\PY{o}{=}\PY{p}{(}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create the Gaussian Process model with RBF kernel}
\PY{n}{gp\PYZus{}rbf} \PY{o}{=} \PY{n}{GaussianProcessRegressor}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{n}{kernel\PYZus{}rbf}\PY{p}{,}
        \PY{n}{alpha}\PY{o}{=}\PY{n}{sigma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mf}{1e\PYZhy{}8}\PY{p}{,}    \PY{c+c1}{\PYZsh{} NOTE: EDIT here to set the variance of the measurement noise}
        \PY{n}{normalize\PYZus{}y}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}         \PY{c+c1}{\PYZsh{} normalize the target values for zero mean and unit variance}
        \PY{n}{n\PYZus{}restarts\PYZus{}optimizer}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,}  \PY{c+c1}{\PYZsh{} steps to perform during hyperparameter optimization}
        \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{seed}\PY{o}{+}\PY{l+m+mi}{1}
\PY{p}{)}

\PY{c+c1}{\PYZsh{} Fit to the observed data}
\PY{n}{gp\PYZus{}rbf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{t}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{103}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
GaussianProcessRegressor(alpha=array([0.07115986, 0.11369829, 0.08167243,
0.13187349, 0.10001009,
       0.12760449, 0.13564863, 0.13517209, 0.10022079, 0.15317858,
       0.11068163, 0.10852515, 0.11290723, 0.05213118, 0.04416804,
       0.13512367, 0.14350412, 0.07509209, 0.06545762, 0.15027231,
       0.08981334, 0.14751943, 0.15437905, 0.04889111, 0.14035868,
       0.04137009, 0.04736292, 0.05196575, 0.07326026, 0.13052776,
       0.070403  , 0.09973682]),
                         kernel=1**2 * RBF(length\_scale=1),
                         n\_restarts\_optimizer=10, normalize\_y=True,
                         random\_state=2024011183)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{104}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{t\PYZus{}test} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{200}\PY{p}{,} \PY{l+m+mi}{300}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{]}\PY{p}{)}
\PY{n}{m\PYZus{}test\PYZus{}true} \PY{o}{=} \PY{n}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{t\PYZus{}test}\PY{p}{,} \PY{o}{*}\PY{n}{param\PYZus{}true}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to make predictions with the trained GP model}
\PY{n}{m\PYZus{}pred\PYZus{}rbf}\PY{p}{,} \PY{n}{sigma\PYZus{}pred\PYZus{}rbf} \PY{o}{=} \PY{n}{gp\PYZus{}rbf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{t\PYZus{}test}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{return\PYZus{}std}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Relative errors}
\PY{n}{rel\PYZus{}error\PYZus{}rbf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{m\PYZus{}pred\PYZus{}rbf} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}test\PYZus{}true}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{m\PYZus{}test\PYZus{}true}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Relative errors normalized by predicted uncertainties}
\PY{n}{rel\PYZus{}error\PYZus{}norm\PYZus{}rbf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{m\PYZus{}pred\PYZus{}rbf} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}test\PYZus{}true}\PY{p}{)} \PY{o}{/} \PY{n}{sigma\PYZus{}pred\PYZus{}rbf}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Predictions with RBF kernel:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{ti}\PY{p}{,} \PY{n}{mi}\PY{p}{,} \PY{n}{si}\PY{p}{,} \PY{n}{re}\PY{p}{,} \PY{n}{re\PYZus{}norm} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{t\PYZus{}test}\PY{o}{.}\PY{n}{flatten}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{m\PYZus{}pred\PYZus{}rbf}\PY{p}{,} \PY{n}{sigma\PYZus{}pred\PYZus{}rbf}\PY{p}{,} \PY{n}{rel\PYZus{}error\PYZus{}rbf}\PY{p}{,} \PY{n}{rel\PYZus{}error\PYZus{}norm\PYZus{}rbf}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{:}\PY{l+s+s2}{.1f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ days:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{m = }\PY{l+s+si}{\PYZob{}}\PY{n}{mi}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ ± }\PY{l+s+si}{\PYZob{}}\PY{n}{si}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ mag (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{re}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, normalized = }\PY{l+s+si}{\PYZob{}}\PY{n}{re\PYZus{}norm}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ sigma)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Predictions with RBF kernel:
t = 100.0 days:
        m = 16.430 ± 0.363 mag (relative error = 1.03\%, normalized = 0.46 sigma)
t = 200.0 days:
        m = 16.206 ± 0.162 mag (relative error = 0.34\%, normalized = 0.35 sigma)
t = 300.0 days:
        m = 16.337 ± 0.169 mag (relative error = 0.46\%, normalized = 0.44 sigma)
t = 400.0 days:
        m = 14.913 ± 1.095 mag (relative error = 8.30\%, normalized = 1.23 sigma)
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{105}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{t\PYZus{}full} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}
\PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}rbf}\PY{p}{,} \PY{n}{sigma\PYZus{}pred\PYZus{}full\PYZus{}rbf} \PY{o}{=} \PY{n}{gp\PYZus{}rbf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{t\PYZus{}full}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{return\PYZus{}std}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot the predictive bands from RBF kernel}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n}{t\PYZus{}full}\PY{p}{,} \PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}rbf} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}pred\PYZus{}full\PYZus{}rbf}\PY{p}{,}
                 \PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}rbf} \PY{o}{+} \PY{n}{sigma\PYZus{}pred\PYZus{}full\PYZus{}rbf}\PY{p}{,}
                 \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RBF kernel (\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{pm1}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZdl{})}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{t\PYZus{}full}\PY{p}{,} \PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}rbf}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RBF kernel mean prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Overlay the true model and simulated data}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{capsize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time (days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude (mag)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
/Users/LerongLiu/Library/Python/3.9/lib/python/site-
packages/sklearn/gaussian\_process/\_gpr.py:441: RuntimeWarning: divide by zero
encountered in matmul
  y\_mean = K\_trans @ self.alpha\_
/Users/LerongLiu/Library/Python/3.9/lib/python/site-
packages/sklearn/gaussian\_process/\_gpr.py:441: RuntimeWarning: overflow
encountered in matmul
  y\_mean = K\_trans @ self.alpha\_
/Users/LerongLiu/Library/Python/3.9/lib/python/site-
packages/sklearn/gaussian\_process/\_gpr.py:441: RuntimeWarning: invalid value
encountered in matmul
  y\_mean = K\_trans @ self.alpha\_
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_9_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{106}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Define the periodic kernel with length scale and periodicity bounds}
\PY{n}{kernel\PYZus{}pd} \PY{o}{=} \PY{l+m+mf}{1.0} \PY{o}{*} \PY{n}{ExpSineSquared}\PY{p}{(}\PY{n}{length\PYZus{}scale\PYZus{}bounds}\PY{o}{=}\PY{p}{(}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{)}\PY{p}{,}
                                 \PY{n}{periodicity\PYZus{}bounds}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{300}\PY{p}{)}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Create the Gaussian Process model with periodic kernel}
\PY{n}{gp\PYZus{}pd} \PY{o}{=} \PY{n}{GaussianProcessRegressor}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{n}{kernel\PYZus{}pd}\PY{p}{,}
        \PY{n}{alpha}\PY{o}{=}\PY{n}{sigma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mf}{1e\PYZhy{}8}\PY{p}{,}    \PY{c+c1}{\PYZsh{} NOTE: EDIT here to set the variance of the measurement noise}
        \PY{n}{normalize\PYZus{}y}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}         \PY{c+c1}{\PYZsh{} normalize the target values for zero mean and unit variance}
        \PY{n}{n\PYZus{}restarts\PYZus{}optimizer}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,}  \PY{c+c1}{\PYZsh{} steps to perform during hyperparameter optimization}
        \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{seed}\PY{o}{+}\PY{l+m+mi}{2}\PY{p}{)}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to fit the observed data}
\PY{n}{gp\PYZus{}pd}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{t}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{106}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
GaussianProcessRegressor(alpha=array([0.07115986, 0.11369829, 0.08167243,
0.13187349, 0.10001009,
       0.12760449, 0.13564863, 0.13517209, 0.10022079, 0.15317858,
       0.11068163, 0.10852515, 0.11290723, 0.05213118, 0.04416804,
       0.13512367, 0.14350412, 0.07509209, 0.06545762, 0.15027231,
       0.08981334, 0.14751943, 0.15437905, 0.04889111, 0.14035868,
       0.04137009, 0.04736292, 0.05196575, 0.07326026, 0.13052776,
       0.070403  , 0.09973682]),
                         kernel=1**2 * ExpSineSquared(length\_scale=1,
periodicity=1),
                         n\_restarts\_optimizer=10, normalize\_y=True,
                         random\_state=2024011184)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{107}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} NOTE: EDIT below to make predictions with the trained GP model}
\PY{n}{m\PYZus{}pred\PYZus{}pd}\PY{p}{,} \PY{n}{sigma\PYZus{}pred\PYZus{}pd} \PY{o}{=} \PY{n}{gp\PYZus{}pd}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{t\PYZus{}test}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{return\PYZus{}std}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Relative errors}
\PY{n}{rel\PYZus{}error\PYZus{}pd} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{m\PYZus{}pred\PYZus{}pd} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}test\PYZus{}true}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{m\PYZus{}test\PYZus{}true}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Relative errors normalized by predicted uncertainties}
\PY{n}{rel\PYZus{}error\PYZus{}norm\PYZus{}pd} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{m\PYZus{}pred\PYZus{}pd} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}test\PYZus{}true}\PY{p}{)} \PY{o}{/} \PY{n}{sigma\PYZus{}pred\PYZus{}pd}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Predictions with periodic kernel:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{ti}\PY{p}{,} \PY{n}{mi}\PY{p}{,} \PY{n}{si}\PY{p}{,} \PY{n}{re}\PY{p}{,} \PY{n}{re\PYZus{}norm} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{t\PYZus{}test}\PY{o}{.}\PY{n}{flatten}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{m\PYZus{}pred\PYZus{}pd}\PY{p}{,} \PY{n}{sigma\PYZus{}pred\PYZus{}pd}\PY{p}{,} \PY{n}{rel\PYZus{}error\PYZus{}pd}\PY{p}{,} \PY{n}{rel\PYZus{}error\PYZus{}norm\PYZus{}pd}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{:}\PY{l+s+s2}{.1f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ days:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{m = }\PY{l+s+si}{\PYZob{}}\PY{n}{mi}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ ± }\PY{l+s+si}{\PYZob{}}\PY{n}{si}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ mag (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{re}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, normalized = }\PY{l+s+si}{\PYZob{}}\PY{n}{re\PYZus{}norm}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ sigma)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Predictions with periodic kernel:
t = 100.0 days:
        m = 16.352 ± 0.106 mag (relative error = 0.55\%, normalized = 0.85 sigma)
t = 200.0 days:
        m = 16.343 ± 0.106 mag (relative error = 0.49\%, normalized = 0.76 sigma)
t = 300.0 days:
        m = 16.333 ± 0.106 mag (relative error = 0.43\%, normalized = 0.67 sigma)
t = 400.0 days:
        m = 16.323 ± 0.106 mag (relative error = 0.37\%, normalized = 0.57 sigma)
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{108}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}pd}\PY{p}{,} \PY{n}{sigma\PYZus{}pred\PYZus{}full\PYZus{}pd} \PY{o}{=} \PY{n}{gp\PYZus{}pd}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{t\PYZus{}full}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{return\PYZus{}std}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Plot the predictive bands from periodic kernel}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n}{t\PYZus{}full}\PY{p}{,} \PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}pd} \PY{o}{\PYZhy{}} \PY{n}{sigma\PYZus{}pred\PYZus{}full\PYZus{}pd}\PY{p}{,}
                 \PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}pd} \PY{o}{+} \PY{n}{sigma\PYZus{}pred\PYZus{}full\PYZus{}pd}\PY{p}{,}
                 \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Periodic kernel (\PYZdl{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{pm1}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{sigma\PYZdl{})}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{t\PYZus{}full}\PY{p}{,} \PY{n}{m\PYZus{}pred\PYZus{}full\PYZus{}pd}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Periodic kernel mean prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Overlay the true model and simulated data}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{capsize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time (days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude (mag)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
/Users/LerongLiu/Library/Python/3.9/lib/python/site-
packages/sklearn/gaussian\_process/\_gpr.py:441: RuntimeWarning: divide by zero
encountered in matmul
  y\_mean = K\_trans @ self.alpha\_
/Users/LerongLiu/Library/Python/3.9/lib/python/site-
packages/sklearn/gaussian\_process/\_gpr.py:441: RuntimeWarning: overflow
encountered in matmul
  y\_mean = K\_trans @ self.alpha\_
/Users/LerongLiu/Library/Python/3.9/lib/python/site-
packages/sklearn/gaussian\_process/\_gpr.py:441: RuntimeWarning: invalid value
encountered in matmul
  y\_mean = K\_trans @ self.alpha\_
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_12_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Question 1.2: Basis function
regression}\label{question-1.2-basis-function-regression}

The light curve may also be modeled by the sum of shifted basis
functions:

\(m(t) = m_0 + \sum\limits_{h=1}^{M} c_h B_h(t)\)

where \(B_h(t)\) are the basis functions and \(c_h\) are the
corresponding coefficients.

We consider Gaussian and trigonometric basis functions for this
exercise.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The Gaussian basis functions are defined as:

  \(B_h(t) = \exp \left[ -\dfrac{(t - t_h)^2}{2 l^2} \right]\)

  where \(t_h\) is the center (knot) of the \(h\)-th basis function and
  \(l\) is the length scale.

  For simplicity, we set \(\Delta t \equiv t_{h+1} - t_h = l\) for all
  \(h\) in the Gaussian basis functions. So the basis functions are
  evenly spaced with a spacing equal to the length scale \(l\).
\item
  The trigonometric basis functions are defined as:

  \(B_h(t) = a_h \cos (2\pi h t/p) + b_h \sin (2\pi h t/p)\)

  where \(p\) is the period, and \(a_h\) and \(b_h\) are coefficients of
  the cosine and sine terms, respectively. We fix \(p=200\) days for
  this exercise.
\end{enumerate}

\textbf{Tasks:} 1. Using the same simulated light curve data from
Question 1.1, fit the data using basis function regression using
Gaussian basis functions with evenly spaced knots in \([0,400]\) days.
Try \(M=3, 5, 9\) basis functions, corresponding to length scales of
\(l=200, 100, 50\) days, respectively. Infer the coefficients
\(\{c_h\}\) and \(m_0\) using \texttt{UltraNest}. Use flat priors for
all parameters: \(m_0\) in \([10, 20]\) mag and \(c_h\) in \([-10, 10]\)
mag. 2. Compare the prediction bands (mean ± 1σ) for each \(M\) over the
time range of 0 to 400 days. 3. For each \(M\), infer the brightness
predictions at \(t=[100,200,300,400]\) days as derived parameters, plot
their posterior distributions, and report the corresponding summary
statistics. 4. Report the log-evidences for each \(M\) and discuss which
model is preferred based on the evidence. 5. Repeat the above tasks
using trigonometric basis functions instead of Gaussian basis functions.
Try \(M=2, 3, 4\) basis functions, and use flat priors for all
parameters: \(m_0\) in \([10, 20]\) mag and \(a_h, b_h\) in
\([-10, 10]\) mag.

\textbf{Hints:} 1. It is recommended to use the
\texttt{ultranest.stepsampler} module for high-dimensional problems, see
https://johannesbuchner.github.io/UltraNest/example-sine-highd.html 2.
You can plot the prediction bands using the \texttt{PredictiveBands}
class from the \texttt{ultranest.plot} module.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{109}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Functions for UltraNest inference with Gaussian basis functions}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{lightcurve\PYZus{}gauss\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{params}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Model light curve using Gaussian basis functions.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        t: array, time array}
\PY{l+s+sd}{        params: array, model parameters (m\PYZus{}0, c\PYZus{}1, c\PYZus{}2, ..., c\PYZus{}M)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        m\PYZus{}model: array, modeled magnitudes}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{m0}\PY{p}{,} \PY{o}{*}\PY{n}{c} \PY{o}{=} \PY{n}{params}
    \PY{n}{M} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{c}\PY{p}{)}
    \PY{n}{w} \PY{o}{=} \PY{l+m+mi}{400} \PY{o}{/}\PY{o}{/} \PY{p}{(}\PY{n}{M} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Center spacing and standard deviation of Gaussian basis functions}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute the model magnitudes}
    \PY{n}{centers} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mf}{400.0}\PY{p}{,} \PY{n}{M}\PY{p}{)}
    \PY{n}{t} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{t}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Gaussian basis functions with std = spacing w}
    \PY{c+c1}{\PYZsh{} B\PYZus{}h(t) = exp[\PYZhy{}0.5 * ((t \PYZhy{} center)/w)**2]}
    \PY{n}{gauss\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(}\PY{p}{[}\PY{n}{ci} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{p}{(}\PY{p}{(}\PY{n}{t} \PY{o}{\PYZhy{}} \PY{n}{center}\PY{p}{)} \PY{o}{/} \PY{n}{w}\PY{p}{)} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)}
                              \PY{k}{for} \PY{n}{ci}\PY{p}{,} \PY{n}{center} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{c}\PY{p}{,} \PY{n}{centers}\PY{p}{)}\PY{p}{]}\PY{p}{)}
    \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{m0} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{gauss\PYZus{}matrix}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{k}{return} \PY{n}{m\PYZus{}model}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{prior\PYZus{}transform\PYZus{}gaussian\PYZus{}basis}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}ranges}\PY{p}{,} \PY{n}{derived\PYZus{}time}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Transform unit cube to parameter space for Gaussian basis functions.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        cube: array, unit cube samples (m\PYZus{}0, c\PYZus{}1, c\PYZus{}2, ..., c\PYZus{}M)}
\PY{l+s+sd}{        param\PYZus{}ranges: array, parameter ranges}
\PY{l+s+sd}{        derived\PYZus{}time: array, times at which to derive parameters}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        params: array, transformed parameters + derived parameters}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{pmin}\PY{p}{,} \PY{n}{pmax}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
        \PY{n}{params}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pmin} \PY{o}{+} \PY{n}{cube}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{*} \PY{p}{(}\PY{n}{pmax} \PY{o}{\PYZhy{}} \PY{n}{pmin}\PY{p}{)}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Add derived parameters if needed}
    \PY{k}{if} \PY{n}{derived\PYZus{}time} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{lightcurve\PYZus{}gauss\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{derived\PYZus{}time}\PY{p}{,} \PY{n}{params}\PY{p}{)}
        \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{params}\PY{p}{,} \PY{n}{m\PYZus{}model}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{params}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{log\PYZus{}likelihood\PYZus{}gaussian\PYZus{}basis}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}\PY{p}{,} \PY{n}{M}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute log\PYZhy{}likelihood for Gaussian basis function model.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        params: array, model parameters (m\PYZus{}0, c\PYZus{}1, c\PYZus{}2, ..., c\PYZus{}M)}
\PY{l+s+sd}{        t: array, time array}
\PY{l+s+sd}{        m\PYZus{}obs: array, observed magnitudes}
\PY{l+s+sd}{        sigma: array, measurement uncertainties}
\PY{l+s+sd}{        M: int, number of Gaussian basis functions}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        logL: float, log\PYZhy{}likelihood value}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{c+c1}{\PYZsh{} Ensure params is an array and extract the model parameters (m0, c1...cM)}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{n}{model\PYZus{}params} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{p}{:}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Compute model magnitudes at observation times}
    \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{lightcurve\PYZus{}gauss\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{model\PYZus{}params}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Check for numerical issues}
    \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{m\PYZus{}model}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{m\PYZus{}obs}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{sigma} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}

    \PY{c+c1}{\PYZsh{} Gaussian log\PYZhy{}likelihood (heteroscedastic errors)}
    \PY{n}{var} \PY{o}{=} \PY{n}{sigma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{resid} \PY{o}{=} \PY{n}{m\PYZus{}obs} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}model}
    \PY{n}{logL} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{/} \PY{n}{var} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{n}{var}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n}{logL}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{110}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{ultranest}
\PY{k+kn}{import}\PY{+w}{ }\PY{n+nn}{ultranest}\PY{n+nn}{.}\PY{n+nn}{stepsampler}\PY{+w}{ }\PY{k}{as}\PY{+w}{ }\PY{n+nn}{stepsampler}

\PY{c+c1}{\PYZsh{} Setup Gaussian basis functions with different numbers}
\PY{n}{num\PYZus{}gauss\PYZus{}basis} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{]}
\PY{n}{ultranest\PYZus{}results\PYZus{}gauss} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{n}{derived\PYZus{}time} \PY{o}{=} \PY{n}{t\PYZus{}test}
\PY{n}{derived\PYZus{}truth} \PY{o}{=} \PY{n}{m\PYZus{}test\PYZus{}true}
\PY{n}{derived\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{ti} \PY{o+ow}{in} \PY{n}{derived\PYZus{}time}\PY{p}{]}

\PY{k}{for} \PY{n}{M} \PY{o+ow}{in} \PY{n}{num\PYZus{}gauss\PYZus{}basis}\PY{p}{:}
    \PY{n}{pnames} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{c}\PY{l+s+si}{\PYZob{}}\PY{n}{i}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}
    \PY{n}{pranges} \PY{o}{=} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{20}\PY{p}{]}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{]} \PY{o}{*} \PY{n}{M}
    
    \PY{n}{sampler} \PY{o}{=} \PY{n}{ultranest}\PY{o}{.}\PY{n}{ReactiveNestedSampler}\PY{p}{(}
        \PY{n}{pnames}\PY{p}{,}
        \PY{k}{lambda} \PY{n}{params}\PY{p}{:} \PY{n}{log\PYZus{}likelihood\PYZus{}gaussian\PYZus{}basis}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}\PY{p}{,} \PY{n}{M}\PY{p}{)}\PY{p}{,}
        \PY{k}{lambda} \PY{n}{cube}\PY{p}{:} \PY{n}{prior\PYZus{}transform\PYZus{}gaussian\PYZus{}basis}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{pranges}\PY{p}{,} \PY{n}{derived\PYZus{}time}\PY{o}{=}\PY{n}{derived\PYZus{}time}\PY{p}{)}\PY{p}{,}
        \PY{n}{derived\PYZus{}param\PYZus{}names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
        \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lightcurve\PYZus{}gauss\PYZus{}basis\PYZus{}M}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
        \PY{c+c1}{\PYZsh{} resume=True}
    \PY{p}{)}

    \PY{n}{sampler}\PY{o}{.}\PY{n}{stepsampler} \PY{o}{=} \PY{n}{stepsampler}\PY{o}{.}\PY{n}{SliceSampler}\PY{p}{(}
        \PY{n}{nsteps}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{p}{(}\PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}
        \PY{n}{generate\PYZus{}direction}\PY{o}{=}\PY{n}{stepsampler}\PY{o}{.}\PY{n}{generate\PYZus{}mixture\PYZus{}random\PYZus{}direction}
    \PY{p}{)}

    \PY{n}{results} \PY{o}{=} \PY{n}{sampler}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}
    \PY{n}{ultranest\PYZus{}results\PYZus{}gauss}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{results}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_gauss\_basis\_M3/run1
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_gauss\_basis\_M5/run13]*|
it/evals=6913/173679 eff=3.9895\% N=400  0
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_gauss\_basis\_M9/run18]*|
it/evals=9360/289602 eff=3.2365\% N=400
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Z=-85.9(98.99\%) | Like=-56.62..-55.53 [-56.6173..-56.6164]*|
it/evals=13667/646532 eff=2.1152\% N=400    0
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{111}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{getdist}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{plots}\PY{p}{,} \PY{n}{MCSamples}

\PY{c+c1}{\PYZsh{} Convert UltraNest results to GetDist MCSamples and make corner plots}
\PY{n}{getdist\PYZus{}gauss\PYZus{}samples} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}gauss\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}gauss}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n}{ws} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

    \PY{n}{samples} \PY{o}{=} \PY{n}{MCSamples}\PY{p}{(}
        \PY{n}{samples}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{M}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{,}
        \PY{n}{weights}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{loglikes}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
        \PY{n}{sampler}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nested}\PY{l+s+s1}{\PYZsq{}}
    \PY{p}{)}

    \PY{n}{getdist\PYZus{}gauss\PYZus{}samples}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{samples}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Make corner plots for derived parameters using getdist}
\PY{n}{g} \PY{o}{=} \PY{n}{plots}\PY{o}{.}\PY{n}{get\PYZus{}single\PYZus{}plotter}\PY{p}{(}\PY{n}{width\PYZus{}inch}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{,} \PY{n}{ratio}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{n}{g}\PY{o}{.}\PY{n}{triangle\PYZus{}plot}\PY{p}{(}
    \PY{n}{getdist\PYZus{}gauss\PYZus{}samples}\PY{p}{,}
    \PY{n}{param\PYZus{}names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
    \PY{n}{filled}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{markers}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{n}\PY{p}{:}\PY{n}{v} \PY{k}{for} \PY{n}{n}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{derived\PYZus{}names}\PY{p}{,} \PY{n}{derived\PYZus{}truth}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{,}
    \PY{n}{legend\PYZus{}labels}\PY{o}{=}\PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gaussian basis M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{M} \PY{o+ow}{in} \PY{n}{num\PYZus{}gauss\PYZus{}basis}\PY{p}{]}\PY{p}{,}
    \PY{n}{legend\PYZus{}loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{upper right}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Removed no burn in
Removed no burn in
Removed no burn in
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<Figure size 2400x2400 with 0 Axes>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_16_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{112}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Report summary statistics of the derived parameters and compare with true values}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}gauss\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}gauss}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Results for Gaussian basis functions with M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{for} \PY{n}{j}\PY{p}{,} \PY{n}{ti} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{derived\PYZus{}time}\PY{p}{)}\PY{p}{:}
        \PY{n}{param\PYZus{}name} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{mean} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{1}\PY{o}{+}\PY{n}{j}\PY{p}{]}
        \PY{n}{std} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stdev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{1}\PY{o}{+}\PY{n}{j}\PY{p}{]}
        \PY{n}{rel\PYZus{}error} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{mean} \PY{o}{\PYZhy{}} \PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
        \PY{n}{rel\PYZus{}error\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{mean} \PY{o}{\PYZhy{}} \PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{std}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{:}\PY{l+s+s2}{.1f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ days:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{m = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ ± }\PY{l+s+si}{\PYZob{}}\PY{n}{std}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ mag (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}error}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, normalized = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}error\PYZus{}norm}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ sigma)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Results for Gaussian basis functions with M=3:
t = 100.0 days:
        m = 14.720 ± 0.092 mag (relative error = 9.48\%, normalized = 16.77
sigma)
t = 200.0 days:
        m = 15.493 ± 0.079 mag (relative error = 4.73\%, normalized = 9.68 sigma)
t = 300.0 days:
        m = 15.560 ± 0.066 mag (relative error = 4.32\%, normalized = 10.66
sigma)
t = 400.0 days:
        m = 14.919 ± 0.173 mag (relative error = 8.26\%, normalized = 7.76 sigma)
Results for Gaussian basis functions with M=5:
t = 100.0 days:
        m = 15.094 ± 0.115 mag (relative error = 7.19\%, normalized = 10.17
sigma)
t = 200.0 days:
        m = 15.158 ± 0.088 mag (relative error = 6.79\%, normalized = 12.50
sigma)
t = 300.0 days:
        m = 15.995 ± 0.078 mag (relative error = 1.64\%, normalized = 3.43 sigma)
t = 400.0 days:
        m = 12.619 ± 0.227 mag (relative error = 22.40\%, normalized = 16.02
sigma)
Results for Gaussian basis functions with M=9:
t = 100.0 days:
        m = 15.616 ± 0.160 mag (relative error = 3.98\%, normalized = 4.04 sigma)
t = 200.0 days:
        m = 15.647 ± 0.108 mag (relative error = 3.79\%, normalized = 5.68 sigma)
t = 300.0 days:
        m = 15.949 ± 0.125 mag (relative error = 1.92\%, normalized = 2.50 sigma)
t = 400.0 days:
        m = 9.652 ± 0.805 mag (relative error = 40.65\%, normalized = 8.22 sigma)
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{113}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{ultranest}\PY{n+nn}{.}\PY{n+nn}{plot}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{PredictionBand}

\PY{c+c1}{\PYZsh{} Plot the predictive bands from Gaussian basis function models}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{colors} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:cyan}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}gauss\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}gauss}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n}{t\PYZus{}sample} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
    \PY{n}{pband} \PY{o}{=} \PY{n}{PredictionBand}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{)}
    \PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{:}
        \PY{n}{pband}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{lightcurve\PYZus{}gauss\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{,} \PY{n}{p}\PY{p}{[}\PY{p}{:}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}

    \PY{n}{pband}\PY{o}{.}\PY{n}{line}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{colors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gaussian basis M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{pband}\PY{o}{.}\PY{n}{shade}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{colors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Overlay the true model and simulated data}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{capsize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time (days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude (mag)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_18_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{114}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Functions for UltraNest inference with trignometric basis functions}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{lightcurve\PYZus{}trig\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{params}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Model light curve using trignometric basis functions.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        t: array, time array}
\PY{l+s+sd}{        params: array, model parameters (m\PYZus{}0, p, a\PYZus{}1, b\PYZus{}1, a\PYZus{}2, b\PYZus{}2, ..., a\PYZus{}N, b\PYZus{}N)}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        m\PYZus{}model: array, model magnitudes at times t}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{n}{m0} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{p} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
    \PY{c+c1}{\PYZsh{} determine number of harmonics}
    \PY{n}{N} \PY{o}{=} \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{params}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{)} \PY{o}{/}\PY{o}{/} \PY{l+m+mi}{2}
    \PY{n}{a} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{N}\PY{p}{]} \PY{k}{if} \PY{n}{N} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
    \PY{n}{b} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{N}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{+}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{N}\PY{p}{]} \PY{k}{if} \PY{n}{N} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
    \PY{n}{t} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{t}\PY{p}{)}
    \PY{k}{if} \PY{n}{N} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{return} \PY{n}{m0} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{zeros\PYZus{}like}\PY{p}{(}\PY{n}{t}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} sum over harmonics: h runs from 1..N}
    \PY{n}{terms} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(}\PY{p}{[}\PY{n}{a\PYZus{}h} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{cos}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{p}{(}\PY{n}{h}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)} \PY{o}{*} \PY{n}{t} \PY{o}{/} \PY{n}{p}\PY{p}{)} \PY{o}{+} \PY{n}{b\PYZus{}h} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{p}{(}\PY{n}{h}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)} \PY{o}{*} \PY{n}{t} \PY{o}{/} \PY{n}{p}\PY{p}{)}
                       \PY{k}{for} \PY{n}{h}\PY{p}{,} \PY{p}{(}\PY{n}{a\PYZus{}h}\PY{p}{,} \PY{n}{b\PYZus{}h}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{n}{a}\PY{p}{,} \PY{n}{b}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}
    \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{m0} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{terms}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{k}{return} \PY{n}{m\PYZus{}model}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{prior\PYZus{}transform\PYZus{}trig\PYZus{}basis}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}ranges}\PY{p}{,} \PY{n}{derived\PYZus{}time}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Transform unit cube to parameter space for trignometric basis functions.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        cube: array, unit cube samples (m\PYZus{}0, p, a\PYZus{}1, b\PYZus{}1, a\PYZus{}2, b\PYZus{}2, ..., a\PYZus{}N, b\PYZus{}N)}
\PY{l+s+sd}{        param\PYZus{}ranges: array, parameter ranges}
\PY{l+s+sd}{        derived\PYZus{}time: array, times at which to derive parameters}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        params: array, transformed parameters (and derived if requested)}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{pmin}\PY{p}{,} \PY{n}{pmax}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
        \PY{n}{params}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pmin} \PY{o}{+} \PY{n}{cube}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{*} \PY{p}{(}\PY{n}{pmax} \PY{o}{\PYZhy{}} \PY{n}{pmin}\PY{p}{)}\PY{p}{)}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{k}{if} \PY{n}{derived\PYZus{}time} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{lightcurve\PYZus{}trig\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{derived\PYZus{}time}\PY{p}{,} \PY{n}{params}\PY{p}{)}
        \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{params}\PY{p}{,} \PY{n}{m\PYZus{}model}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{params}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{log\PYZus{}likelihood\PYZus{}trig\PYZus{}basis}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}\PY{p}{,} \PY{n}{N}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute log\PYZhy{}likelihood for trignometric basis function model.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        params: array, model parameters (m\PYZus{}0, p, a\PYZus{}1, b\PYZus{}1, a\PYZus{}2, b\PYZus{}2, ..., a\PYZus{}N, b\PYZus{}N)}
\PY{l+s+sd}{        t: array, time array}
\PY{l+s+sd}{        m\PYZus{}obs: array, observed magnitudes}
\PY{l+s+sd}{        sigma: array, measurement uncertainties}
\PY{l+s+sd}{        N: int, number of trignometric basis functions}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        logL: float, log\PYZhy{}likelihood value}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} ensure we only use the model parameters (in case derived params appended)}
    \PY{n}{model\PYZus{}params} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{N}\PY{p}{]}
    \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{lightcurve\PYZus{}trig\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{model\PYZus{}params}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} numeric checks}
    \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{m\PYZus{}model}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{m\PYZus{}obs}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{sigma} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}
    \PY{n}{var} \PY{o}{=} \PY{n}{sigma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{resid} \PY{o}{=} \PY{n}{m\PYZus{}obs} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}model}
    \PY{n}{logL} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{/} \PY{n}{var} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{n}{var}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n}{logL}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{115}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Setup trignometric basis functions with different numbers}
\PY{n}{num\PYZus{}trig\PYZus{}basis} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}
\PY{n}{ultranest\PYZus{}results\PYZus{}trig} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{k}{for} \PY{n}{M} \PY{o+ow}{in} \PY{n}{num\PYZus{}trig\PYZus{}basis}\PY{p}{:}
    \PY{n}{pnames} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{p}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{a}\PY{l+s+si}{\PYZob{}}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{M}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+si}{\PYZob{}}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{M}\PY{p}{)}\PY{p}{]}
    \PY{n}{pranges} \PY{o}{=} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{20}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{50}\PY{p}{,}\PY{l+m+mi}{200}\PY{p}{]}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{]} \PY{o}{*} \PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{M}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to setup and run the UltraNest sampler}
    \PY{n}{sampler} \PY{o}{=} \PY{n}{ultranest}\PY{o}{.}\PY{n}{ReactiveNestedSampler}\PY{p}{(}
        \PY{n}{pnames}\PY{p}{,}
        \PY{k}{lambda} \PY{n}{params}\PY{p}{:} \PY{n}{log\PYZus{}likelihood\PYZus{}trig\PYZus{}basis}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}\PY{p}{,} \PY{n}{M}\PY{p}{)}\PY{p}{,}
        \PY{k}{lambda} \PY{n}{cube}\PY{p}{:} \PY{n}{prior\PYZus{}transform\PYZus{}trig\PYZus{}basis}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{pranges}\PY{p}{,} \PY{n}{derived\PYZus{}time}\PY{o}{=}\PY{n}{derived\PYZus{}time}\PY{p}{)}\PY{p}{,}
        \PY{n}{derived\PYZus{}param\PYZus{}names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
        \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lightcurve\PYZus{}trig\PYZus{}basis\PYZus{}M}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
        \PY{c+c1}{\PYZsh{} resume=True}
    \PY{p}{)}

    \PY{n}{sampler}\PY{o}{.}\PY{n}{stepsampler} \PY{o}{=} \PY{n}{stepsampler}\PY{o}{.}\PY{n}{SliceSampler}\PY{p}{(}
        \PY{n}{nsteps}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{p}{(}\PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}
        \PY{n}{generate\PYZus{}direction}\PY{o}{=}\PY{n}{stepsampler}\PY{o}{.}\PY{n}{generate\PYZus{}mixture\PYZus{}random\PYZus{}direction}
    \PY{p}{)}

    \PY{n}{results} \PY{o}{=} \PY{n}{sampler}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}
    \PY{n}{ultranest\PYZus{}results\PYZus{}trig}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{results}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_trig\_basis\_M1/run1
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_trig\_basis\_M2/run1evals=8760/159670
eff=5.5001\% N=400         0
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_trig\_basis\_M3/run1evals=12240/324722
eff=3.7740\% N=400   0    0  0
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Z=-39.7(99.00\%) | Like=-5.29..-4.43 [-5.2932..-5.2929]*| it/evals=15680/583112
eff=2.6909\% N=400 0  0
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{116}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Convert UltraNest results to GetDist MCSamples and make corner plots}
\PY{n}{getdist\PYZus{}trig\PYZus{}samples} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}trig\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}trig}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to convert UltraNest results to GetDist MCSamples}
    \PY{n}{ws} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{start\PYZus{}idx} \PY{o}{=} \PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{M}  \PY{c+c1}{\PYZsh{} m0, p, then 2*M a/b parameters}
    \PY{n}{samples} \PY{o}{=} \PY{n}{MCSamples}\PY{p}{(}
        \PY{n}{samples}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{start\PYZus{}idx}\PY{p}{:}\PY{p}{]}\PY{p}{,}
        \PY{n}{weights}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{loglikes}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
        \PY{n}{sampler}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nested}\PY{l+s+s1}{\PYZsq{}}
    \PY{p}{)}

    \PY{n}{getdist\PYZus{}trig\PYZus{}samples}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{samples}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Make corner plots for derived parameters using getdist}
\PY{n}{g} \PY{o}{=} \PY{n}{plots}\PY{o}{.}\PY{n}{get\PYZus{}single\PYZus{}plotter}\PY{p}{(}\PY{n}{width\PYZus{}inch}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{ratio}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{n}{g}\PY{o}{.}\PY{n}{triangle\PYZus{}plot}\PY{p}{(}
    \PY{n}{getdist\PYZus{}trig\PYZus{}samples}\PY{p}{,}
    \PY{n}{param\PYZus{}names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
    \PY{n}{filled}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{markers}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{n}\PY{p}{:}\PY{n}{v} \PY{k}{for} \PY{n}{n}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{derived\PYZus{}names}\PY{p}{,} \PY{n}{derived\PYZus{}truth}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{,}
    \PY{n}{legend\PYZus{}labels}\PY{o}{=}\PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Trigonometric basis M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{M} \PY{o+ow}{in} \PY{n}{num\PYZus{}trig\PYZus{}basis}\PY{p}{]}\PY{p}{,}
    \PY{n}{legend\PYZus{}loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{upper right}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Removed no burn in
Removed no burn in
Removed no burn in
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<Figure size 1800x1800 with 0 Axes>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_21_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{117}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Report summary statistics of the derived parameters and compare with true values}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}trig\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}trig}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Results for Trignometric basis functions with M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{for} \PY{n}{j}\PY{p}{,} \PY{n}{ti} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{derived\PYZus{}time}\PY{p}{)}\PY{p}{:}
        \PY{n}{param\PYZus{}name} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{mean} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{j}\PY{p}{]}
        \PY{n}{std} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stdev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{j}\PY{p}{]}
        \PY{n}{rel\PYZus{}error} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{mean} \PY{o}{\PYZhy{}} \PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
        \PY{n}{rel\PYZus{}error\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{mean} \PY{o}{\PYZhy{}} \PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{std}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{:}\PY{l+s+s2}{.1f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ days:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{m = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ ± }\PY{l+s+si}{\PYZob{}}\PY{n}{std}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ mag (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}error}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, normalized = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}error\PYZus{}norm}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ sigma)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Results for Trignometric basis functions with M=1:
t = 100.0 days:
        m = 16.334 ± 0.097 mag (relative error = 0.44\%, normalized = 0.75 sigma)
t = 200.0 days:
        m = 16.338 ± 0.092 mag (relative error = 0.47\%, normalized = 0.83 sigma)
t = 300.0 days:
        m = 16.338 ± 0.108 mag (relative error = 0.47\%, normalized = 0.70 sigma)
t = 400.0 days:
        m = 16.333 ± 0.137 mag (relative error = 0.44\%, normalized = 0.52 sigma)
Results for Trignometric basis functions with M=2:
t = 100.0 days:
        m = 16.383 ± 0.116 mag (relative error = 0.74\%, normalized = 1.04 sigma)
t = 200.0 days:
        m = 16.260 ± 0.145 mag (relative error = 0.02\%, normalized = 0.02 sigma)
t = 300.0 days:
        m = 16.428 ± 0.126 mag (relative error = 1.02\%, normalized = 1.31 sigma)
t = 400.0 days:
        m = 16.287 ± 0.141 mag (relative error = 0.15\%, normalized = 0.17 sigma)
Results for Trignometric basis functions with M=3:
t = 100.0 days:
        m = 16.369 ± 0.154 mag (relative error = 0.66\%, normalized = 0.69 sigma)
t = 200.0 days:
        m = 16.269 ± 0.149 mag (relative error = 0.04\%, normalized = 0.04 sigma)
t = 300.0 days:
        m = 16.405 ± 0.146 mag (relative error = 0.88\%, normalized = 0.98 sigma)
t = 400.0 days:
        m = 16.294 ± 0.164 mag (relative error = 0.20\%, normalized = 0.20 sigma)
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{118}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the predictive bands from Trignometric basis function models}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{colors} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:pink}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:olive}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}trig\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}trig}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n}{t\PYZus{}sample} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
    \PY{n}{pband} \PY{o}{=} \PY{n}{PredictionBand}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{)}
    \PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{:}
        \PY{n}{pband}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{lightcurve\PYZus{}trig\PYZus{}basis\PYZus{}model}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{,} \PY{n}{p}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{M}\PY{o}{+}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}\PY{p}{)}

    \PY{n}{pband}\PY{o}{.}\PY{n}{line}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{colors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Trignometric basis M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{pband}\PY{o}{.}\PY{n}{shade}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{colors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Overlay the true model and simulated data}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{capsize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time (days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude (mag)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_23_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{119}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Do not forget to compare the evidences}
\PY{c+c1}{\PYZsh{} Do not forget to compare the evidences}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}gauss\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{ultranest\PYZus{}results\PYZus{}gauss}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logz}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{num\PYZus{}trig\PYZus{}basis}\PY{p}{)}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{n}{ultranest\PYZus{}results\PYZus{}trig}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logz}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
-177.89629023816784
-148.2191580210553
-85.90910791660443
-23.25778333918157
-30.92907570403099
-39.70127732542821
    \end{Verbatim}

    \paragraph{Question 1.3: prediction with parametric
model}\label{question-1.3-prediction-with-parametric-model}

\textbf{Tasks:} 1. Assume the sinusoidal model is known, fit the
simulated light curve data using \texttt{UltraNest}. Use uniform priors
over the following ranges: - \(A \in [0, 3]\) mag - \(T \in [10, 300]\)
days - \(\phi \in [0, 2\pi]\) rad - \(m_0 \in [10, 20]\) mag 2. Infer
the brighness predictions at \(t=[100,200,300,400]\) days as derived
parameters. 3. Report summary statistics of the inferred parameters, and
the log-evidence of the model. 4. Plot the prediction bands (mean ± 1σ)
over the time range of 0 to 400 days. 5. Compare your results with those
from Questions 1.1 and 1.2, and discuss your findings (such as the
advantages and disadvantages of each method) for this problem.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{120}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Functions for UltraNest inference with the true parametric model}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{prior\PYZus{}transform\PYZus{}lightcurve}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}ranges}\PY{p}{,} \PY{n}{derived\PYZus{}time}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Transform unit cube to uniform prior space.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        cube: array, unit cube samples}
\PY{l+s+sd}{        param\PYZus{}ranges: array, parameter ranges}
\PY{l+s+sd}{        derived\PYZus{}time: array, times at which to derive parameters}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        params: array, transformed parameters}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{n}{params} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{n}{cube} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{cube}\PY{p}{)}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{pmin}\PY{p}{,} \PY{n}{pmax}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
        \PY{n}{params}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pmin} \PY{o}{+} \PY{n}{cube}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{*} \PY{p}{(}\PY{n}{pmax} \PY{o}{\PYZhy{}} \PY{n}{pmin}\PY{p}{)}\PY{p}{)}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{k}{if} \PY{n}{derived\PYZus{}time} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} append model predictions at derived\PYZus{}time as derived parameters}
        \PY{n}{m\PYZus{}derived} \PY{o}{=} \PY{n}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{derived\PYZus{}time}\PY{p}{,} \PY{o}{*}\PY{n}{params}\PY{p}{[}\PY{p}{:}\PY{n+nb}{len}\PY{p}{(}\PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{]}\PY{p}{)}
        \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{params}\PY{p}{,} \PY{n}{m\PYZus{}derived}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{params}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{log\PYZus{}likelihood\PYZus{}lightcurve}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute the log\PYZhy{}likelihood of the observed data given the model parameters.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        params: array, model parameters [A, T, phi, m0]}
\PY{l+s+sd}{        t: array, time array}
\PY{l+s+sd}{        m\PYZus{}obs: array, observed magnitudes}
\PY{l+s+sd}{        sigma: array, measurement uncertainties}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        logL: float, log\PYZhy{}likelihood value}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Ensure we only use the first four entries as model parameters}
    \PY{k}{if} \PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZlt{}} \PY{l+m+mi}{4}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}
    \PY{n}{A}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{phi}\PY{p}{,} \PY{n}{m0} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{4}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} Compute model magnitudes}
    \PY{n}{m\PYZus{}model} \PY{o}{=} \PY{n}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{phi}\PY{p}{,} \PY{n}{m0}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Numerical checks}
    \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{m\PYZus{}model}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{m\PYZus{}obs}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{sigma} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}

    \PY{n}{var} \PY{o}{=} \PY{n}{sigma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}
    \PY{n}{resid} \PY{o}{=} \PY{n}{m\PYZus{}obs} \PY{o}{\PYZhy{}} \PY{n}{m\PYZus{}model}
    \PY{n}{logL} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{resid}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{/} \PY{n}{var} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{*} \PY{n}{var}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n}{logL}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{121}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{param\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{A}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{T}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{phi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{param\PYZus{}true} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{1.5}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mf}{1.0}\PY{p}{,} \PY{l+m+mf}{15.0}\PY{p}{]}
\PY{n}{param\PYZus{}ranges} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{300}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{2}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{]}\PY{p}{)}

\PY{n}{log\PYZus{}dir} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lightcurve\PYZus{}true\PYZus{}model}\PY{l+s+s1}{\PYZsq{}}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to setup the UltraNest sampler}
\PY{n}{sampler} \PY{o}{=} \PY{n}{ultranest}\PY{o}{.}\PY{n}{ReactiveNestedSampler}\PY{p}{(}
    \PY{n}{param\PYZus{}names}\PY{p}{,}
    \PY{k}{lambda} \PY{n}{params}\PY{p}{:} \PY{n}{log\PYZus{}likelihood\PYZus{}lightcurve}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}\PY{p}{,}
    \PY{k}{lambda} \PY{n}{cube}\PY{p}{:} \PY{n}{prior\PYZus{}transform\PYZus{}lightcurve}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}ranges}\PY{p}{,} \PY{n}{derived\PYZus{}time}\PY{o}{=}\PY{n}{derived\PYZus{}time}\PY{p}{)}\PY{p}{,}
    \PY{n}{derived\PYZus{}param\PYZus{}names}\PY{o}{=}\PY{n}{derived\PYZus{}names}\PY{p}{,}
    \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{n}{log\PYZus{}dir}\PY{p}{,}
\PY{p}{)}

\PY{n}{sampler}\PY{o}{.}\PY{n}{stepsampler} \PY{o}{=} \PY{n}{stepsampler}\PY{o}{.}\PY{n}{SliceSampler}\PY{p}{(}
    \PY{n}{nsteps}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{param\PYZus{}names}\PY{p}{)}\PY{p}{,}
    \PY{n}{generate\PYZus{}direction}\PY{o}{=}\PY{n}{stepsampler}\PY{o}{.}\PY{n}{generate\PYZus{}mixture\PYZus{}random\PYZus{}direction}
\PY{p}{)}

\PY{n}{results\PYZus{}parametric} \PY{o}{=} \PY{n}{sampler}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run lightcurve\_true\_model/run1
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Z=-21.7(98.92\%) | Like=-6.00..-5.85 [-6.0036..-6.0032]*| it/evals=8120/248728
eff=3.2699\% N=400
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{122}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Make corner plot for the derived parameters}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{ultranest}\PY{n+nn}{.}\PY{n+nn}{plot}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{cornerplot}

\PY{n}{results\PYZus{}parametric\PYZus{}derived}  \PY{o}{=} \PY{p}{\PYZob{}}
    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{paramnames}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{derived\PYZus{}names}\PY{p}{,}
    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{\PYZob{}}
        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{results\PYZus{}parametric}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{:}\PY{p}{]}\PY{p}{,}
        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{results\PYZus{}parametric}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\PY{n}{cornerplot}\PY{p}{(}\PY{n}{results\PYZus{}parametric\PYZus{}derived}\PY{p}{,} \PY{n}{truths}\PY{o}{=}\PY{n}{derived\PYZus{}truth}\PY{p}{)}
\PY{k}{pass}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_28_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{123}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Report summary statistics of the derived parameters and compare with true values}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Results for True parametric model:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{j}\PY{p}{,} \PY{n}{ti} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{derived\PYZus{}time}\PY{p}{)}\PY{p}{:}
    \PY{n}{param\PYZus{}name} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}
    \PY{n}{mean} \PY{o}{=} \PY{n}{results\PYZus{}parametric}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{4}\PY{o}{+}\PY{n}{j}\PY{p}{]}
    \PY{n}{std} \PY{o}{=} \PY{n}{results\PYZus{}parametric}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{posterior}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stdev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{4}\PY{o}{+}\PY{n}{j}\PY{p}{]}
    \PY{n}{rel\PYZus{}error} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{mean} \PY{o}{\PYZhy{}} \PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
    \PY{n}{rel\PYZus{}error\PYZus{}norm} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{mean} \PY{o}{\PYZhy{}} \PY{n}{derived\PYZus{}truth}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{n}{std}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t = }\PY{l+s+si}{\PYZob{}}\PY{n}{ti}\PY{l+s+si}{:}\PY{l+s+s2}{.1f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ days:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{m = }\PY{l+s+si}{\PYZob{}}\PY{n}{mean}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ ± }\PY{l+s+si}{\PYZob{}}\PY{n}{std}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ mag (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}error}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{, normalized = }\PY{l+s+si}{\PYZob{}}\PY{n}{rel\PYZus{}error\PYZus{}norm}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ sigma)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Results for True parametric model:
t = 100.0 days:
        m = 16.333 ± 0.093 mag (relative error = 0.44\%, normalized = 0.76 sigma)
t = 200.0 days:
        m = 16.338 ± 0.088 mag (relative error = 0.46\%, normalized = 0.86 sigma)
t = 300.0 days:
        m = 16.339 ± 0.102 mag (relative error = 0.47\%, normalized = 0.75 sigma)
t = 400.0 days:
        m = 16.335 ± 0.129 mag (relative error = 0.45\%, normalized = 0.57 sigma)
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{124}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot predictive bands from the true parametric model}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{t\PYZus{}sample} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
\PY{n}{pband} \PY{o}{=} \PY{n}{PredictionBand}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{)}
\PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{results\PYZus{}parametric}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{:}
    \PY{n}{pband}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{lightcurve\PYZus{}model}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{,} \PY{o}{*}\PY{n}{p}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{4}\PY{p}{]}\PY{p}{)}\PY{p}{)}

\PY{n}{pband}\PY{o}{.}\PY{n}{line}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True parametric model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{pband}\PY{o}{.}\PY{n}{shade}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Overlay the true model and simulated data}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{t}\PY{p}{,} \PY{n}{m\PYZus{}obs}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{sigma}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{capsize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time (days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude (mag)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_30_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subparagraph{Discussions}\label{discussions}

用三角函数作为 kernel 对目标函数的限制范围明显优于用 Gaussian kernel.
这表明取 kernel 的时候应该考虑真实的函数应该是什么类型.

    \subsubsection{Exercise 2: Lorentzian absorption
line}\label{exercise-2-lorentzian-absorption-line}

A single Lorentzian absorption line on a flat continuum can be described
by the following model:

\(\mu(\lambda; A, \lambda_0, \gamma, C) = C - \dfrac{A}{\pi} \dfrac{\gamma}{(\lambda - \lambda_0)^2 + \gamma^2}\)

where \(A\) characterizes the area removed by the absorption line
(photons), \(\lambda_0\) is the line center (\(\AA\)), \(\gamma\) is the
scale parameter of the Lorentzian profile (\(\AA\)), and \(C\) is the
continuum level (\({\rm photon}\,\AA^{-1}\)).

The equivalent width (EW) of the absorption line is:

\(W = \displaystyle\int \left( 1 - \dfrac{\mu(\lambda)}{C} \right) d\lambda = \dfrac{A}{C} \,[\AA]\)

Consider a Lyman-\(\alpha\) absorption line with true parameters:
\(A=400\) photons, \(\lambda_0=1215.67\,\AA\), \(\gamma=0.8\,\AA\), and
\(C=200\,{\rm photon}\,\AA^{-1}\). The true equivalent width is thus
\(W=2.0\,\AA\).

Simulate \(N=51\) wavelength bins uniformly distributed in the
wavelength range of
\([\lambda_{\rm min}, \lambda_{\rm max}] = [1210, 1220]\,\AA\)
(including the endpoints) with spacing \(\Delta \lambda = 0.2\,\AA\).
Treat each observed count \(n_i\) as an independent Poisson random
variable with mean \(\mu(\lambda_i) \Delta \lambda\).

\paragraph{Question 2.1: naive estimation of line
properties}\label{question-2.1-naive-estimation-of-line-properties}

When the true line profile is unknown, we may naively estimate the line
properties directly from the observed counts using simple integration,
without relying on any model fitting.

We can estimate the continuum level \(\hat{C}\) by taking the average of
the observed fluxes at the two ends of the spectrum (first 5 and last 5
data points). The deficits (or photons removed due to the absorption
line) at each wavelength bin is given by:

\(d_i = \hat{C} - n_i / \Delta \lambda\)

The line center and equivalent width can then be estimated as:

\(\hat{\lambda}_0 = \dfrac{\int_{\lambda_{\rm min}}^{\lambda_{\rm max}} \lambda_i d_i \,{\rm d}\lambda}{\int_{\lambda_{\rm min}}^{\lambda_{\rm max}} d_i \,{\rm d}\lambda}\)

\(\hat{W} = \dfrac{\int_{\lambda_{\rm min}}^{\lambda_{\rm max}} d_i \,{\rm d}\lambda}{\hat{C}}\)

\textbf{Tasks:}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Simulate the observed spectrum \(\{(\lambda_i, n_i)\}\) using the true
  model parameters. Plot the simulated spectrum along with the true
  model.
\item
  Estimate the continuum level \(\hat{C}\), line center
  \(\hat{\lambda}_0\), and equivalent width \(\hat{W}\) using the naive
  integration method described above, and report their relative errors
  compared to the true values.
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{125}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Functions for the spectral model and simulation}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}model}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{lam0}\PY{p}{,} \PY{n}{gamma}\PY{p}{,} \PY{n}{C}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} Spectral model of a Lorentzian absorption line on a flat continuum.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        lam: array, wavelength array with fixed spacing [Angstrom]}
\PY{l+s+sd}{        dlam: float, wavelength spacing [Angstrom]}
\PY{l+s+sd}{        A: float, area of the absorption line [photon counts]}
\PY{l+s+sd}{        lam0: float, central wavelength of the absorption line [Angstrom]}
\PY{l+s+sd}{        gamma: float, scale parameter of the absorption line [Angstrom]}
\PY{l+s+sd}{        C: float, continuum level [photon counts per Angstrom]}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        n: array, spectral model [expected photon counts per wavelength bin]\PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{n} \PY{o}{=} \PY{n}{C} \PY{o}{\PYZhy{}} \PY{p}{(}\PY{n}{A} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)} \PY{o}{*} \PY{n}{gamma} \PY{o}{/} \PY{p}{(}\PY{p}{(}\PY{n}{lam} \PY{o}{\PYZhy{}} \PY{n}{lam0}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{gamma}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
    \PY{k}{return} \PY{n}{n}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{sim\PYZus{}spec}\PY{p}{(}\PY{n}{ndata}\PY{p}{,} \PY{n}{A}\PY{o}{=}\PY{l+m+mi}{80}\PY{p}{,} \PY{n}{lam0}\PY{o}{=}\PY{l+m+mf}{1215.67}\PY{p}{,} \PY{n}{gamma}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{C}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,} \PY{n}{lam\PYZus{}range}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1210}\PY{p}{,}\PY{l+m+mi}{1220}\PY{p}{]}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{l+m+mi}{42}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} Simulate a spectrum with Poisson noise.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        ndata: int, number of data points}
\PY{l+s+sd}{        A: float, area of the absorption line [photon counts]}
\PY{l+s+sd}{        lam0: float, central wavelength of the absorption line [Angstrom]}
\PY{l+s+sd}{        gamma: float, scale parameter of the absorption line [Angstrom]}
\PY{l+s+sd}{        C: float, continuum level [photon counts per Angstrom]}
\PY{l+s+sd}{        lam\PYZus{}range: list, wavelength range [Angstrom]}
\PY{l+s+sd}{        seed: int, random seed for reproducibility}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        lam: array, wavelength array [Angstrom]}
\PY{l+s+sd}{        n\PYZus{}obs: array, observed photon counts}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{lam} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{lam\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{lam\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{ndata}\PY{p}{)}
    \PY{n}{dlam} \PY{o}{=} \PY{p}{(}\PY{n}{lam\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{lam\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{n}{ndata} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{n\PYZus{}true} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{lam0}\PY{p}{,} \PY{n}{gamma}\PY{p}{,} \PY{n}{C}\PY{p}{)}
    \PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}
    \PY{n}{n\PYZus{}obs} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{poisson}\PY{p}{(}\PY{n}{n\PYZus{}true} \PY{o}{*} \PY{n}{dlam}\PY{p}{)}
    \PY{k}{return} \PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Set the random seed}
\PY{n}{seed} \PY{o}{=} \PY{l+m+mi}{2024011182}  \PY{c+c1}{\PYZsh{} NOTE: EDIT HERE to insert your seed}

\PY{c+c1}{\PYZsh{} Setup parameters}
\PY{n}{nspec} \PY{o}{=} \PY{l+m+mi}{51}
\PY{n}{lam\PYZus{}range} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1210}\PY{p}{,} \PY{l+m+mi}{1220}\PY{p}{]}
\PY{n}{dlam} \PY{o}{=} \PY{p}{(}\PY{n}{lam\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{lam\PYZus{}range}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{n}{nspec} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{param\PYZus{}spec\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{A}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lam0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{param\PYZus{}spec\PYZus{}true} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mf}{1215.67}\PY{p}{,} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{l+m+mi}{200}\PY{p}{]}
\PY{n}{lam0\PYZus{}true} \PY{o}{=} \PY{n}{param\PYZus{}spec\PYZus{}true}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\PY{n}{W\PYZus{}true} \PY{o}{=} \PY{n}{param\PYZus{}spec\PYZus{}true}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{/} \PY{n}{param\PYZus{}spec\PYZus{}true}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}

\PY{c+c1}{\PYZsh{} Simulate the spectrum}
\PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs} \PY{o}{=} \PY{n}{sim\PYZus{}spec}\PY{p}{(}\PY{n}{nspec}\PY{p}{,} \PY{o}{*}\PY{n}{param\PYZus{}spec\PYZus{}true}\PY{p}{,} \PY{n}{lam\PYZus{}range}\PY{o}{=}\PY{n}{lam\PYZus{}range}\PY{p}{,} \PY{n}{seed}\PY{o}{=}\PY{n}{seed}\PY{p}{)}

\PY{n}{x\PYZus{}model} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{1210}\PY{p}{,} \PY{l+m+mi}{1220}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}
\PY{n}{y\PYZus{}model} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{o}{*}\PY{n}{param\PYZus{}spec\PYZus{}true}\PY{p}{)} \PY{o}{*} \PY{n}{dlam}  \PY{c+c1}{\PYZsh{} Convert to counts per bin}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{127}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{drawstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{steps\PYZhy{}mid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True Model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Wavelength [Angstrom]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Photon Counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_35_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{128}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Naive estimation of line properties}
\PY{n}{C\PYZus{}naive} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{n\PYZus{}obs}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{5}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)} \PY{o}{/} \PY{n}{dlam}
\PY{n}{deficit\PYZus{}naive} \PY{o}{=} \PY{n}{C\PYZus{}naive} \PY{o}{\PYZhy{}} \PY{n}{n\PYZus{}obs} \PY{o}{/} \PY{n}{dlam}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to compute lam0\PYZus{}naive and W\PYZus{}naive}
\PY{n}{lam0\PYZus{}naive} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{lam} \PY{o}{*} \PY{n}{deficit\PYZus{}naive} \PY{o}{*} \PY{n}{dlam}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{deficit\PYZus{}naive} \PY{o}{*} \PY{n}{dlam}\PY{p}{)}
\PY{n}{W\PYZus{}naive} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{deficit\PYZus{}naive} \PY{o}{*} \PY{n}{dlam}\PY{p}{)} \PY{o}{/} \PY{n}{C\PYZus{}naive}

\PY{n}{lam0\PYZus{}naive\PYZus{}err} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{lam0\PYZus{}naive} \PY{o}{\PYZhy{}} \PY{n}{lam0\PYZus{}true}\PY{p}{)} \PY{o}{/} \PY{n}{lam0\PYZus{}true}
\PY{n}{W\PYZus{}naive\PYZus{}err} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{W\PYZus{}naive} \PY{o}{\PYZhy{}} \PY{n}{W\PYZus{}true}\PY{p}{)} \PY{o}{/} \PY{n}{W\PYZus{}true}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Naive estimates:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{lam0 = }\PY{l+s+si}{\PYZob{}}\PY{n}{lam0\PYZus{}naive}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ Angstrom (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{lam0\PYZus{}naive\PYZus{}err}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}t}\PY{l+s+s2}{W = }\PY{l+s+si}{\PYZob{}}\PY{n}{W\PYZus{}naive}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ Angstrom (relative error = }\PY{l+s+si}{\PYZob{}}\PY{n}{W\PYZus{}naive\PYZus{}err}\PY{l+s+si}{:}\PY{l+s+s2}{.2\PYZpc{}}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Naive estimates:
        lam0 = 1214.822 Angstrom (relative error = 0.07\%)
        W = 1.105 Angstrom (relative error = 44.76\%)
    \end{Verbatim}

    \paragraph{Question 2.2: line properties from basis
functions}\label{question-2.2-line-properties-from-basis-functions}

The expected photon counts can be modeled by subtracting a sum of
(normalized) Gaussian basis functions from the continuum level:

\(\mu_g (\lambda) = C - \sum\limits_{i=1}^{M} a_i g_i (\lambda)\),

where the Gaussian basis functions share the same standard deviation
\(\sigma\) and are centered at arbitrary locations \(\mu_i\) in the
wavelength range \([\lambda_{\rm min}, \lambda_{\rm max}]\):

\(g_i (\lambda) = \dfrac{1}{\sqrt{2\pi} \sigma} \exp\left[-\dfrac{(\lambda - \mu_i)^2}{2\sigma^2}\right], \quad i = 1, \ldots, n\)

In this case, the area of each basis function is normalized to 1 (assume
the tails outside the wavelength range
\([\lambda_{\rm min}, \lambda_{\rm max}]\) are negligible):

\(\displaystyle\int_{\lambda_{\rm min}}^{\lambda_{\rm max}} g_i (\lambda) \,{\rm d}\lambda \approx 1\)

The equivalent width and line center can then be computed as derived
parameters:

\(W_g \approx \dfrac{1}{C} \sum\limits_{i=1}^{n} a_i \,[\AA]\)

\(\lambda_{0,g} \approx \dfrac{\sum\limits_{i=1}^{n} a_i \mu_i}{\sum\limits_{i=1}^{n} a_i}\)

\textbf{Tasks:} 1. Using the same simulated spectrum from Question 2.1,
fit the data with \(M=1,2,3\) Gaussian basis functions. Infer the
coefficients \(\{a_i\}\) and continuum level \(C\) using
\texttt{UltraNest}, and report the inferred parameters \(W_g\) and
\(\lambda_{0,g}\) along with their uncertainties. Use flat priors for
all parameters: \(C\) in \([100, 300]\) photons \(\AA^{-1}\), \(a_i\) in
\([10, 200]\) photons, \(\mu_i\) in
\([\lambda_{\rm min}, \lambda_{\rm max}]\,\AA\), and \(\sigma\) in
\([0.1, 5.0]\,\AA\). 2. Compare the results from the basis function
regression with the true parameters, as well as the naive estimates from
Question 2.1.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{special}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{xlogy}\PY{p}{,} \PY{n}{gammaln}
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{norm}

\PY{c+c1}{\PYZsh{} Functions for UltraNest inference with Gaussian basis functions}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{spec\PYZus{}gauss\PYZus{}model}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{params}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Model spectrum with Gaussian basis functions.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        lam: array, wavelength array in Ångström}
\PY{l+s+sd}{        params: array, parameters [C, sigma, mu\PYZus{}1, ..., mu\PYZus{}M, a\PYZus{}1, ..., a\PYZus{}M]}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        mu: array, model spectrum in photon counts per Angstrom}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{k}{if} \PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZlt{}} \PY{l+m+mi}{4}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} not enough parameters \PYZhy{}\PYZgt{} return flat continuum placeholder}
        \PY{n}{C} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{k}{if} \PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mi}{1} \PY{k}{else} \PY{l+m+mf}{0.0}
        \PY{k}{return} \PY{n}{C} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{zeros\PYZus{}like}\PY{p}{(}\PY{n}{lam}\PY{p}{)}

    \PY{n}{C} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    \PY{n}{sigma} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
    \PY{c+c1}{\PYZsh{} determine M from parameter length}
    \PY{n}{M} \PY{o}{=} \PY{p}{(}\PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{)} \PY{o}{/}\PY{o}{/} \PY{l+m+mi}{2}
    \PY{n}{mus} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{M}\PY{p}{]} \PY{k}{if} \PY{n}{M} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
    \PY{n}{a} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{M}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{+}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{M}\PY{p}{]} \PY{k}{if} \PY{n}{M} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}

    \PY{n}{lam} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{lam}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} normalized Gaussian basis functions (per Angstrom)}
    \PY{k}{if} \PY{n}{M} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n}{n\PYZus{}model} \PY{o}{=} \PY{n}{C} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{zeros\PYZus{}like}\PY{p}{(}\PY{n}{lam}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{norm\PYZus{}factor} \PY{o}{=} \PY{l+m+mf}{1.0} \PY{o}{/} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{l+m+mf}{2.0} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{pi}\PY{p}{)} \PY{o}{*} \PY{n}{sigma}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} shape (M, len(lam))}
        \PY{n}{gauss} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(}\PY{p}{[}\PY{n}{norm\PYZus{}factor} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5} \PY{o}{*} \PY{p}{(}\PY{p}{(}\PY{n}{lam} \PY{o}{\PYZhy{}} \PY{n}{mu}\PY{p}{)} \PY{o}{/} \PY{n}{sigma}\PY{p}{)} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)} \PY{k}{for} \PY{n}{mu} \PY{o+ow}{in} \PY{n}{mus}\PY{p}{]}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} subtract sum(a\PYZus{}i * g\PYZus{}i)}
        \PY{n}{n\PYZus{}model} \PY{o}{=} \PY{n}{C} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{(}\PY{n}{a}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]} \PY{o}{*} \PY{n}{gauss}\PY{p}{)}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{k}{return} \PY{n}{n\PYZus{}model}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{prior\PYZus{}transform\PYZus{}spec\PYZus{}gauss}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Transform unit cube to parameter space.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        cube: array, unit cube samples}
\PY{l+s+sd}{        param\PYZus{}ranges: array, parameter ranges}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        params: array, transformed parameters plus derived [W, lam0]}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{n}{cube} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{cube}\PY{p}{)}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{pmin}\PY{p}{,} \PY{n}{pmax}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
        \PY{n}{params}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pmin} \PY{o}{+} \PY{n}{cube}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{*} \PY{p}{(}\PY{n}{pmax} \PY{o}{\PYZhy{}} \PY{n}{pmin}\PY{p}{)}\PY{p}{)}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} compute derived parameters: equivalent width W\PYZus{}g and centroid lam0\PYZus{}g}
    \PY{k}{if} \PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mi}{4}\PY{p}{:}
        \PY{n}{M} \PY{o}{=} \PY{p}{(}\PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{)} \PY{o}{/}\PY{o}{/} \PY{l+m+mi}{2}
        \PY{n}{mus} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{M}\PY{p}{]} \PY{k}{if} \PY{n}{M} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
        \PY{n}{a} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{2}\PY{o}{+}\PY{n}{M}\PY{p}{:}\PY{l+m+mi}{2}\PY{o}{+}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{M}\PY{p}{]} \PY{k}{if} \PY{n}{M} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
        \PY{n}{C} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{n}{sum\PYZus{}a} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{a}\PY{p}{)} \PY{k}{if} \PY{n}{a}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{l+m+mf}{0.0}
        \PY{n}{W} \PY{o}{=} \PY{p}{(}\PY{n}{sum\PYZus{}a} \PY{o}{/} \PY{n}{C}\PY{p}{)} \PY{k}{if} \PY{n}{C} \PY{o}{!=} \PY{l+m+mi}{0} \PY{k}{else} \PY{l+m+mf}{0.0}
        \PY{n}{lam0} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{a} \PY{o}{*} \PY{n}{mus}\PY{p}{)} \PY{o}{/} \PY{n}{sum\PYZus{}a}\PY{p}{)} \PY{k}{if} \PY{n}{sum\PYZus{}a} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{mus}\PY{p}{)} \PY{k}{if} \PY{n}{mus}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{k}{else} \PY{l+m+mf}{0.0}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{W} \PY{o}{=} \PY{l+m+mf}{0.0}
        \PY{n}{lam0} \PY{o}{=} \PY{l+m+mf}{0.0}
    \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{params}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{W}\PY{p}{,} \PY{n}{lam0}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{log\PYZus{}likelihood\PYZus{}spec\PYZus{}gauss}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{dlam}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute log\PYZhy{}likelihood for Gaussian basis function model.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        params: array, model parameters [C, sigma, mu\PYZus{}1, ..., mu\PYZus{}M, a\PYZus{}1, ..., a\PYZus{}M]}
\PY{l+s+sd}{        lam: array, wavelength array}
\PY{l+s+sd}{        n\PYZus{}obs: array, observed photon counts (per bin)}
\PY{l+s+sd}{        dlam: float, wavelength bin size}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        logL: float, log\PYZhy{}likelihood value}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{k}{if} \PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZlt{}} \PY{l+m+mi}{4}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}

    \PY{n}{n\PYZus{}total} \PY{o}{=} \PY{n}{params}\PY{o}{.}\PY{n}{size}
    \PY{k}{if} \PY{n}{n\PYZus{}total} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mi}{4} \PY{o+ow}{and} \PY{p}{(}\PY{n}{n\PYZus{}total} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{)} \PY{o}{\PYZpc{}} \PY{l+m+mi}{2} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n}{model\PYZus{}len} \PY{o}{=} \PY{n}{n\PYZus{}total}
    \PY{k}{elif} \PY{n}{n\PYZus{}total} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mi}{6} \PY{o+ow}{and} \PY{p}{(}\PY{n}{n\PYZus{}total} \PY{o}{\PYZhy{}} \PY{l+m+mi}{4} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{)} \PY{o}{\PYZpc{}} \PY{l+m+mi}{2} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n}{model\PYZus{}len} \PY{o}{=} \PY{n}{n\PYZus{}total} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{model\PYZus{}len} \PY{o}{=} \PY{n}{n\PYZus{}total}
    \PY{n}{M} \PY{o}{=} \PY{p}{(}\PY{n}{model\PYZus{}len} \PY{o}{\PYZhy{}} \PY{l+m+mi}{2}\PY{p}{)} \PY{o}{/}\PY{o}{/} \PY{l+m+mi}{2}
    \PY{n}{n\PYZus{}model\PYZus{}params} \PY{o}{=} \PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{M}
    \PY{n}{model\PYZus{}params} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{p}{:}\PY{n}{n\PYZus{}model\PYZus{}params}\PY{p}{]}

    \PY{n}{C} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{model\PYZus{}params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
    \PY{n}{sigma} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{model\PYZus{}params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}

    \PY{k}{try}\PY{p}{:}
        \PY{n}{mu\PYZus{}per\PYZus{}A} \PY{o}{=} \PY{n}{spec\PYZus{}gauss\PYZus{}model}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{model\PYZus{}params}\PY{p}{)}
    \PY{k}{except} \PY{n+ne}{Exception}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}

    \PY{n}{lam\PYZus{}counts} \PY{o}{=} \PY{n}{mu\PYZus{}per\PYZus{}A} \PY{o}{*} \PY{n}{dlam}

    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}8}
    \PY{k}{if} \PY{o+ow}{not} \PY{n}{np}\PY{o}{.}\PY{n}{all}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{lam\PYZus{}counts}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{n\PYZus{}obs} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0}\PY{p}{)} \PY{o+ow}{or} \PY{n}{C} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0} \PY{o+ow}{or} \PY{n}{sigma} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}
    \PY{n}{lam\PYZus{}counts} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{lam\PYZus{}counts}\PY{p}{,} \PY{n}{eps}\PY{p}{)}

    \PY{n}{logL} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{xlogy}\PY{p}{(}\PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{lam\PYZus{}counts}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{lam\PYZus{}counts} \PY{o}{\PYZhy{}} \PY{n}{gammaln}\PY{p}{(}\PY{n}{n\PYZus{}obs} \PY{o}{+} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n+nb}{float}\PY{p}{(}\PY{n}{logL}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{156}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{spec\PYZus{}gauss\PYZus{}num} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}  \PY{c+c1}{\PYZsh{} Number of Gaussian basis functions}
\PY{n}{ultranest\PYZus{}results\PYZus{}spec\PYZus{}gauss} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{spec\PYZus{}derived\PYZus{}param\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lam0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{k}{for} \PY{n}{M} \PY{o+ow}{in} \PY{n}{spec\PYZus{}gauss\PYZus{}num}\PY{p}{:}
    \PY{n}{pnames} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sigma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mu}\PY{l+s+si}{\PYZob{}}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{M}\PY{p}{)}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{a}\PY{l+s+si}{\PYZob{}}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{M}\PY{p}{)}\PY{p}{]}
    \PY{n}{pranges} \PY{o}{=} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{300}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mf}{3.0}\PY{p}{]}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{1210}\PY{p}{,} \PY{l+m+mi}{1220}\PY{p}{]}\PY{p}{]} \PY{o}{*} \PY{n}{M} \PY{o}{+} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{]}\PY{p}{]} \PY{o}{*} \PY{n}{M}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to setup and run the UltraNest sampler}
    \PY{n}{sampler} \PY{o}{=} \PY{n}{ultranest}\PY{o}{.}\PY{n}{ReactiveNestedSampler}\PY{p}{(}
        \PY{n}{pnames}\PY{p}{,}
        \PY{k}{lambda} \PY{n}{params}\PY{p}{:} \PY{n}{log\PYZus{}likelihood\PYZus{}spec\PYZus{}gauss}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{dlam}\PY{p}{)}\PY{p}{,}
        \PY{k}{lambda} \PY{n}{cube}\PY{p}{:} \PY{n}{prior\PYZus{}transform\PYZus{}spec\PYZus{}gauss}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{pranges}\PY{p}{)}\PY{p}{,}
        \PY{n}{derived\PYZus{}param\PYZus{}names}\PY{o}{=}\PY{n}{spec\PYZus{}derived\PYZus{}param\PYZus{}names}\PY{p}{,}
        \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{spec\PYZus{}gauss\PYZus{}M}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
    \PY{p}{)}

    \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{n}{seed}\PY{p}{)}

    \PY{n}{sampler}\PY{o}{.}\PY{n}{stepsampler} \PY{o}{=} \PY{n}{stepsampler}\PY{o}{.}\PY{n}{SliceSampler}\PY{p}{(}
        \PY{n}{nsteps}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{pnames}\PY{p}{)}\PY{p}{,}
        \PY{n}{generate\PYZus{}direction}\PY{o}{=}\PY{n}{stepsampler}\PY{o}{.}\PY{n}{generate\PYZus{}mixture\PYZus{}random\PYZus{}direction}
    \PY{p}{)}

    \PY{n}{results} \PY{o}{=} \PY{n}{sampler}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}
    \PY{n}{ultranest\PYZus{}results\PYZus{}spec\PYZus{}gauss}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{results}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run spec\_gauss\_M1/run4
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run spec\_gauss\_M2/run485..-227.5058]*|
it/evals=3400/62079 eff=5.5124\% N=400
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run spec\_gauss\_M3/run402..-157.8901]*|
it/evals=6640/192812 eff=3.4509\% N=400
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Z=-171.3(98.97\%) | Like=-157.63..-157.03 [-157.6329..-157.6327]*|
it/evals=7337/391615 eff=1.8754\% N=400
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{157}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Convert UltraNest results to getdist MCSamples and make corner plots}
\PY{n}{getdist\PYZus{}spec\PYZus{}gauss\PYZus{}samples} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{spec\PYZus{}gauss\PYZus{}num}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}spec\PYZus{}gauss}\PY{p}{[}\PY{n}{i}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to convert UltraNest results to GetDist MCSamples}
    \PY{n}{ws} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{start\PYZus{}idx} \PY{o}{=} \PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{M}  \PY{c+c1}{\PYZsh{} skip C, sigma, mu\PYZus{}1..mu\PYZus{}M, a\PYZus{}1..a\PYZus{}M}
    \PY{n}{samples} \PY{o}{=} \PY{n}{MCSamples}\PY{p}{(}
        \PY{n}{samples}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{start\PYZus{}idx}\PY{p}{:}\PY{p}{]}\PY{p}{,}
        \PY{n}{weights}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{loglikes}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{names}\PY{o}{=}\PY{n}{spec\PYZus{}derived\PYZus{}param\PYZus{}names}\PY{p}{,}
        \PY{n}{sampler}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nested}\PY{l+s+s1}{\PYZsq{}}
    \PY{p}{)}
    \PY{n}{getdist\PYZus{}spec\PYZus{}gauss\PYZus{}samples}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{samples}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Make corner plots}
\PY{n}{g} \PY{o}{=} \PY{n}{plots}\PY{o}{.}\PY{n}{get\PYZus{}single\PYZus{}plotter}\PY{p}{(}\PY{n}{width\PYZus{}inch}\PY{o}{=}\PY{l+m+mi}{8}\PY{p}{,} \PY{n}{ratio}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{n}{g}\PY{o}{.}\PY{n}{triangle\PYZus{}plot}\PY{p}{(}
    \PY{n}{getdist\PYZus{}spec\PYZus{}gauss\PYZus{}samples}\PY{p}{,}
    \PY{n}{param\PYZus{}names}\PY{o}{=}\PY{n}{spec\PYZus{}derived\PYZus{}param\PYZus{}names}\PY{p}{,}
    \PY{n}{filled}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}
    \PY{n}{markers}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{W\PYZus{}true}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lam0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{lam0\PYZus{}true}\PY{p}{\PYZcb{}}\PY{p}{,}
    \PY{n}{legend\PYZus{}labels}\PY{o}{=}\PY{p}{[}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{M} \PY{o+ow}{in} \PY{n}{spec\PYZus{}gauss\PYZus{}num}\PY{p}{]}\PY{p}{,}
    \PY{n}{legend\PYZus{}loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{upper right}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Removed no burn in
Removed no burn in
Removed no burn in
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<Figure size 2400x2400 with 0 Axes>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_40_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{158}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Plot the predictive bands from Gaussian basis function models}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
\PY{n}{colors} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:brown}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:cyan}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{n}{rng} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{default\PYZus{}rng}\PY{p}{(}\PY{n}{seed}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{M} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{spec\PYZus{}gauss\PYZus{}num}\PY{p}{)}\PY{p}{:}
    \PY{n}{results} \PY{o}{=} \PY{n}{ultranest\PYZus{}results\PYZus{}spec\PYZus{}gauss}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n}{t\PYZus{}sample} \PY{o}{=} \PY{n}{x\PYZus{}model}
    \PY{n}{pband} \PY{o}{=} \PY{n}{PredictionBand}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{)}
    \PY{n}{n\PYZus{}model\PYZus{}params} \PY{o}{=} \PY{l+m+mi}{2} \PY{o}{+} \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{M}

    \PY{n}{ws} \PY{o}{=} \PY{n}{results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{pts} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{n}{n\PYZus{}model\PYZus{}params}\PY{p}{]}
    \PY{n}{weights} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
    \PY{k}{if} \PY{n}{weights}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0} \PY{o+ow}{or} \PY{n+nb}{len}\PY{p}{(}\PY{n}{weights}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{results}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{p}{[}\PY{p}{]}\PY{p}{)}\PY{p}{:}
            \PY{n}{pband}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{spec\PYZus{}gauss\PYZus{}model}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{,} \PY{n}{p}\PY{p}{[}\PY{p}{:}\PY{n}{n\PYZus{}model\PYZus{}params}\PY{p}{]}\PY{p}{)} \PY{o}{*} \PY{n}{dlam}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{probs} \PY{o}{=} \PY{n}{weights} \PY{o}{/} \PY{n}{weights}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
        \PY{n}{n\PYZus{}draw} \PY{o}{=} \PY{l+m+mi}{2000}
        \PY{n}{idx} \PY{o}{=} \PY{n}{rng}\PY{o}{.}\PY{n}{choice}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{pts}\PY{p}{)}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{n\PYZus{}draw}\PY{p}{,} \PY{n}{p}\PY{o}{=}\PY{n}{probs}\PY{p}{)}
        \PY{k}{for} \PY{n}{ind} \PY{o+ow}{in} \PY{n}{idx}\PY{p}{:}
            \PY{n}{p} \PY{o}{=} \PY{n}{pts}\PY{p}{[}\PY{n}{ind}\PY{p}{]}
            \PY{n}{pband}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{spec\PYZus{}gauss\PYZus{}model}\PY{p}{(}\PY{n}{t\PYZus{}sample}\PY{p}{,} \PY{n}{p}\PY{p}{)} \PY{o}{*} \PY{n}{dlam}\PY{p}{)}

    \PY{n}{pband}\PY{o}{.}\PY{n}{line}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{colors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gaussian spec M=}\PY{l+s+si}{\PYZob{}}\PY{n}{M}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{pband}\PY{o}{.}\PY{n}{shade}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{colors}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}model}\PY{p}{,} \PY{n}{y\PYZus{}model}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True model}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tab:orange}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{step}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{where}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Observed data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Wavelength [Angstrom]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Photon Counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_41_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Question 2.3: line properties from parametric
model}\label{question-2.3-line-properties-from-parametric-model}

\textbf{Tasks:} 1. Assume the Lorentzian absorption line model is known,
fit the simulated spectrum using \texttt{UltraNest}. Use uniform priors
over the following ranges: - \(A \in [100, 800]\) photons -
\(\lambda_0 \in [1210, 1220]\,\AA\) - \(\gamma \in [0.1, 2.0]\,\AA\) -
\(C \in [100, 300]\,{\rm photon}\,\AA^{-1}\) 2. Infer the equivalent
width \(W\) as a derived parameter. 3. Report summary statistics of the
inferred parameters, and compare with the results from Questions 2.1 and
2.2. 4. Discuss all your findings for the whole exercise.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{159}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from}\PY{+w}{ }\PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{special}\PY{+w}{ }\PY{k+kn}{import} \PY{n}{xlogy}\PY{p}{,} \PY{n}{gammaln}

\PY{c+c1}{\PYZsh{} Functions for UltraNest inference with the true parametric model}
\PY{k}{def}\PY{+w}{ }\PY{n+nf}{prior\PYZus{}transform\PYZus{}spec}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Transform unit cube to parameter space.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        cube: array, unit cube samples (A, lam0, gamma, C)}
\PY{l+s+sd}{        param\PYZus{}ranges: array, parameter ranges}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        params: array, transformed parameters + derived parameter}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{n}{params} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{n}{pmin}\PY{p}{,} \PY{n}{pmax}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{param\PYZus{}ranges}\PY{p}{)}\PY{p}{:}
        \PY{n}{params}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pmin} \PY{o}{+} \PY{p}{(}\PY{n}{pmax} \PY{o}{\PYZhy{}} \PY{n}{pmin}\PY{p}{)} \PY{o}{*} \PY{n}{cube}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Add derived parameter: EW}
    \PY{n}{params}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{/} \PY{n}{params}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{params}\PY{p}{)}

\PY{k}{def}\PY{+w}{ }\PY{n+nf}{log\PYZus{}likelihood\PYZus{}spec}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{dlam}\PY{p}{)}\PY{p}{:}
\PY{+w}{    }\PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Compute log\PYZhy{}likelihood for the true parametric spectral model.}
\PY{l+s+sd}{    Args:}
\PY{l+s+sd}{        params: array, model parameters (A, lam0, gamma, C)}
\PY{l+s+sd}{        lam: array, wavelength array}
\PY{l+s+sd}{        n\PYZus{}obs: array, observed photon counts}
\PY{l+s+sd}{        dlam: float, wavelength bin size}
\PY{l+s+sd}{    Returns:}
\PY{l+s+sd}{        logL: float, log\PYZhy{}likelihood value}
\PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
    \PY{c+c1}{\PYZsh{} NOTE: EDIT below to complete this function}
    \PY{n}{params} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{params}\PY{p}{)}
    \PY{k}{if} \PY{n}{params}\PY{o}{.}\PY{n}{size} \PY{o}{\PYZlt{}} \PY{l+m+mi}{4}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}
    \PY{n}{A}\PY{p}{,} \PY{n}{lam0}\PY{p}{,} \PY{n}{gamma}\PY{p}{,} \PY{n}{C} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{4}\PY{p}{]}

    \PY{c+c1}{\PYZsh{} compute model (photons per Angstrom) and expected counts per bin}
    \PY{k}{try}\PY{p}{:}
        \PY{n}{mu\PYZus{}per\PYZus{}A} \PY{o}{=} \PY{n}{spec\PYZus{}model}\PY{p}{(}\PY{n}{lam}\PY{p}{,} \PY{n}{A}\PY{p}{,} \PY{n}{lam0}\PY{p}{,} \PY{n}{gamma}\PY{p}{,} \PY{n}{C}\PY{p}{)}
    \PY{k}{except} \PY{n+ne}{Exception}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}

    \PY{n}{lam\PYZus{}counts} \PY{o}{=} \PY{n}{mu\PYZus{}per\PYZus{}A} \PY{o}{*} \PY{n}{dlam}

    \PY{c+c1}{\PYZsh{} numeric checks and floor}
    \PY{n}{eps} \PY{o}{=} \PY{l+m+mf}{1e\PYZhy{}8}
    \PY{k}{if} \PY{o+ow}{not} \PY{n}{np}\PY{o}{.}\PY{n}{all}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{isfinite}\PY{p}{(}\PY{n}{lam\PYZus{}counts}\PY{p}{)}\PY{p}{)} \PY{o+ow}{or} \PY{n}{np}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{n\PYZus{}obs} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0}\PY{p}{)} \PY{o+ow}{or} \PY{n}{C} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1e99}
    \PY{n}{lam\PYZus{}counts} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{lam\PYZus{}counts}\PY{p}{,} \PY{n}{eps}\PY{p}{)}

    \PY{c+c1}{\PYZsh{} Poisson log\PYZhy{}likelihood}
    \PY{n}{logL} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{xlogy}\PY{p}{(}\PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{lam\PYZus{}counts}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{lam\PYZus{}counts} \PY{o}{\PYZhy{}} \PY{n}{gammaln}\PY{p}{(}\PY{n}{n\PYZus{}obs} \PY{o}{+} \PY{l+m+mf}{1.0}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n}{logL}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{160}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{param\PYZus{}spec\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{A}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lam0}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{param\PYZus{}spec\PYZus{}true} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{400}\PY{p}{,} \PY{l+m+mf}{1215.67}\PY{p}{,} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{l+m+mi}{200}\PY{p}{]}
\PY{n}{param\PYZus{}spec\PYZus{}ranges} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{800}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{1210}\PY{p}{,} \PY{l+m+mi}{1220}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{300}\PY{p}{)}\PY{p}{]}

\PY{n}{log\PYZus{}dir} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{spec\PYZus{}true\PYZus{}model}\PY{l+s+s1}{\PYZsq{}}

\PY{c+c1}{\PYZsh{} NOTE: EDIT below to setup the UltraNest sampler}
\PY{n}{sampler} \PY{o}{=} \PY{n}{ultranest}\PY{o}{.}\PY{n}{ReactiveNestedSampler}\PY{p}{(}
    \PY{n}{param\PYZus{}spec\PYZus{}names}\PY{p}{,}
    \PY{k}{lambda} \PY{n}{params}\PY{p}{:} \PY{n}{log\PYZus{}likelihood\PYZus{}spec}\PY{p}{(}\PY{n}{params}\PY{p}{,} \PY{n}{lam}\PY{p}{,} \PY{n}{n\PYZus{}obs}\PY{p}{,} \PY{n}{dlam}\PY{p}{)}\PY{p}{,}
    \PY{k}{lambda} \PY{n}{cube}\PY{p}{:} \PY{n}{prior\PYZus{}transform\PYZus{}spec}\PY{p}{(}\PY{n}{cube}\PY{p}{,} \PY{n}{param\PYZus{}spec\PYZus{}ranges}\PY{p}{)}\PY{p}{,}
    \PY{n}{derived\PYZus{}param\PYZus{}names}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{n}{log\PYZus{}dir}\PY{p}{,}
\PY{p}{)}

\PY{n}{sampler}\PY{o}{.}\PY{n}{stepsampler} \PY{o}{=} \PY{n}{stepsampler}\PY{o}{.}\PY{n}{SliceSampler}\PY{p}{(}
    \PY{n}{nsteps}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{param\PYZus{}spec\PYZus{}names}\PY{p}{)}\PY{p}{,}
    \PY{n}{generate\PYZus{}direction}\PY{o}{=}\PY{n}{stepsampler}\PY{o}{.}\PY{n}{generate\PYZus{}mixture\PYZus{}random\PYZus{}direction}
\PY{p}{)}

\PY{n}{results\PYZus{}spec\PYZus{}true} \PY{o}{=} \PY{n}{sampler}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Creating directory for new run spec\_true\_model/run2
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
VBox(children=(HTML(value=''), GridspecLayout(children=(HTML(value="<div style='background-color:\#6E6BF4;'>\&nb…
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Z=-170.2(98.98\%) | Like=-158.71..-158.58 [-158.7129..-158.7126]*|
it/evals=6440/196816 eff=3.2788\% N=400
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{161}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Make corner plot using getdist}
\PY{n}{ws} \PY{o}{=} \PY{n}{results\PYZus{}spec\PYZus{}true}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weighted\PYZus{}samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{n}{samples} \PY{o}{=} \PY{n}{MCSamples}\PY{p}{(}
    \PY{n}{samples}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{weights}\PY{o}{=}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{loglikes}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{n}{ws}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{logl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{names}\PY{o}{=}\PY{n}{param\PYZus{}spec\PYZus{}names} \PY{o}{+} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
    \PY{n}{ranges}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{n}\PY{p}{:}\PY{n}{p} \PY{k}{for} \PY{n}{n}\PY{p}{,}\PY{n}{p} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{param\PYZus{}spec\PYZus{}names} \PY{o}{+} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{param\PYZus{}spec\PYZus{}ranges} \PY{o}{+} \PY{p}{[}\PY{p}{[}\PY{k+kc}{None}\PY{p}{,} \PY{k+kc}{None}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{,}
    \PY{n}{sampler}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nested}\PY{l+s+s1}{\PYZsq{}}
\PY{p}{)}

\PY{n}{g} \PY{o}{=} \PY{n}{plots}\PY{o}{.}\PY{n}{get\PYZus{}single\PYZus{}plotter}\PY{p}{(}\PY{n}{width\PYZus{}inch}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{ratio}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{n}{g}\PY{o}{.}\PY{n}{triangle\PYZus{}plot}\PY{p}{(}
    \PY{n}{samples}\PY{p}{,}
    \PY{n}{markers}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{n}\PY{p}{:}\PY{n}{v} \PY{k}{for} \PY{n}{n}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{param\PYZus{}spec\PYZus{}names} \PY{o}{+} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{param\PYZus{}spec\PYZus{}true} \PY{o}{+} \PY{p}{[}\PY{n}{W\PYZus{}true}\PY{p}{]}\PY{p}{)}\PY{p}{\PYZcb{}}
\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Removed no burn in
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<Figure size 1800x1800 with 0 Axes>
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Exercise_week_08_files/Exercise_week_08_45_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subparagraph{Discussions}\label{discussions}

从结果来看，模拟能够给出包含真值的一个范围，但是误差还是较大.

    \subsubsection{Note: steps for submitting the
exercise}\label{note-steps-for-submitting-the-exercise}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  In the menu bar, select \texttt{File\ \textgreater{}\ Download} to
  download your notebook as a \texttt{.ipynb} file.
\item
  Select
  \texttt{File\ \textgreater{}\ Save\ and\ Export\ Notebook\ As\ \textgreater{}\ PDF}
  to export your notebook as a PDF file.
\item
  Combine the \texttt{.ipynb} and \texttt{.pdf} files into a single
  \texttt{.zip} or \texttt{.tar.gz} archive.
\item
  Upload your archive to the web learning platform (网络学堂).
\end{enumerate}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
